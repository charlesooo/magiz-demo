var Ht=Object.create;var Ye=Object.defineProperty;var Lt=Object.getOwnPropertyDescriptor;var Bt=Object.getOwnPropertyNames;var Ft=Object.getPrototypeOf,Ut=Object.prototype.hasOwnProperty;var q=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var Vt=(e,t,n,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of Bt(t))!Ut.call(e,r)&&r!==n&&Ye(e,r,{get:()=>t[r],enumerable:!(o=Lt(t,r))||o.enumerable});return e};var zt=(e,t,n)=>(n=e!=null?Ht(Ft(e)):{},Vt(t||!e||!e.__esModule?Ye(n,"default",{value:e,enumerable:!0}):n,e));var ke=q(X=>{"use strict";function we(){return we=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},we.apply(this,arguments)}Object.defineProperty(X,"__esModule",{value:!0});var w,je={0:11,1:0,2:3,3:0,4:0,5:0,6:0,7:11,8:11,9:1,10:10,11:0,12:11,13:0,14:-1};X.tokenTypes=void 0,(w=X.tokenTypes||(X.tokenTypes={}))[w.FUNCTION_WITH_ONE_ARG=0]="FUNCTION_WITH_ONE_ARG",w[w.NUMBER=1]="NUMBER",w[w.BINARY_OPERATOR_HIGH_PRECENDENCE=2]="BINARY_OPERATOR_HIGH_PRECENDENCE",w[w.CONSTANT=3]="CONSTANT",w[w.OPENING_PARENTHESIS=4]="OPENING_PARENTHESIS",w[w.CLOSING_PARENTHESIS=5]="CLOSING_PARENTHESIS",w[w.DECIMAL=6]="DECIMAL",w[w.POSTFIX_FUNCTION_WITH_ONE_ARG=7]="POSTFIX_FUNCTION_WITH_ONE_ARG",w[w.FUNCTION_WITH_N_ARGS=8]="FUNCTION_WITH_N_ARGS",w[w.BINARY_OPERATOR_LOW_PRECENDENCE=9]="BINARY_OPERATOR_LOW_PRECENDENCE",w[w.BINARY_OPERATOR_PERMUTATION=10]="BINARY_OPERATOR_PERMUTATION",w[w.COMMA=11]="COMMA",w[w.EVALUATED_FUNCTION=12]="EVALUATED_FUNCTION",w[w.EVALUATED_FUNCTION_PARAMETER=13]="EVALUATED_FUNCTION_PARAMETER",w[w.SPACE=14]="SPACE",X.createTokens=function(e){return[{token:"sin",show:"sin",type:0,value:e.math.sin},{token:"cos",show:"cos",type:0,value:e.math.cos},{token:"tan",show:"tan",type:0,value:e.math.tan},{token:"pi",show:"&pi;",type:3,value:"PI"},{token:"(",show:"(",type:4,value:"("},{token:")",show:")",type:5,value:")"},{token:"P",show:"P",type:10,value:e.math.P},{token:"C",show:"C",type:10,value:e.math.C},{token:" ",show:" ",type:14,value:" ".anchor},{token:"asin",show:"asin",type:0,value:e.math.asin},{token:"acos",show:"acos",type:0,value:e.math.acos},{token:"atan",show:"atan",type:0,value:e.math.atan},{token:"7",show:"7",type:1,value:"7"},{token:"8",show:"8",type:1,value:"8"},{token:"9",show:"9",type:1,value:"9"},{token:"int",show:"Int",type:0,value:Math.floor},{token:"cosh",show:"cosh",type:0,value:e.math.cosh},{token:"acosh",show:"acosh",type:0,value:e.math.acosh},{token:"ln",show:" ln",type:0,value:Math.log},{token:"^",show:"^",type:10,value:Math.pow},{token:"root",show:"root",type:0,value:Math.sqrt},{token:"4",show:"4",type:1,value:"4"},{token:"5",show:"5",type:1,value:"5"},{token:"6",show:"6",type:1,value:"6"},{token:"/",show:"&divide;",type:2,value:e.math.div},{token:"!",show:"!",type:7,value:e.math.fact},{token:"tanh",show:"tanh",type:0,value:e.math.tanh},{token:"atanh",show:"atanh",type:0,value:e.math.atanh},{token:"Mod",show:" Mod ",type:2,value:e.math.mod},{token:"1",show:"1",type:1,value:"1"},{token:"2",show:"2",type:1,value:"2"},{token:"3",show:"3",type:1,value:"3"},{token:"*",show:"&times;",type:2,value:e.math.mul},{token:"sinh",show:"sinh",type:0,value:e.math.sinh},{token:"asinh",show:"asinh",type:0,value:e.math.asinh},{token:"e",show:"e",type:3,value:"E"},{token:"log",show:" log",type:0,value:e.math.log},{token:"0",show:"0",type:1,value:"0"},{token:".",show:".",type:6,value:"."},{token:"+",show:"+",type:9,value:e.math.add},{token:"-",show:"-",type:9,value:e.math.sub},{token:",",show:",",type:11,value:","},{token:"Sigma",show:"&Sigma;",type:12,value:e.math.sigma},{token:"n",show:"n",type:13,value:"n"},{token:"Pi",show:"&Pi;",type:12,value:e.math.Pi},{token:"pow",show:"pow",type:8,value:Math.pow,numberOfArguments:2},{token:"&",show:"&",type:9,value:e.math.and}].map(function(t){return we({},t,{precedence:je[t.type]})})},X.preced=je});var Xe=q(ye=>{"use strict";Object.defineProperty(ye,"__esModule",{value:!0});var v=ke();function H(e,t){for(var n=0;n<e.length;n++)e[n]+=t;return e}var V={0:!0,1:!0,3:!0,4:!0,6:!0,8:!0,9:!0,12:!0,13:!0,14:!0},ee={0:!0,1:!0,2:!0,3:!0,4:!0,5:!0,6:!0,7:!0,8:!0,9:!0,10:!0,11:!0,12:!0,13:!0},Gt={0:!0,3:!0,4:!0,8:!0,12:!0,13:!0},U={},ce={0:!0,1:!0,3:!0,4:!0,6:!0,8:!0,12:!0,13:!0},Zt={1:!0},L=[[],["1","2","3","7","8","9","4","5","6","+","-","*","/","(",")","^","!","P","C","e","0",".",",","n"," ","&"],["pi","ln","Pi"],["sin","cos","tan","Del","int","Mod","log","pow"],["asin","acos","atan","cosh","root","tanh","sinh"],["acosh","atanh","asinh","Sigma"]];function Yt(e,t,n,o){for(var r=0;r<o;r++)if(e[n+r]!==t[r])return!1;return!0}function We(e,t){for(var n=0;n<t.length;n++)if(t[n].token===e)return n;return-1}ye.addToken=function(e){for(var t=0;t<e.length;t++){var n=e[t].token.length,o=-1;e[t].type===v.tokenTypes.FUNCTION_WITH_N_ARGS&&e[t].numberOfArguments===void 0&&(e[t].numberOfArguments=2),L[n]=L[n]||[];for(var r=0;r<L[n].length;r++)if(e[t].token===L[n][r]){o=We(L[n][r],this.tokens);break}o===-1?(this.tokens.push(e[t]),e[t].precedence=v.preced[e[t].type],L.length<=e[t].token.length&&(L[e[t].token.length]=[]),L[e[t].token.length].push(e[t].token)):(this.tokens[o]=e[t],e[t].precedence=v.preced[e[t].type])}},ye.lex=function(e,t){var n,o={value:this.math.changeSign,type:v.tokenTypes.FUNCTION_WITH_ONE_ARG,precedence:4,show:"-"},r={value:")",show:")",type:v.tokenTypes.CLOSING_PARENTHESIS,precedence:0},s={value:"(",type:v.tokenTypes.OPENING_PARENTHESIS,precedence:0,show:"("},i=[s],a=[],c=e,l=V,p=0,f=U,u="";t!==void 0&&this.addToken(t);var y=function(O,I){for(var _,C,S,Z=[],j=I.length,D=0;D<j;D++)if(!(D<j-1&&I[D]===" "&&I[D+1]===" ")){for(_="",C=I.length-D>L.length-2?L.length-1:I.length-D;C>0;C--)if(L[C]!==void 0)for(S=0;S<L[C].length;S++)Yt(I,L[C][S],D,C)&&(_=L[C][S],S=L[C].length,C=0);if(D+=_.length-1,_==="")throw new Error("Can't understand after "+I.slice(D));Z.push(O.tokens[We(_,O.tokens)])}return Z}(this,c);for(n=0;n<y.length;n++){var h=y[n];if(h.type!==14){var x,d=h.token,m=h.type,b=h.value,T=h.precedence,g=h.show,M=i[i.length-1];for(x=a.length;x--&&a[x]===0;)if([v.tokenTypes.FUNCTION_WITH_ONE_ARG,v.tokenTypes.BINARY_OPERATOR_HIGH_PRECENDENCE,v.tokenTypes.CONSTANT,v.tokenTypes.OPENING_PARENTHESIS,v.tokenTypes.CLOSING_PARENTHESIS,v.tokenTypes.BINARY_OPERATOR_LOW_PRECENDENCE,v.tokenTypes.BINARY_OPERATOR_PERMUTATION,v.tokenTypes.COMMA,v.tokenTypes.EVALUATED_FUNCTION,v.tokenTypes.EVALUATED_FUNCTION_PARAMETER].indexOf(m)!==-1){if(l[m]!==!0)throw new Error(d+" is not allowed after "+u);i.push(r),l=ee,f=ce,a.pop()}if(l[m]!==!0)throw new Error(d+" is not allowed after "+u);f[m]===!0&&(m=v.tokenTypes.BINARY_OPERATOR_HIGH_PRECENDENCE,b=this.math.mul,g="&times;",T=3,n-=1);var R={value:b,type:m,precedence:T,show:g,numberOfArguments:h.numberOfArguments};if(m===v.tokenTypes.FUNCTION_WITH_ONE_ARG)l=V,f=U,H(a,2),i.push(R),y[n+1].type!==v.tokenTypes.OPENING_PARENTHESIS&&(i.push(s),a.push(2));else if(m===v.tokenTypes.NUMBER)M.type===v.tokenTypes.NUMBER?(M.value+=b,H(a,1)):i.push(R),l=ee,f=Gt;else if(m===v.tokenTypes.BINARY_OPERATOR_HIGH_PRECENDENCE)l=V,f=U,H(a,2),i.push(R);else if(m===v.tokenTypes.CONSTANT)i.push(R),l=ee,f=ce;else if(m===v.tokenTypes.OPENING_PARENTHESIS)H(a,1),p++,l=V,f=U,i.push(R);else if(m===v.tokenTypes.CLOSING_PARENTHESIS){if(!p)throw new Error("Closing parenthesis are more than opening one, wait What!!!");p--,l=ee,f=ce,i.push(R),H(a,1)}else if(m===v.tokenTypes.DECIMAL){if(M.hasDec)throw new Error("Two decimals are not allowed in one number");M.type!==v.tokenTypes.NUMBER&&(M={show:"0",value:0,type:v.tokenTypes.NUMBER,precedence:0},i.push(M)),l=Zt,H(a,1),f=U,M.value+=b,M.hasDec=!0}else m===v.tokenTypes.POSTFIX_FUNCTION_WITH_ONE_ARG&&(l=ee,f=ce,H(a,1),i.push(R));m===v.tokenTypes.FUNCTION_WITH_N_ARGS?(l=V,f=U,H(a,h.numberOfArguments+2),i.push(R),y[n+1].type!==v.tokenTypes.OPENING_PARENTHESIS&&(i.push(s),a.push(h.numberOfArguments+2))):m===v.tokenTypes.BINARY_OPERATOR_LOW_PRECENDENCE?(M.type===v.tokenTypes.BINARY_OPERATOR_LOW_PRECENDENCE?M.value===this.math.add?(M.value=b,M.show=g,H(a,1)):M.value===this.math.sub&&g==="-"&&(M.value=this.math.add,M.show="+",H(a,1)):M.type!==v.tokenTypes.CLOSING_PARENTHESIS&&M.type!==v.tokenTypes.POSTFIX_FUNCTION_WITH_ONE_ARG&&M.type!==v.tokenTypes.NUMBER&&M.type!==v.tokenTypes.CONSTANT&&M.type!==v.tokenTypes.EVALUATED_FUNCTION_PARAMETER?d==="-"&&(l=V,f=U,H(a,1).push(2),i.push(o),i.push(s)):(i.push(R),H(a,2)),l=V,f=U):m===v.tokenTypes.BINARY_OPERATOR_PERMUTATION?(l=V,f=U,H(a,2),i.push(R)):m===v.tokenTypes.COMMA?(l=V,f=U,i.push(R)):m===v.tokenTypes.EVALUATED_FUNCTION?(l=V,f=U,H(a,6),i.push(R),y[n+1].type!==v.tokenTypes.OPENING_PARENTHESIS&&(i.push(s),a.push(6))):m===v.tokenTypes.EVALUATED_FUNCTION_PARAMETER&&(l=ee,f=ce,i.push(R)),H(a,-1),u=d}else if(n>0&&n<y.length-1&&y[n+1].type===1&&(y[n-1].type===1||y[n-1].type===6))throw new Error("Unexpected Space")}for(x=a.length;x--;)i.push(r);if(l[5]!==!0)throw new Error("complete the expression");for(;p--;)i.push(r);return i.push(r),i}});var $e=q(Ne=>{"use strict";Object.defineProperty(Ne,"__esModule",{value:!0}),Ne.toPostfix=function(e){for(var t,n,o,r=[],s=-1,i=-1,a=[{value:"(",type:4,precedence:0,show:"("}],c=1;c<e.length;c++)if(e[c].type===1||e[c].type===3||e[c].type===13)e[c].type===1&&(e[c].value=Number(e[c].value)),r.push(e[c]);else if(e[c].type===4)a.push(e[c]);else if(e[c].type===5)for(;((l=n=a.pop())==null?void 0:l.type)!==4;){var l;n&&r.push(n)}else if(e[c].type===11){for(;((p=n=a.pop())==null?void 0:p.type)!==4;){var p;n&&r.push(n)}a.push(n)}else{i=(t=e[c]).precedence,s=(o=a[a.length-1]).precedence;var f=o.value=="Math.pow"&&t.value=="Math.pow";if(i>s)a.push(t);else{for(;s>=i&&!f||f&&i<s;)n=a.pop(),o=a[a.length-1],n&&r.push(n),s=o.precedence,f=t.value=="Math.pow"&&o.value=="Math.pow";a.push(t)}}return r}});var Je=q(Ae=>{"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.postfixEval=function(e,t){(t=t||{}).PI=Math.PI,t.E=Math.E;for(var n,o,r,s=[],i=t.n!==void 0,a=0;a<e.length;a++)if(e[a].type===1)s.push({value:e[a].value,type:1});else if(e[a].type===3)s.push({value:t[e[a].value],type:1});else if(e[a].type===0){var c=s[s.length-1];Array.isArray(c)?c.push(e[a]):c.value=e[a].value(c.value)}else if(e[a].type===7){var l=s[s.length-1];Array.isArray(l)?l.push(e[a]):l.value=e[a].value(l.value)}else if(e[a].type===8){for(var p=[],f=0;f<e[a].numberOfArguments;f++){var u=s.pop();u&&p.push(u.value)}s.push({type:1,value:e[a].value.apply(e[a],p.reverse())})}else if(e[a].type===10)n=s.pop(),o=s.pop(),Array.isArray(o)?((o=o.concat(n)).push(e[a]),s.push(o)):Array.isArray(n)?(n.unshift(o),n.push(e[a]),s.push(n)):s.push({type:1,value:e[a].value(o.value,n.value)});else if(e[a].type===2||e[a].type===9)n=s.pop(),o=s.pop(),Array.isArray(o)?((o=o.concat(n)).push(e[a]),s.push(o)):Array.isArray(n)?(n.unshift(o),n.push(e[a]),s.push(n)):s.push({type:1,value:e[a].value(o.value,n.value)});else if(e[a].type===12){n=s.pop();var y=void 0;y=!Array.isArray(n)&&n?[n]:n||[],o=s.pop(),r=s.pop(),s.push({type:1,value:e[a].value(r.value,o.value,y)})}else e[a].type===13&&(i?s.push({value:t[e[a].value],type:3}):s.push([e[a]]));if(s.length>1)throw new Error("Uncaught Syntax error");return parseFloat(s[0].value.toFixed(15))}});var Qe=q(Se=>{"use strict";Object.defineProperty(Se,"__esModule",{value:!0});Se.createMathFunctions=function(e){return{isDegree:!0,acos:function(t){return e.math.isDegree?180/Math.PI*Math.acos(t):Math.acos(t)},add:function(t,n){return t+n},asin:function(t){return e.math.isDegree?180/Math.PI*Math.asin(t):Math.asin(t)},atan:function(t){return e.math.isDegree?180/Math.PI*Math.atan(t):Math.atan(t)},acosh:function(t){return Math.log(t+Math.sqrt(t*t-1))},asinh:function(t){return Math.log(t+Math.sqrt(t*t+1))},atanh:function(t){return Math.log((1+t)/(1-t))},C:function(t,n){var o=1,r=t-n,s=n;s<r&&(s=r,r=n);for(var i=s+1;i<=t;i++)o*=i;var a=e.math.fact(r);return a==="NaN"?"NaN":o/a},changeSign:function(t){return-t},cos:function(t){return e.math.isDegree&&(t=e.math.toRadian(t)),Math.cos(t)},cosh:function(t){return(Math.pow(Math.E,t)+Math.pow(Math.E,-1*t))/2},div:function(t,n){return t/n},fact:function(t){if(t%1!=0)return"NaN";for(var n=1,o=2;o<=t;o++)n*=o;return n},inverse:function(t){return 1/t},log:function(t){return Math.log(t)/Math.log(10)},mod:function(t,n){return t%n},mul:function(t,n){return t*n},P:function(t,n){for(var o=1,r=Math.floor(t)-Math.floor(n)+1;r<=Math.floor(t);r++)o*=r;return o},Pi:function(t,n,o){for(var r=1,s=t;s<=n;s++)r*=Number(e.postfixEval(o,{n:s}));return r},pow10x:function(t){for(var n=1;t--;)n*=10;return n},sigma:function(t,n,o){for(var r=0,s=t;s<=n;s++)r+=Number(e.postfixEval(o,{n:s}));return r},sin:function(t){return e.math.isDegree&&(t=e.math.toRadian(t)),Math.sin(t)},sinh:function(t){return(Math.pow(Math.E,t)-Math.pow(Math.E,-1*t))/2},sub:function(t,n){return t-n},tan:function(t){return e.math.isDegree&&(t=e.math.toRadian(t)),Math.tan(t)},tanh:function(t){return e.math.sinh(t)/e.math.cosh(t)},toRadian:function(t){return t*Math.PI/180},and:function(t,n){return t&n}}}});var et=q((Jn,qe)=>{"use strict";var Ke=Xe(),Pe=ke(),jt=$e(),Wt=Je(),Xt=Qe(),Oe=function(){function e(){this.toPostfix=jt.toPostfix,this.addToken=Ke.addToken,this.lex=Ke.lex,this.postfixEval=Wt.postfixEval,this.math=Xt.createMathFunctions(this),this.tokens=Pe.createTokens(this)}return e.prototype.eval=function(t,n,o){return this.postfixEval(this.toPostfix(this.lex(t,n)),o)},e}();Oe.TOKEN_TYPES=Pe.tokenTypes,Oe.tokenTypes=Pe.tokenTypes,qe.exports=Oe});var lt=zt(et());import{Vector2 as me,Matrix3 as Jt}from"three";var tt=1234567,$t=Math.PI/180,Qn=180/Math.PI;function nt(e){e!==void 0&&(tt=e);let t=tt+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}function de(e){return e*$t}function A(e){return e._v?nt(e.get()):Math.random()}function B(e,t){return e[1]?e[Math.floor(A(t)*e.length)]:e[0]}function Y(e,t,n,o){return o?t+Math.floor((n-t)/o*A(e))*o:t+(n-t)*A(e)}function te(e){let t=e[0],n=t.clone(),o=t.clone();return e.forEach(r=>{let{x:s,y:i}=r;s<n.x?n.x=s:s>o.x&&(o.x=s),i<n.y?n.y=i:i>o.y&&(o.y=i)}),{min:n,max:o}}function ne(e){return e<.7854||e>5.4978||2.3562<e&&e<3.927}function Qt(e,t){let{x:n,y:o}=e.start,{x:r,y:s}=e.end,{x:i,y:a}=t.start,{x:c,y:l}=t.end,p=(n-r)*(a-l)-(o-s)*(i-c);if(p!==0){let f=((n-i)*(a-l)-(o-a)*(i-c))/p,u=-((n-r)*(o-a)-(o-s)*(n-i))/p;if(f>=0&&f<=1&&u>=0&&u<=1)return new me(n+f*(r-n),o+f*(s-o))}}function Kt(e,t){let{x:n,y:o}=e;return n>=t.min.x&&n<=t.max.x&&o>=t.min.y&&o<=t.max.y}function ot(e,t){let n=[e.start,e.end].filter(r=>Kt(r,t));if(n.length===2)return{start:e.start.clone(),end:e.end.clone()};{let r=t.lines.map(c=>Qt(c,e)).filter(c=>c),s=n[0],i=r[0],a=r[1];if(s){if(i){if(i&&a)return Ie(e,i,a);if(i.x!==s.x||i.y!==s.y)return Ie(e,i,s)}}else if(i&&a&&(i.x!==a.x||i.y!==a.y))return Ie(e,i,a)}}function Ie(e,t,n){let o={x:e.end.x-e.start.x,y:e.end.y-e.start.y},r={x:n.x-t.x,y:n.y-t.y};return o.x*r.x+o.y*r.y>0?{start:t,end:n}:{start:n,end:t}}function rt(e,t){let{x:n,y:o}=e.start,{x:r,y:s}=e.direction,{x:i,y:a}=t.start,{x:c,y:l}=t.direction,p=r*l-s*c;if(p!==0){let f={x:i-n,y:a-o},u=(f.x*l-f.y*c)/p;return new me(n+u*r,o+u*s)}}function _e(e,t){let{x:n,y:o}=e.direction,r=new me(-o,n);r.setLength(ne(r.angle())?t.x:t.y);let s=r.add(e.start);return{start:s,end:s.clone().add(e.direction),direction:e.direction}}function xe(e,t,n=0){let o=e.reduce((r,s)=>r+s,0);if(o>0){let r=Math.round((t-n)/o);if(r>0)return{ratio:t/(o*r+n),count:r}}}function Ce(e,t){let n=[],o=[];if(t.forEach(s=>{let i=r(e,s);i&&o.push(i)}),o.sort((s,i)=>s.x-i.x),o.length%2===0)for(let s=0;s<o.length;s+=2){let i=o[s],a=o[s+1];n.push([i,a])}return n;function r(s,i){let{x:a,y:c}=i.start,{x:l,y:p}=i.end;if(c<p?c<s&&s<p:p<s&&s<c){let f=(p-c)/(l-a),u=(s-c)/f+a;return new me(u,s)}}}function De(e,t,n,o){let r=[],s=te(e.map(u=>u.start)),i=s.min.y,a=s.max.y-s.min.y,c=t.map(u=>Object.assign({elevation:n},u)),l=c.map(u=>u.width),p=xe(l,a,o?l[0]:0);if(p){c.forEach(u=>u.width*=p.ratio);for(let u=0;u<p.count;u++)c.forEach(f);o&&c[0]&&f(c[0])}return r;function f(u){let y=u.width/2;i+=y;let h=Ce(i,e).map(x=>{let[d,m]=x;return{center:{x:(d.x+m.x)/2,y:(d.y+m.y)/2},width:m.x-d.x}});u.shrink&&h.forEach(x=>x.width-=u.shrink),u.transform?.forEach(x=>{"moveX"in x&&h.forEach(d=>{d.center.x+=x.moveX,d.center.y+=x.moveY})}),r.push(Object.assign({pairs:h},u)),i+=y}}function He(e,t,n){let o=0;if(n==="RANDOM"?o=Math.PI*2*A(t):n==="DEPTH"?o=Math.PI/2:n==="WIDTH"?o=0:n==="LONGEST"?o=e.reduce((s,i)=>s.direction.length()>i.direction.length()?s:i).direction.angle():n==="SHORTEST"?o=e.reduce((s,i)=>s.direction.length()<i.direction.length()?s:i).direction.angle():typeof n=="number"&&(o=n*(Math.PI/180)),o){let r=new Jt().makeRotation(o);e=e.map(s=>({direction:s.direction.clone().applyMatrix3(r),start:s.start.clone().applyMatrix3(r),end:s.end.clone().applyMatrix3(r)}))}else e=e.map(r=>({direction:r.direction.clone(),start:r.start.clone(),end:r.end.clone()}));return{newRays:e,radian:o}}function oe(e,t,n){let o=!0;if(n){let{everyIndex:r,skipIndex:s,chance:i}=n;(r&&e%r!==0||s&&e%s===0||i&&A(t)>i)&&(o=!1)}return o}var ge=class{v;_v;constructor(t){this.v=this._v=t||st()}get(){return this.v++}set(t){this.v=this._v=t||st()}reset(){this.v=this._v}};function st(){return Math.round(Math.random()*Math.pow(10,3))}function Le(e,t){let{preset:n,building:o}=e;for(let r=0;r<t.length;r++){let s=t[r];for(let i in s.preset)n[i]&&console.log(`preset:${i} is replaceed`);for(let i in s.building)o[i]&&console.log(`building:${i} is replaceed`);Object.assign(o,s.building),Object.assign(n,s.preset)}for(let r in o)o[r].section.roof?.floor?.forEach(i=>{i.preset?.forEach(a=>{a.name&&!n[a.name]&&console.error("invalid style:",a.name,"@",r);let c=a.key;c&&Object.keys(n).filter(p=>p.includes(c)).length===0&&console.error("invalid key of style:",a.key)})});return e}var qt=new lt.default,P={UNITS:{},UNITS_PRESET:{},COLOR_PRESET:{}},z={colorMap:[],floorCount:0,classified:[]},re=class{Blocks;data;constructor(...t){this.Blocks={type:"FREE",section:{bottom:{height:"1BH",floor:[{extrude:[{once:!0,height:"1BH"}]}]}}},this.data={preset:{},building:{}},this.merge(t)}merge(t){return Le(this.data,t),this.data}getOptions(){let t={paid:[],free:["Blocks"]},n=this.data.building;for(let o in n)n[o].type==="FREE"?t.free.push(o):t.paid.push(o);return t}parseStyle(t,n,o){z.colorMap=["#eee","#bdf G"],z.floorCount=0,z.classified=[];let r=Number(t.height),s=Number(t.floorHeight||3),i=Number(t.elevation||0);n.set(Number(t.seed||0)||Math.round(Math.random()*1e5));let a=!t.style||t.style==="Blocks"?this.Blocks:o?.building[t.style]||this.data.building[t.style];if(a){P.UNITS=Object.assign({BH:r,FH:s},a.unit);let c=a.section,l=E(c.roof?.height),p=E(c.roof?.floorHeight)||s,f=E(c.bottom.height),u=E(c.bottom.floorHeight)||s;f<u&&(f=u);let y=r-l-f,h=E(c.middle?.floorHeight)||s;y=Math.floor(y/h)*h,f=r-l-y,u=f/Math.floor(f/u),Be(c.bottom,!1,o,this,i,f,u,n),Be(c.middle,!1,o,this,i+f,y,h,n),Be(c.roof,!0,o,this,i+r-l,l,p,n)}else console.warn(`${t.style} is invalid, returned empty data`);return z}};function $(e,t){let n=[],o=e.color;if(o)if(typeof o=="string"){let r=P.COLOR_PRESET[o];r?n=typeof r=="string"?[r]:r:n.push(o)}else n=o;return Object.assign({transform:e.transform?e.transform.map(r=>"rotateX"in r?{rotateX:E(r.rotateX)}:"rotateY"in r?{rotateY:E(r.rotateY)}:"rotateZ"in r?{rotateZ:E(r.rotateZ)}:{moveX:E(r.moveX),moveY:E(r.moveY),moveZ:E(r.moveZ)}):[],color:n.map(r=>{let s=0,i=!1;return r==="G"?(s=1,i=!0):(i=/G$/i.test(r),s=z.colorMap.indexOf(r),s<0&&(s=z.colorMap.length,z.colorMap.push(r))),{index:s,glass:i}})},t)}function it(e){return e.map(t=>"x"in t?$(t,{x:E(t.x),y:E(t.y),z:E(t.z)}):$(t,{width:E(t.width),height:E(t.height),shrink:E(t.shrink)}))}function en(e){return e.map(t=>$(t,{x:E(t.x),y:E(t.y),z:E(t.z)}))}function ft(e){return $(e,{width:E(e.width),height:E(e.height),shrink:E(e.shrink)})}function Be(e,t,n,o,r,s,i,a){if(e){P.UNITS.FH=i;let c=0;t?c=1:(c=Math.round(s/P.UNITS.FH),z.floorCount+=c),c>0&&e.floor?.forEach(l=>{at(c,i,s,r,l,a),l.preset?.forEach(p=>{let{name:f,key:u,unit:y,color:h}=p;try{let x;if(f)x=n?.preset[f]||o.data.preset[f];else if(u){if(n){let d=Object.keys(n.preset).filter(m=>m.includes(u));d.length>0&&(x=n.preset[B(d,a)])}if(!x){let d=Object.keys(o.data.preset).filter(m=>m.includes(u));d.length>0&&(x=o.data.preset[B(d,a)])}}if(x){if(x.unit)if(P.UNITS_PRESET={},y)for(let d in x.unit){let m=y[d];P.UNITS_PRESET[d]=E(m!==void 0?m:x.unit[d])}else for(let d in x.unit)P.UNITS_PRESET[d]=E(x.unit[d]);if(x.color)if(P.COLOR_PRESET={},h)for(let d in x.color)P.COLOR_PRESET[d]=h[d]||x.color[d];else for(let d in x.color)P.COLOR_PRESET[d]=x.color[d];x.floor.forEach(d=>{let m=Object.assign({},d);l.floorControl&&(m.floorControl=l.floorControl),l.floorNumber&&(m.floorNumber=l.floorNumber),l.floorRange&&(m.floorRange=l.floorRange),m.setEdges=[...l.setEdges||[],...m.setEdges||[]],at(c,i,s,r,m,a)}),P.COLOR_PRESET=P.UNITS_PRESET={}}else console.warn("can not find preset:",f)}catch(x){console.warn("handle preset error:",f,x)}})})}}function at(e,t,n,o,r,s){let i=Te(r.floorControl),a=nn(r),c=JSON.stringify(a),l=z.classified.find(h=>h.edgesJSON===c),p=l||{edgeParams:a,edgesJSON:c,extrude:[],slopingRoof:[],clampBox:[],facade:[],match:[],boxInside:[],adjunct:[]};l||z.classified.push(p);let{floorNumber:f,floorRange:u}=r;tn(0,e,f,u).forEach(h=>{let x=h[1]-h[0];P.UNITS.SH=f||u?x*t:n;for(let d=h[0];d<h[1];d++)if(oe(d,s,i)){let m=d===h[0],b=o+d*t;rn(b,m,p,r.extrude),sn(b,m,p,r.slopingRoof),an(b,m,p,r.clampBox),ln(b,m,p,r.match),fn(b,m,p,r.boxInside),un(b,m,p,r.adjunct),cn(b,m,p,r.facade)}})}function tn(e,t,n,o){let r=[];if(n)r.push([e,e+E(n)]);else if(o){let s=t-e;o.forEach(i=>{let{asRatio:a,bottom:c,top:l,reverse:p}=i,f=E(c),u=E(l),y=e,h=t;p?a?(f&&(h=y+Math.round(s*f)),u&&(y=h-Math.round(s*u))):(f&&(h=y+f),u&&(y=h-u)):a?(f&&(y+=Math.round(s*f)),u&&(h-=Math.round(s*u))):(f&&(y+=f),u&&(h-=u)),y<h&&r.push([y,h])})}else r.push([e,t]);return r}function nn(e){return{set:e.setEdges?.map(t=>{let{offset:n,clamp:o,along:r}=t;return{offset:on(n),clamp:pn(o),along:r}})}}function on(e){if(e){if(typeof e=="object")return{x:E(e.x),y:E(e.y),asRatio:!!e.asRatio};{let t=E(e);return{x:t,y:t,asRatio:!1}}}}function rn(e,t,n,o){o&&o.forEach(r=>{let{once:s,height:i,thickness:a}=r;(!s||t)&&n.extrude.push($(r,{thickness:E(a),height:E(i),elevation:e}))})}function sn(e,t,n,o){o&&o.forEach(r=>{let{once:s,height:i,overhang:a}=r;(!s||t)&&n.slopingRoof.push($(r,{overhang:E(a),height:E(i),elevation:e}))})}function an(e,t,n,o){o&&o.forEach(r=>{let{once:s,height:i}=r;(!s||t)&&n.clampBox.push($(r,{height:E(i),elevation:e}))})}function Te(e){return e?{skipIndex:E(e.skipIndex),everyIndex:E(e.everyIndex),chance:E(e.chance)}:void 0}function cn(e,t,n,o){o&&o.forEach(r=>{let{once:s,padding:i,proto:a}=r;if(!s||t){let c={elevation:e,padding:Fe(i),proto:[]};a&&a.forEach(l=>{let{area:p,spacing:f,divide:u,first:y,last:h,lastWidth:x}=l;c.proto.push({area:p||"MIDDLE",spacing:f?.map(d=>({space:E(d.space),group:d.group?it(Array.isArray(d.group)?d.group:[d.group]):void 0,control:Te(d.control),repeat:E(d.repeat)})),divide:u?.map(d=>({count:E(d.count),group:it(Array.isArray(d.group)?d.group:[d.group]),control:Te(d.control)})),first:typeof y=="boolean"?y:!0,last:h||!1,lastWidth:E(x)})}),c.proto[0]&&n.facade.push(c)}})}function ln(e,t,n,o){o&&o.forEach(r=>{let{once:s,along:i,top:a,bottom:c}=r;if(!s||t){let l={elevation:e,along:i,flexes:r.flexes.map(ft),bottom:void 0,top:void 0,control:Te(r.control),sandwich:r.sandwich||!1};if(a){let{like:p,ratio:f,padding:u}=a;l.top={like:p,ratio:E(f),padding:u?Fe(u):void 0}}if(c){let{like:p,ratio:f,padding:u}=c;l.bottom={like:p,ratio:E(f),padding:u?Fe(u):void 0}}n.match.push(l)}})}function fn(e,t,n,o){o&&o.forEach(r=>{let{flex:s,count:i,widthRatio:a,depthRatio:c,heightRatio:l,along:p,once:f}=r;(!f||t)&&n.boxInside.push({flex:ft(s),count:Ee(i),widthRatio:Ee(a),depthRatio:Ee(c),heightRatio:Ee(l),along:p,elevation:e})})}function Ee(e){if(typeof e=="object")return[E(e[0]),E(e[1])];{let t=e?E(e):1;return[t,t]}}function un(e,t,n,o){o&&o.forEach(r=>{let{once:s,boxes:i,place:a,count:c}=r;(!s||t)&&n.adjunct.push({count:c?E(c):1,place:a||"EDGE",boxes:en(i),elevation:e})})}function pn(e){if(e)return{xMin:E(e.xMin),xMax:E(e.xMax),yMin:E(e.yMin),yMax:E(e.yMax),xCentral:E(e.xCentral),yCentral:E(e.yCentral),asRatio:typeof e.asRatio=="boolean"?e.asRatio:!0,reverse:e.reverse||!1}}function Fe(e){if(e)return{start:E(e.start),middle:E(e.middle),end:E(e.end),asRatio:typeof e.asRatio=="boolean"?e.asRatio:!0}}function E(e){let t;if(typeof e=="string"){e=ct(e,P.UNITS),e=ct(e,P.UNITS_PRESET);try{t=qt.eval(e)}catch(n){console.log("[parse fomula]",n,e,P.UNITS,P.UNITS_PRESET),t=0}}else t=e||0;return t}function ct(e,t){return t&&Object.keys(t).sort((o,r)=>r.length-o.length).forEach(o=>{e=e.replace(new RegExp(`\\d+(\\.\\d+)?${o}`,"g"),r=>{let s=Number(t[o]);return(Number(r.replace(o,""))*s).toString()})}),e}import{Vector2 as he,Matrix3 as Fn}from"three";var pt={triangulate:function(e,t,n=2){let o=t&&t.length,r=o?t[0]*n:e.length,s=ht(e,0,r,n,!0),i=[];if(!s||s.next===s.prev)return i;let a,c,l,p,f,u,y;if(o&&(s=xn(e,t,s,n)),e.length>80*n){a=l=e[0],c=p=e[1];for(let h=n;h<r;h+=n)f=e[h],u=e[h+1],f<a&&(a=f),u<c&&(c=u),f>l&&(l=f),u>p&&(p=u);y=Math.max(l-a,p-c),y=y!==0?32767/y:0}return le(s,i,n,a,c,y,0),i}};function ht(e,t,n,o,r){let s,i;if(r===An(e,t,n,o)>0)for(s=t;s<n;s+=o)i=ut(s,e[s],e[s+1],i);else for(s=n-o;s>=t;s-=o)i=ut(s,e[s],e[s+1],i);return i&&Re(i,i.next)&&(ue(i),i=i.next),i}function J(e,t){if(!e)return e;t||(t=e);let n=e,o;do if(o=!1,!n.steiner&&(Re(n,n.next)||N(n.prev,n,n.next)===0)){if(ue(n),n=t=n.prev,n===n.next)break;o=!0}else n=n.next;while(o||n!==t);return t}function le(e,t,n,o,r,s,i){if(!e)return;!i&&s&&vn(e,o,r,s);let a=e,c,l;for(;e.prev!==e.next;){if(c=e.prev,l=e.next,s?yn(e,o,r,s):hn(e)){t.push(c.i/n|0),t.push(e.i/n|0),t.push(l.i/n|0),ue(e),e=l.next,a=l.next;continue}if(e=l,e===a){i?i===1?(e=dn(J(e),t,n),le(e,t,n,o,r,s,2)):i===2&&mn(e,t,n,o,r,s):le(J(e),t,n,o,r,s,1);break}}}function hn(e){let t=e.prev,n=e,o=e.next;if(N(t,n,o)>=0)return!1;let r=t.x,s=n.x,i=o.x,a=t.y,c=n.y,l=o.y,p=r<s?r<i?r:i:s<i?s:i,f=a<c?a<l?a:l:c<l?c:l,u=r>s?r>i?r:i:s>i?s:i,y=a>c?a>l?a:l:c>l?c:l,h=o.next;for(;h!==t;){if(h.x>=p&&h.x<=u&&h.y>=f&&h.y<=y&&se(r,a,s,c,i,l,h.x,h.y)&&N(h.prev,h,h.next)>=0)return!1;h=h.next}return!0}function yn(e,t,n,o){let r=e.prev,s=e,i=e.next;if(N(r,s,i)>=0)return!1;let a=r.x,c=s.x,l=i.x,p=r.y,f=s.y,u=i.y,y=a<c?a<l?a:l:c<l?c:l,h=p<f?p<u?p:u:f<u?f:u,x=a>c?a>l?a:l:c>l?c:l,d=p>f?p>u?p:u:f>u?f:u,m=Ue(y,h,t,n,o),b=Ue(x,d,t,n,o),T=e.prevZ,g=e.nextZ;for(;T&&T.z>=m&&g&&g.z<=b;){if(T.x>=y&&T.x<=x&&T.y>=h&&T.y<=d&&T!==r&&T!==i&&se(a,p,c,f,l,u,T.x,T.y)&&N(T.prev,T,T.next)>=0||(T=T.prevZ,g.x>=y&&g.x<=x&&g.y>=h&&g.y<=d&&g!==r&&g!==i&&se(a,p,c,f,l,u,g.x,g.y)&&N(g.prev,g,g.next)>=0))return!1;g=g.nextZ}for(;T&&T.z>=m;){if(T.x>=y&&T.x<=x&&T.y>=h&&T.y<=d&&T!==r&&T!==i&&se(a,p,c,f,l,u,T.x,T.y)&&N(T.prev,T,T.next)>=0)return!1;T=T.prevZ}for(;g&&g.z<=b;){if(g.x>=y&&g.x<=x&&g.y>=h&&g.y<=d&&g!==r&&g!==i&&se(a,p,c,f,l,u,g.x,g.y)&&N(g.prev,g,g.next)>=0)return!1;g=g.nextZ}return!0}function dn(e,t,n){let o=e;do{let r=o.prev,s=o.next.next;!Re(r,s)&&yt(r,o,o.next,s)&&fe(r,s)&&fe(s,r)&&(t.push(r.i/n|0),t.push(o.i/n|0),t.push(s.i/n|0),ue(o),ue(o.next),o=e=s),o=o.next}while(o!==e);return J(o)}function mn(e,t,n,o,r,s){let i=e;do{let a=i.next.next;for(;a!==i.prev;){if(i.i!==a.i&&wn(i,a)){let c=dt(i,a);i=J(i,i.next),c=J(c,c.next),le(i,t,n,o,r,s,0),le(c,t,n,o,r,s,0);return}a=a.next}i=i.next}while(i!==e)}function xn(e,t,n,o){let r=[],s,i,a,c,l;for(s=0,i=t.length;s<i;s++)a=t[s]*o,c=s<i-1?t[s+1]*o:e.length,l=ht(e,a,c,o,!1),l===l.next&&(l.steiner=!0),r.push(Mn(l));for(r.sort(gn),s=0;s<r.length;s++)n=En(r[s],n);return n}function gn(e,t){return e.x-t.x}function En(e,t){let n=Tn(e,t);if(!n)return t;let o=dt(n,e);return J(o,o.next),J(n,n.next)}function Tn(e,t){let n=t,o=-1/0,r,s=e.x,i=e.y;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){let u=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(u<=s&&u>o&&(o=u,r=n.x<n.next.x?n:n.next,u===s))return r}n=n.next}while(n!==t);if(!r)return null;let a=r,c=r.x,l=r.y,p=1/0,f;n=r;do s>=n.x&&n.x>=c&&s!==n.x&&se(i<l?s:o,i,c,l,i<l?o:s,i,n.x,n.y)&&(f=Math.abs(i-n.y)/(s-n.x),fe(n,e)&&(f<p||f===p&&(n.x>r.x||n.x===r.x&&bn(r,n)))&&(r=n,p=f)),n=n.next;while(n!==a);return r}function bn(e,t){return N(e.prev,e,t.prev)<0&&N(t.next,e,e.next)<0}function vn(e,t,n,o){let r=e;do r.z===0&&(r.z=Ue(r.x,r.y,t,n,o)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,Rn(r)}function Rn(e){let t,n,o,r,s,i,a,c,l=1;do{for(n=e,e=null,s=null,i=0;n;){for(i++,o=n,a=0,t=0;t<l&&(a++,o=o.nextZ,!!o);t++);for(c=l;a>0||c>0&&o;)a!==0&&(c===0||!o||n.z<=o.z)?(r=n,n=n.nextZ,a--):(r=o,o=o.nextZ,c--),s?s.nextZ=r:e=r,r.prevZ=s,s=r;n=o}s.nextZ=null,l*=2}while(i>1);return e}function Ue(e,t,n,o,r){return e=(e-n)*r|0,t=(t-o)*r|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function Mn(e){let t=e,n=e;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==e);return n}function se(e,t,n,o,r,s,i,a){return(r-i)*(t-a)>=(e-i)*(s-a)&&(e-i)*(o-a)>=(n-i)*(t-a)&&(n-i)*(s-a)>=(r-i)*(o-a)}function wn(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!kn(e,t)&&(fe(e,t)&&fe(t,e)&&Nn(e,t)&&(N(e.prev,e,t.prev)||N(e,t.prev,t))||Re(e,t)&&N(e.prev,e,e.next)>0&&N(t.prev,t,t.next)>0)}function N(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function Re(e,t){return e.x===t.x&&e.y===t.y}function yt(e,t,n,o){let r=ve(N(e,t,n)),s=ve(N(e,t,o)),i=ve(N(n,o,e)),a=ve(N(n,o,t));return!!(r!==s&&i!==a||r===0&&be(e,n,t)||s===0&&be(e,o,t)||i===0&&be(n,e,o)||a===0&&be(n,t,o))}function be(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function ve(e){return e>0?1:e<0?-1:0}function kn(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&yt(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}function fe(e,t){return N(e.prev,e,e.next)<0?N(e,t,e.next)>=0&&N(e,e.prev,t)>=0:N(e,t,e.prev)<0||N(e,e.next,t)<0}function Nn(e,t){let n=e,o=!1,r=(e.x+t.x)/2,s=(e.y+t.y)/2;do n.y>s!=n.next.y>s&&n.next.y!==n.y&&r<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(o=!o),n=n.next;while(n!==e);return o}function dt(e,t){let n=new Ve(e.i,e.x,e.y),o=new Ve(t.i,t.x,t.y),r=e.next,s=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,o.next=n,n.prev=o,s.next=o,o.prev=s,o}function ut(e,t,n,o){let r=new Ve(e,t,n);return o?(r.next=o.next,r.prev=o,o.next.prev=r,o.next=r):(r.prev=r,r.next=r),r}function ue(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Ve(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function An(e,t,n,o){let r=0;for(let s=t,i=n-o;s<n;s+=o)r+=(e[i]-e[s])*(e[s+1]+e[i+1]),i=s;return r}var Q=class e{static area(t){let n=t.length,o=0;for(let r=n-1,s=0;s<n;r=s++)o+=t[r].x*t[s].y-t[s].x*t[r].y;return o*.5}static isClockWise(t){return e.area(t)<0}static triangulateShape(t,n){let o=[],r=[],s=[];mt(t),xt(o,t);let i=t.length;n.forEach(mt);for(let c=0;c<n.length;c++)r.push(i),i+=n[c].length,xt(o,n[c]);let a=pt.triangulate(o,r);for(let c=0;c<a.length;c+=3)s.push(a.slice(c,c+3));return s}};function mt(e){let t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function xt(e,t){for(let n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}import{Matrix4 as Sn}from"three";import{Matrix4 as Et}from"three";var k=new Et,F={index:0,glass:!1};function G(e,t,n=1){return e.transform?.forEach(o=>{"rotateX"in o?t.premultiply(k.makeRotationX(de(o.rotateX))):"rotateY"in o?t.premultiply(k.makeRotationY(de(o.rotateY))):"rotateZ"in o?t.premultiply(k.makeRotationZ(de(o.rotateZ))):t.premultiply(k.makeTranslation(o.moveX*n,o.moveY,o.moveZ))}),t}function gt(e,t,n){let{x:o,y:r,z:s}=e;if(o===0||r===0||s===0)return;let i=n?.5:0,a=new Et().makeTranslation(i,0,.5);return o<0&&(n&&a.premultiply(k.makeTranslation(-1,0,0)),o=-o),r<0&&(r=-r),s<0&&(a.premultiply(k.makeTranslation(0,0,-1)),s=-s),a.premultiply(k.makeScale(o*t,r,s)),{matrix:G(e,a,t),color:e.color||[F]}}function ze(e,t,n){return"x"in e?gt(e,n,!1):gt({x:t-e.shrink,y:e.width,z:e.height,transform:e.transform,color:e.color},n,!0)}function Tt(e,t,n,o){e.forEach(r=>{let{color:s,height:i,overhang:a,elevation:c}=r,{min:l,max:p}=t,f=B(s,o)||F,u=new Sn().makeScale(p.x-l.x+a*2,p.y-l.y+a*2,Math.abs(i));G(r,u).premultiply(k.makeTranslation(l.x-a,l.y-a,c));let y=n.data[f.glass?"slopingGlass":"sloping"];y.matrices.push(u.toArray()),y.colors.push(f.index)})}import{Matrix4 as On}from"three";function bt(e,t,n,o){e.forEach(r=>{let{color:s,height:i,elevation:a}=r,{min:c,max:l}=t,p=B(s,o)||F,f=new On().makeTranslation(.5,.5,.5);i<0&&f.premultiply(k.makeTranslation(0,0,-1)),f.premultiply(k.makeScale(l.x-c.x,l.y-c.y,Math.abs(i))),G(r,f).premultiply(k.makeTranslation(c.x,c.y,a));let u=n.data[p.glass?"boxGlass":"box"];u.matrices.push(f.toArray()),u.colors.push(p.index)})}import{Matrix4 as Pn}from"three";function Mt(e,t,n,o){e.forEach(r=>{_n(n.data,In(t,r.padding),r,o)})}function In(e,t){if(t){let{start:n,middle:o,end:r,asRatio:s}=t;return e.map(i=>i.map(a=>{let c=Object.assign({split:{}},a),l=a.direction,p=l.length(),f=a.start.clone(),u=a.end.clone(),y=f,h=u,x=0,d=0,m=0;if(o>0?(d=s?o*p:o,x=m=(p-d)/2):(x=s?n*p:n,m=s?r*p:r,d=p-x-m),x!==0){let b=l.clone().setLength(x);y=f.clone().add(b),c.split.startRay={start:f,end:y,direction:b}}if(m!==0){let b=l.clone().setLength(m);h=u.clone().add(b.clone().negate()),c.split.endRay={start:h,end:u,direction:b}}return d!==0&&(c.split.middleRay={start:y,end:h,direction:l.clone().setLength(d)}),c}))}else return e.map(n=>n.map(o=>Object.assign({split:{middleRay:o}},o)))}function _n(e,t,n,o){let{proto:r,elevation:s}=n;r?.forEach(i=>{let{area:a}=i;if(a==="MIDDLE")t.forEach(c=>c.forEach(l=>Ge(i,e,s,o,l.split.middleRay)));else{let c=a==="BOTH"||a==="START",l=a==="BOTH"||a==="END";t.forEach(p=>{c&&p.forEach(f=>Ge(i,e,s,o,f.split.startRay)),l&&p.forEach(f=>Ge(i,e,s,o,f.split.endRay))})}})}function Ge(e,t,n,o,r){if(r){let{start:s,direction:i}=r,{spacing:a,divide:c,first:l,last:p,lastWidth:f}=e,u=i.length(),y=[];if(a){let h=[];a.forEach(d=>{for(let m=-1;m<d.repeat;m++)h.push(d.space)});let x=xe(h,u,f);if(x){let{ratio:d,count:m}=x,b=[];a.forEach(T=>{let g;T.group&&(g=[],T.group.forEach(R=>{let O=ze(R,T.space,d);O&&g.push(O)}));let M=T.control;for(let R=-1;R<T.repeat;R++)b.push({model:g,control:M,space:T.space*d})}),vt(b,m,t,n,i,s,l,p,o)}}c&&c.map(h=>{let x=u/h.count,d=xe([x],u,f);if(d){let{ratio:m,count:b}=d;x*=m;let T=[];h.group.forEach(g=>{let M=ze(g,x,m);M&&T.push(M)}),y=[{model:T,control:h.control,space:x*m}],vt(y,b,t,n,i,s,l,p,o)}})}}function vt(e,t,n,o,r,s,i,a,c){let l=0,p=new Pn().makeRotationZ(r.angle()).premultiply(k.makeTranslation(s.x,s.y,o)),f=e[0];for(let u=0;u<t;u++)e.forEach(y=>{(u||i)&&oe(u,c,y.control)&&Rt(y,l,p,c,n),l+=y.space});a&&f&&Rt(f,l,p,c,n)}function Rt(e,t,n,o,r){e.model?.forEach(s=>{let i=s.matrix.clone().premultiply(k.makeTranslation(t,0,0)).premultiply(n),a=B(s.color,o)||F,c=r[a.glass?"boxGlass":"box"];c.matrices.push(i.toArray()),c.colors.push(a.index)})}import{Vector2 as kt,Matrix4 as pe}from"three";function Cn(e){let t=[],n=e[0];if(n){t.push(n);for(let o=1;o<e.length;o++){let r=e[o];if(r.pairs.length!==n.pairs.length)n=r,t.push(n);else if(n.pairs.find((i,a)=>{let c=r.pairs[a];return!(c&&Math.abs(i.width-c.width)<1&&Math.abs(i.center.x-c.center.x)<1)}))n=r,t.push(n);else{n.width+=r.width,n.height=(n.height+r.height)/2,n.elevation=(n.elevation+r.elevation)/2;let i=r.width/2;n.pairs.forEach(a=>{a.center.y+=i})}}}return t}function Ze(e,t,n,o,r=!1){e.forEach(s=>{let{along:i,flexes:a,elevation:c,sandwich:l}=s,{newRays:p,radian:f}=He(t.flat(),o,i),u=De(p,a,c,l);if(r&&(u=Cn(u)),!u)return;let y=0;u.forEach(O=>y+=O.width);let h=0,x=y,d=0,m=y,b=s.top?.padding,T=s.bottom?.padding;(T||b)&&(b&&(h=y*b.start,x=y*(1-b.end)),T&&(d=y*T.start,m=y*(1-T.end)));let g=x-h,M=m-d,R=0;u.forEach((O,I)=>{if(oe(I,o,s.control)){let{width:_,pairs:C}=O,{height:S,elevation:Z}=O,j=0;if(S<0&&(j=S,S=-S),S>0){if(R+=_/2,s.top&&g>0){let{like:W,ratio:K}=s.top;if(h<R&&R<x){let ie=W==="HILL"?1-Math.sin((R-h)/g*Math.PI):W==="VALLEY"?Math.sin((R-h)/g*Math.PI):A(o);S*=1-K*ie}}if(s.bottom&&M>0){let{like:W,ratio:K}=s.bottom;if(d<R&&R<m){let ie=W==="TUNNEL"?Math.sin((R-d)/M*Math.PI):A(o),ae=S*K*ie;Z+=ae,S-=ae}}R+=_/2;let D=new pe().makeRotationZ(-f);C.forEach(W=>{let K=B(O.color,o)||F,ie=G(O,new pe().makeScale(W.width,_,S)).premultiply(k.makeTranslation(W.center.x,W.center.y,Z+j+S/2)).premultiply(D),ae=n.data[K.glass?"boxGlass":"box"];ae.matrices.push(ie.toArray()),ae.colors.push(K.index)})}else R+=_}})})}function Nt(e,t,n,o){e.forEach(r=>{let{flex:s,count:i,depthRatio:a,widthRatio:c,heightRatio:l,along:p,elevation:f}=r,{newRays:u,radian:y}=He(t.flat(),o,p),h=De(u,[s],f,!1);if(!h)return;let x=Y(o,...i);if(h.length>0){let d=[];for(let b=0;b<x;b++){let T=A(o),g=0;T<.2?g=Math.floor(h.length*A(o)):T<.6?g=Math.floor(h.length*Y(o,0,.2,.02)):g=Math.floor(h.length*Y(o,.8,1,.02));let M=h[g];if(M){let R=Math.floor(M.pairs.length*A(o)),O=Math.floor(h.length*Y(o,...a)),I=Ln(h,g,R,O);I&&d.push({matchDataIndex:g,props:I})}}d.sort((b,T)=>b.props.w*b.props.d-T.props.w*T.props.d);let m=(l[1]-l[0])/d.length;d.forEach((b,T)=>{let{props:g,matchDataIndex:M}=b,R=h[M];if(R){let O=s.height;if(g.d>0){let I=g.w*Y(o,...c,.05),_=g.w-I,C=A(o);C<.2?_*=.2-Y(o,0,.4,.02):C<.6?_*=.5-Y(o,0,.2,.02):_*=Y(o,0,.2,.02)-.5;let S=Math.round(10*(A(o)-.5))*.2;O*=1-T*m;let Z=new pe().premultiply(k.makeScale(I,g.d,O));Z=G(R,Z).premultiply(k.makeTranslation(g.x+_,g.y+S,f+O/2)).premultiply(k.makeRotationZ(-y));let j=B(R.color,o)||F,D=n.data[j.glass?"boxGlass":"box"];D.matrices.push(Z.toArray()),D.colors.push(j.index)}}})}})}function At(e,t,n,o){e.forEach(r=>{let{boxes:s,place:i,count:a,elevation:c}=r,l=i==="EDGE";for(let p=0;p<a;p++){let f=l?Hn(t,o):Dn(t,o);f&&s.forEach(u=>{let y=B(u.color,o)||F,h=new pe().makeTranslation(0,0,.5).premultiply(k.makeScale(u.x,u.y,u.z));G(u,h).premultiply(k.makeTranslation(f.x,f.y,c));let x=n.data[y.glass?"boxGlass":"box"];x.matrices.push(h.toArray()),x.colors.push(y.index)})}})}function Dn(e,t){let n={min:1/0,max:-1/0};e[0]?.forEach(i=>{n.min=Math.min(n.min,i.start.y),n.max=Math.max(n.max,i.start.y)});let o=n.min+A(t)*(n.max-n.min),r=Ce(o,e.flat()),s=r[Math.floor(A(t)*r.length)];return s?new kt(s[0].x+(s[1].x-s[0].x)*A(t),o):void 0}function Hn(e,t){let n=e[0];if(n){let o=B(n,t);if(o){let{start:r,end:s}=o,i=A(t);return new kt(r.x+(s.x-r.x)*i,r.y+(s.y-r.y)*i)}}}function Ln(e,t,n,o){let r=e[t]?.pairs[n];if(r){let{center:s,width:i}=r,a={xLeftMin:s.x-i/2,xRightMax:s.x+i/2,centerMinY:s.y,centerMaxY:s.y};return wt(e,t,1,o,a),wt(e,t,-1,o,a),{w:a.xRightMax-a.xLeftMin,d:a.centerMaxY-a.centerMinY,x:(a.xLeftMin+a.xRightMax)/2,y:(a.centerMinY+a.centerMaxY)/2}}}function wt(e,t,n,o,r){let s=!0;for(;o>0&&s;)s=!1,t+=n,e[t]?.pairs.forEach(i=>{let{center:a,width:c}=i,l=a.x-c/2,p=a.x+c/2;p<=r.xLeftMin||l>=r.xRightMax||(r.xLeftMin<l&&(r.xLeftMin=l),r.xRightMax>p&&(r.xRightMax=p),n>0?r.centerMaxY=a.y:r.centerMinY=a.y,s=!0,o--)})}function St(e,t,n,o,r){e.forEach(s=>{let{color:i,transform:a,height:c,thickness:l,elevation:p}=s,f=B(i,o)||F,u=new pe;if(l){let y=l<0?-.5:.5,h=c<0?-.5:.5,x=n.data[f.glass?"boxGlass":"box"];t.forEach(d=>{d.forEach(m=>{let b=u.clone();b.premultiply(k.makeTranslation(.5,y,h)).premultiply(k.makeScale(m.direction.length(),Math.abs(l),Math.abs(c))).premultiply(k.makeRotationZ(m.direction.angle())),G(s,b).premultiply(k.makeTranslation(m.start.x,m.start.y,p)),x.matrices.push(b.toArray()),x.colors.push(f.index)})})}else Ze([{along:"WIDTH",flexes:[{shrink:0,width:r,height:c,transform:a,color:i}],elevation:p,sandwich:!1,top:void 0,bottom:void 0,control:void 0}],t,n,o,!0)})}import{Vector2 as Ot,Matrix3 as Bn}from"three";function Pt(e,t,n,o){let r=o?new Bn().makeRotation(o):void 0,s=n.asRatio?{x:t.x*n.x,y:t.y*n.y}:{x:n.x,y:n.y};return e.map(i=>{let a=[];return i.forEach((c,l)=>{let p=i[l===0?i.length-1:l-1],f={start:p.start,end:p.end,direction:p.end.clone().sub(p.start)},u=rt(_e(c,s),_e(f,s));u&&a.push(r?u.applyMatrix3(r):u)}),a.map((c,l)=>{let p=a[l===a.length-1?0:l+1];return{start:c,end:p,direction:p.clone().sub(c)}})})}function It(e,t){return e.map(n=>{let o=[];return t.forEach(r=>{let{min:s,max:i}=r,a=new Ot(s.x,i.y),c=new Ot(i.x,s.y),l={min:s,max:i,lines:[{start:s,end:a},{start:a,end:i},{start:i,end:c},{start:c,end:s}]};n.forEach(p=>{let f=ot(p,l);if(f){let{start:u,end:y}=f;o.push({start:u,end:y,direction:y.clone().sub(u)})}})}),o})}var Me=class{seed;styleParams;area;center;relative;orignal;constructor(t){this.orignal=t.loops.map(o=>o.map(r=>new he(...r)));let n=this.orignal[0];if(n&&n.length>2){Q.isClockWise(n)&&n.reverse(),this.area=Q.area(n);for(let l=1;l<this.orignal.length;l++){let p=this.orignal[l];Q.isClockWise(p)||p.reverse(),this.area-=Q.area(p)}let o=new he;n.forEach((l,p)=>{let f=n[p+1===n.length?0:p+1],u=new he().subVectors(f,l);u.length()>o.length()&&o.copy(u)});let r=new he(0,0),s=o.angle();this.center=Vn(n);let i=this.orignal.map(l=>l.map(p=>p.sub(this.center).rotateAround(r,-s))),{min:a,max:c}=te(i[0]);this.relative={radian:s,bounds:{min:a,max:c},size:{x:c.x-a.x,y:c.y-a.y},rays:i.map(l=>l.map((p,f)=>{let u=l[f+1===l.length?0:f+1],y=u.clone().sub(p);return{start:p,end:u,direction:y}}))}}else throw"ERROR: invalid input.loops";this.styleParams=Object.assign({style:"",height:24,floorHeight:3,elevation:0,seed:0,matchSpacing:2},t.params),this.seed=new ge(this.styleParams.seed)}getEdges(t,n,o,r){let s=this.relative.rays[0],i=o?[s]:this.relative.rays,{min:a,max:c}=te(s.map(p=>p.start)),l={x:c.x-a.x,y:c.y-a.y};if(t.set?.forEach(p=>{if(p.offset)i=Pt(i,l,p.offset);else if(p.clamp){let f=te(s.map(y=>y.start)),u=Un(f,p.clamp);i=It(i,u)}else if(p.along){let f=p.along;switch(f){case"WIDTH":i=i.map(u=>u.filter(y=>ne(y.direction.angle()))).filter(u=>u.length>0);break;case"DEPTH":i=i.map(u=>u.filter(y=>!ne(y.direction.angle()))).filter(u=>u.length>0);break;case"RANDOM":i=i.map(u=>u.filter(()=>A(n)<1)).filter(u=>u.length>0);break;case"SHORTEST":case"LONGEST":{let u=s.reduce((y,h)=>y.direction.length()>h.direction.length()?y:h);i=f==="LONGEST"?i.map(y=>y.filter(h=>ne(h.direction.angleTo(u.direction)))):i.map(y=>y.filter(h=>!ne(h.direction.angleTo(u.direction))))}break;default:i=i.map(u=>u.filter(y=>Math.abs(y.direction.angle()-f)<10*(Math.PI/180))).filter(u=>u.length>0);break}}}),r){let p=new Fn().makeRotation(r);i.forEach(f=>f.forEach(u=>{u.direction.applyMatrix3(p),u.start.applyMatrix3(p),u.end.applyMatrix3(p)}))}return i}toModel(t,n,o,r){let{colorMap:s,models:i}=t,a=n.parseStyle(this.styleParams,this.seed,r);a.colorMap.forEach(p=>{s.includes(p)||s.push(p)});let c={info:{floorArea:this.area,floors:a.floorCount},points:this.relative.rays.map(p=>p.map(f=>f.start.toArray())),center:this.center.toArray(),centerRelative:[this.center.x-o.x,this.center.y-o.y],params:this.styleParams,rotate:this.relative.radian,data:{box:{matrices:[],colors:[]},boxGlass:{matrices:[],colors:[]},sloping:{matrices:[],colors:[]},slopingGlass:{matrices:[],colors:[]}}},l=this.seed;return a.classified.forEach(p=>{let f=this.getEdges(p.edgeParams,l,!0);if(f[0]&&f[0].length>0){let u=te(f[0].map(y=>y.start));St(p.extrude,f,c,l,this.styleParams.matchSpacing||2),Ze(p.match,f,c,l),Mt(p.facade,f,c,l),Nt(p.boxInside,f,c,l),At(p.adjunct,f,c,l),bt(p.clampBox,u,c,l),Tt(p.slopingRoof,u,c,l)}}),i.push(c),c}};function Un(e,t){let n=e.min.clone(),o=e.max.clone(),r=o.x-n.x,s=o.y-n.y,{xMin:i,xMax:a,yMin:c,yMax:l,xCentral:p,yCentral:f,asRatio:u,reverse:y}=t,h=[{min:n,max:o}];return _t(h,"x",r,p,i,a,u,y),_t(h,"y",s,f,c,l,u,y),h}function _t(e,t,n,o,r,s,i,a){let c=[];if(o){let l=i?o*n:o;if(l>0){let p=(n-l)/2;p&&e.forEach(f=>{if(a){let u={min:f.min.clone(),max:f.max.clone()};f.max[t]=f.min[t]+p,u.min[t]=u.max[t]-p,c.push(u)}else f.min[t]+=p,f.max[t]-=p})}}else if(r||s){let l=r?i?r*n:r:0,p=s?i?s*n:s:0;e.forEach(f=>{if(a)if(l&&p){let u={min:f.min.clone(),max:f.max.clone()};c.push(u),f.max[t]=f.min[t]+l,u.min[t]=u.max[t]-p}else l?f.max[t]=f.min[t]+l:p&&(f.min[t]=f.max[t]-p);else f.min[t]+=l,f.max[t]-=p})}e.push(...c)}function Vn(e){let t=[0,0];return e.forEach(n=>{t[0]+=n.x,t[1]+=n.y}),t[0]/=e.length,t[1]/=e.length,new he(...t)}var Ct={preset:{"\u8BA2\u9605\u5C4B\u9876\u968F\u673A\u8BBE\u5907<\u9AD8\u5EA6,\u62AC\u5347><\u989C\u8272A,\u989C\u8272B>":{unit:{\u9AD8\u5EA6:2,\u62AC\u5347:0},color:{\u989C\u8272A:"#eee",\u989C\u8272B:["#666","#333"]},floor:[{floorNumber:1,setEdges:[{offset:{x:.1,y:.1,asRatio:!0}}],match:[{flexes:[{width:2},{width:4,height:"1\u9AD8\u5EA6",color:"\u989C\u8272A",transform:[{moveZ:"1\u62AC\u5347"}]}],control:{chance:.8},along:"WIDTH",sandwich:!0},{flexes:[{width:1},{width:2,height:"0.5\u9AD8\u5EA6",color:"\u989C\u8272B",transform:[{moveZ:"1\u62AC\u5347"}]}],control:{chance:.2},along:"DEPTH",sandwich:!0}]}]},"\u8BA2\u9605\u5C4B\u9876\u5973\u513F\u5899<\u9AD8\u5EA6,\u539A\u5EA6,\u7F29\u8FDB,\u62AC\u5347><\u989C\u8272>":{unit:{\u9AD8\u5EA6:1.5,\u539A\u5EA6:.2,\u7F29\u8FDB:0,\u62AC\u5347:0},color:{\u989C\u8272:"#fff"},floor:[{setEdges:[{offset:"1\u7F29\u8FDB"}],extrude:[{height:"1\u9AD8\u5EA6",thickness:"1\u539A\u5EA6",color:"\u989C\u8272",transform:[{moveZ:"1\u62AC\u5347"}]}]}]},"\u8BA2\u9605\u4E2D\u6BB5\u968F\u673A\u5782\u76F4\u5899\u677F<\u5899\u5BBD,\u7A97\u5BBD,\u964D\u4F4E,\u6982\u7387><\u5899\u677F>":{unit:{\u5899\u5BBD:4,\u7A97\u5BBD:2,\u964D\u4F4E:0,\u6982\u7387:.8},color:{\u5899\u677F:"#eee"},floor:[{extrude:[{once:!0,height:"1SH-1\u964D\u4F4E",color:"G"}],facade:[{once:!0,proto:[{last:!0,lastWidth:"1\u5899\u5BBD",spacing:[{control:{chance:"1\u6982\u7387"},space:"1\u5899\u5BBD+1\u7A97\u5BBD",group:[{x:"1\u5899\u5BBD",y:.2,z:"1SH-1\u964D\u4F4E",color:"\u5899\u677F",transform:[{moveX:"0.5\u5899\u5BBD"}]}]}]}]}]}]},"\u8BA2\u9605\u5E95\u90E8\u89D2\u67F1A<\u67F1\u5BBD\u6BD4\u4F8B,\u539A\u5EA6,\u964D\u4F4E><\u89D2\u67F1,\u67F1\u5B50,\u697C\u677F,\u95E8,\u6311\u6A90>":{unit:{\u67F1\u5BBD\u6BD4\u4F8B:.2,\u539A\u5EA6:.6,\u964D\u4F4E:0},color:{\u89D2\u67F1:"#bbb",\u67F1\u5B50:"#bbb",\u697C\u677F:"#666",\u95E8:"#666",\u6311\u6A90:"#666"},floor:[{facade:[{once:!0,padding:{start:"1\u67F1\u5BBD\u6BD4\u4F8B",end:"1\u67F1\u5BBD\u6BD4\u4F8B"},proto:[{area:"BOTH",divide:[{count:1,group:[{width:"2\u539A\u5EA6",height:"1SH-1\u964D\u4F4E",color:"\u89D2\u67F1"}]}]},{area:"MIDDLE",divide:[{count:1,group:[{width:"1.6\u539A\u5EA6",height:"0.2*(1SH-1\u964D\u4F4E)",color:"\u697C\u677F",transform:[{moveZ:"0.8*(1SH-1\u964D\u4F4E)"}]}]}]},{first:!1,spacing:[{space:4,group:[{x:1,y:"1\u539A\u5EA6",z:"0.8*(1SH-1\u964D\u4F4E)",color:"\u67F1\u5B50",transform:[{moveY:"0.5\u539A\u5EA6-0.2"}]}]}]},{spacing:[{control:{chance:.2},space:4,group:[{x:1.6,y:.2,z:3,color:"\u95E8",transform:[{moveX:2}]},{x:4,y:2,z:.2,color:"\u6311\u6A90",transform:[{moveX:2,moveZ:3}]}]}]}]}]},{floorRange:[{bottom:1}],extrude:[{height:-1,color:"\u697C\u677F"}]},{setEdges:[{offset:"0.5\u539A\u5EA6+0.3"}],facade:[{once:!0,proto:[{divide:[{count:1,group:[{width:1,height:"1SH-1\u964D\u4F4E-1",color:"G"}]}]}]}]}]},"\u8BA2\u9605\u5E95\u90E8\u7ACB\u9762A<\u95F4\u8DDD,\u67F1\u5BBD,\u683C\u5BBD,\u964D\u4F4E><\u67F1,\u683C,\u697C\u677F,\u95E8,\u6311\u6A90>":{unit:{\u95F4\u8DDD:8,\u67F1\u5BBD:3,\u683C\u5BBD:.4,\u964D\u4F4E:1},color:{\u67F1:"#eee",\u683C:"#fff",\u697C\u677F:"#bbb",\u95E8:"#666",\u6311\u6A90:"#666"},floor:[{extrude:[{once:!0,height:"1SH-1\u964D\u4F4E",color:"G"}],facade:[{once:!0,proto:[{last:!0,lastWidth:"1\u67F1\u5BBD",spacing:[{space:"1\u67F1\u5BBD+(1\u95F4\u8DDD-1\u67F1\u5BBD)/4",group:[{x:"1\u67F1\u5BBD",y:.6,z:"1SH-1\u964D\u4F4E",color:"\u67F1",transform:[{moveX:"1\u67F1\u5BBD/2"}]}]},{space:"(1\u95F4\u8DDD-1\u67F1\u5BBD)/4",group:[{x:"1\u683C\u5BBD",y:1,z:"1SH-1FH+1-1\u964D\u4F4E",color:"\u683C",transform:[{moveZ:"1FH-1"}]}],repeat:2}]},{lastWidth:"1\u67F1\u5BBD",spacing:[{control:{chance:.2},space:"1\u95F4\u8DDD",group:[{x:"1\u95F4\u8DDD",y:3,z:.2,color:"\u6311\u6A90",transform:[{moveX:"0.5\u95F4\u8DDD+0.5\u67F1\u5BBD",moveY:.5,moveZ:3.1}]},{x:.8,y:.2,z:3,color:"\u95E8",transform:[{moveX:"0.5\u95F4\u8DDD+0.5\u67F1\u5BBD-0.4"}]},{x:.8,y:.2,z:3,color:"\u95E8",transform:[{moveX:"0.5\u95F4\u8DDD+0.5\u67F1\u5BBD+0.4"}]}]}]}]}]},{setEdges:[{offset:-.2}],floorRange:[{bottom:1}],extrude:[{height:-1,color:"\u697C\u677F"}]},{setEdges:[{offset:{x:.2,y:.2,asRatio:!0}}],extrude:[{once:!0,height:"1SH"}]}]},"\u8BA2\u9605\u5E95\u90E8\u683C\u6805A<\u95F4\u8DDD,\u67F1\u5BBD,\u683C\u5BBD,\u964D\u4F4E><\u6D45\u8272,\u6DF1\u8272,\u95E8,\u6311\u6A90>":{unit:{\u95F4\u8DDD:8,\u67F1\u5BBD:3,\u683C\u5BBD:.4,\u964D\u4F4E:1},color:{\u6D45\u8272:"#eee",\u6DF1\u8272:"#bbb",\u95E8:"#666",\u6311\u6A90:"#666"},floor:[{extrude:[{once:!0,height:"1SH-1\u964D\u4F4E",color:"G"}],facade:[{once:!0,proto:[{last:!0,spacing:[{space:1,group:[{x:.1,y:.6,z:"1SH-1.6",color:"\u6DF1\u8272",transform:[{moveZ:.6}]}]}]},{divide:[{count:1,group:[{width:.2,height:.6,color:"\u6DF1\u8272"}]}]},{lastWidth:"1\u67F1\u5BBD",spacing:[{control:{chance:.2},space:"1\u95F4\u8DDD",group:[{x:.8,y:1,z:3,color:"\u95E8",transform:[{moveX:"0.5\u95F4\u8DDD+0.5\u67F1\u5BBD-0.4"}]},{x:.8,y:1,z:3,color:"\u95E8",transform:[{moveX:"0.5\u95F4\u8DDD+0.5\u67F1\u5BBD+0.4"}]}]}]}]}]},{floorRange:[{bottom:1}],extrude:[{height:-1,color:"\u6D45\u8272"}]}]}},building:{}};var Dt={preset:{"\u514D\u8D39\u5C4B\u9876\u5973\u513F\u5899<\u7F29\u8FDB,\u9AD8\u5EA6,\u539A\u5EA6,\u62AC\u5347><\u989C\u8272>":{unit:{\u7F29\u8FDB:0,\u9AD8\u5EA6:1.2,\u539A\u5EA6:.2,\u62AC\u5347:0},color:{\u989C\u8272:"#eee"},floor:[{setEdges:[{offset:"1\u7F29\u8FDB"}],extrude:[{height:"1\u9AD8\u5EA6",thickness:"1\u539A\u5EA6",color:"\u989C\u8272",transform:[{moveZ:"1\u62AC\u5347"}]}]}]},"\u514D\u8D39\u4E2D\u6BB5<\u697C\u677F\u7F29\u8FDB,\u677F\u539A>":{unit:{\u697C\u677F\u7F29\u8FDB:.5,\u677F\u539A:.6},floor:[{setEdges:[{offset:-.4}],extrude:[{once:!0,height:"-1\u677F\u539A",transform:[{moveZ:"1SH"}]},{once:!0,height:"-1\u677F\u539A"}]},{setEdges:[{offset:"1\u697C\u677F\u7F29\u8FDB"}],extrude:[{height:"-1\u677F\u539A"}]},{extrude:[{once:!0,height:"1SH-1\u677F\u539A",color:"G"}]}]},"\u514D\u8D39\u4E2D\u6BB5\u7AD6\u5411<\u67F1\u5BBD,\u95F4\u8DDD,\u697C\u677F\u7F29\u8FDB>":{unit:{\u67F1\u5BBD:1,\u95F4\u8DDD:4,\u697C\u677F\u7F29\u8FDB:.5},floor:[{setEdges:[{offset:"1\u697C\u677F\u7F29\u8FDB"}],floorRange:[{top:-1}],extrude:[{height:-.6}]},{extrude:[{once:!0,height:"1SH-0.6",color:"G"}],facade:[{once:!0,proto:[{spacing:[{space:"1\u95F4\u8DDD",group:[{x:"1\u67F1\u5BBD",y:"1\u67F1\u5BBD",z:"1SH"}]}]}]}]}]},"\u514D\u8D39\u4E2D\u6BB5\u968F\u673A\u5782\u76F4\u5899\u677F<\u5899\u5BBD,\u7A97\u5BBD,\u6982\u7387><\u5899\u677F>":{unit:{\u5899\u5BBD:4,\u7A97\u5BBD:2,\u6982\u7387:.8},color:{\u5899\u677F:"#eee"},floor:[{extrude:[{once:!0,height:"1SH",color:"G"}],facade:[{once:!0,proto:[{last:!0,lastWidth:"1\u5899\u5BBD",spacing:[{control:{chance:"1\u6982\u7387"},space:"1\u5899\u5BBD+1\u7A97\u5BBD",group:[{x:"1\u5899\u5BBD",y:.5,z:"1SH",color:"\u5899\u677F",transform:[{moveX:"0.5\u5899\u5BBD"}]}]}]}]}]}]},"\u514D\u8D39\u5E95\u90E8\u52A0\u6838\u5FC3\u7B52<\u697C\u677F\u7F29\u8FDB,\u677F\u539A>":{unit:{\u697C\u677F\u7F29\u8FDB:.5,\u677F\u539A:1.2},floor:[{setEdges:[{offset:"1\u697C\u677F\u7F29\u8FDB"}],floorRange:[{bottom:1,top:-1}],extrude:[{height:"-1\u677F\u539A"}]},{extrude:[{once:!0,height:"1SH-1\u677F\u539A",color:"G"}]},{setEdges:[{offset:{x:.1,y:.2,asRatio:!0}}],extrude:[{once:!0,height:"1BH+4"}]}]},"\u514D\u8D39\u5E95\u90E8\u7AD6\u5411\u52A0\u6838\u5FC3\u7B52<\u67F1\u5BBD,\u7A97\u5BBD,\u697C\u677F\u7F29\u8FDB,\u677F\u539A,\u964D\u4F4E>":{unit:{\u67F1\u5BBD:1,\u7A97\u5BBD:2,\u697C\u677F\u7F29\u8FDB:.5,\u677F\u539A:1.2,\u964D\u4F4E:0},floor:[{setEdges:[{offset:"1\u697C\u677F\u7F29\u8FDB"}],floorRange:[{bottom:1,top:-1}],extrude:[{height:"-1\u677F\u539A"}]},{extrude:[{once:!0,height:"1SH-1\u677F\u539A",color:"G"}],facade:[{once:!0,proto:[{spacing:[{space:"1\u67F1\u5BBD+1\u7A97\u5BBD",group:[{x:"1\u67F1\u5BBD",y:"1\u67F1\u5BBD",z:"1SH-1\u964D\u4F4E"}]}]}]}]},{setEdges:[{offset:{x:.1,y:.2,asRatio:!0}}],extrude:[{once:!0,height:"1BH+4"}]}]},"\u514D\u8D39\u5E95\u90E8\u9A6C\u8D5B\u514B\u52A0\u6838\u5FC3\u7B52<\u6982\u7387><\u9A6C\u8D5B\u514B>":{color:{\u9A6C\u8D5B\u514B:["#888","#fff"]},unit:{\u964D\u4F4E:0,\u6982\u7387:.8},floor:[{extrude:[{once:!0,height:"1SH",color:"G"}],facade:[{proto:[{last:!0,lastWidth:4,spacing:[{control:{chance:"1\u6982\u7387"},space:6,group:[{x:4,y:.5,z:"1FH-0.6",color:"\u9A6C\u8D5B\u514B",transform:[{moveX:2}]}]}]}]}]},{floorRange:[{top:-1,bottom:1}],extrude:[{height:-.6}]},{setEdges:[{offset:{x:.1,y:.2,asRatio:!0}}],extrude:[{once:!0,height:"1BH+4"}]}]},"\u514D\u8D39\u5E95\u90E8\u6311\u5ECA\u52A0\u6838\u5FC3\u7B52<\u7F29\u8FDB>":{unit:{\u7F29\u8FDB:3},floor:[{floorRange:[{bottom:1}],extrude:[{height:-.6},{height:1,color:"G"}]},{setEdges:[{offset:.4}],facade:[{once:!0,proto:[{spacing:[{space:4,group:[{x:1,y:1,z:"1SH-0.6"}]}]}]}]},{setEdges:[{offset:"1\u7F29\u8FDB"}],extrude:[{once:!0,height:"1SH",color:"G"}]},{setEdges:[{offset:{x:.1,y:.2,asRatio:!0}}],extrude:[{once:!0,height:"1BH+4"}]}]},"\u514D\u8D39\u5E95\u90E8\u5BBD\u89D2\u67F1\u52A0\u6838\u5FC3\u7B52<\u539A\u5EA6,\u964D\u4F4E><\u6D45\u8272,\u6DF1\u8272>":{unit:{\u539A\u5EA6:.6,\u964D\u4F4E:0},color:{\u6D45\u8272:"#eee",\u6DF1\u8272:"#999"},floor:[{facade:[{once:!0,padding:{start:.2,end:.2},proto:[{area:"BOTH",divide:[{count:1,group:[{width:"1\u539A\u5EA6",height:"1SH-1\u964D\u4F4E",color:"\u6D45\u8272"}]}]},{area:"MIDDLE",divide:[{count:1,group:[{width:"0.8\u539A\u5EA6",height:"0.4FH",color:"\u6DF1\u8272",transform:[{moveZ:"1SH-0.4FH-1\u964D\u4F4E"}]}]}]}]}]},{setEdges:[{offset:1}],floorRange:[{bottom:1}],extrude:[{height:-1}]},{extrude:[{once:!0,height:"1SH",color:"G"}]},{setEdges:[{offset:{x:.1,y:.2,asRatio:!0}}],extrude:[{once:!0,height:"1BH+4"}]}]}},building:{Random:{type:"FREE",section:{roof:{floor:[{preset:[{key:"\u514D\u8D39\u5C4B\u9876"}]}]},middle:{floor:[{preset:[{key:"\u514D\u8D39\u4E2D\u6BB5"}]}]},bottom:{height:"0.2BH",floorHeight:5,floor:[{preset:[{key:"\u514D\u8D39\u5E95\u90E8"}]}]}}},S0:{type:"FREE",section:{roof:{floor:[{preset:[{name:"\u514D\u8D39\u5C4B\u9876\u5973\u513F\u5899<\u7F29\u8FDB,\u9AD8\u5EA6,\u539A\u5EA6,\u62AC\u5347><\u989C\u8272>",unit:{\u7F29\u8FDB:1}}]}]},middle:{floor:[{preset:[{name:"\u514D\u8D39\u4E2D\u6BB5<\u697C\u677F\u7F29\u8FDB,\u677F\u539A>"}]}]},bottom:{height:"0.2BH",floorHeight:5,floor:[{preset:[{name:"\u514D\u8D39\u5E95\u90E8\u52A0\u6838\u5FC3\u7B52<\u697C\u677F\u7F29\u8FDB,\u677F\u539A>"}]}]}}},S1:{type:"FREE",section:{roof:{floor:[{preset:[{name:"\u514D\u8D39\u5C4B\u9876\u5973\u513F\u5899<\u7F29\u8FDB,\u9AD8\u5EA6,\u539A\u5EA6,\u62AC\u5347><\u989C\u8272>"}]}]},middle:{floor:[{preset:[{name:"\u514D\u8D39\u4E2D\u6BB5<\u697C\u677F\u7F29\u8FDB,\u677F\u539A>"}]}]},bottom:{height:"0.2BH",floorHeight:5,floor:[{preset:[{name:"\u514D\u8D39\u5E95\u90E8\u6311\u5ECA\u52A0\u6838\u5FC3\u7B52<\u7F29\u8FDB>"}]}]}}},S2:{type:"FREE",section:{roof:{floor:[{preset:[{name:"\u514D\u8D39\u5C4B\u9876\u5973\u513F\u5899<\u7F29\u8FDB,\u9AD8\u5EA6,\u539A\u5EA6,\u62AC\u5347><\u989C\u8272>"}]}]},middle:{floor:[{preset:[{name:"\u514D\u8D39\u4E2D\u6BB5<\u697C\u677F\u7F29\u8FDB,\u677F\u539A>"}]}]},bottom:{height:"0.15BH-0.6",floorHeight:5,floor:[{preset:[{name:"\u514D\u8D39\u5E95\u90E8\u5BBD\u89D2\u67F1\u52A0\u6838\u5FC3\u7B52<\u539A\u5EA6,\u964D\u4F4E><\u6D45\u8272,\u6DF1\u8272>"}]}]}}},S3:{type:"FREE",section:{roof:{floor:[{preset:[{name:"\u514D\u8D39\u5C4B\u9876\u5973\u513F\u5899<\u7F29\u8FDB,\u9AD8\u5EA6,\u539A\u5EA6,\u62AC\u5347><\u989C\u8272>",unit:{\u9AD8\u5EA6:2},color:{\u989C\u8272:"#bbb"}}]}]},middle:{floor:[{preset:[{name:"\u514D\u8D39\u4E2D\u6BB5\u7AD6\u5411<\u67F1\u5BBD,\u95F4\u8DDD,\u697C\u677F\u7F29\u8FDB>"}]}]},bottom:{height:"0.1BH",floorHeight:5,floor:[{preset:[{name:"\u514D\u8D39\u5E95\u90E8\u5BBD\u89D2\u67F1\u52A0\u6838\u5FC3\u7B52<\u539A\u5EA6,\u964D\u4F4E><\u6D45\u8272,\u6DF1\u8272>"}]}]}}},S4:{type:"FREE",section:{roof:{floor:[{preset:[{name:"\u514D\u8D39\u5C4B\u9876\u5973\u513F\u5899<\u7F29\u8FDB,\u9AD8\u5EA6,\u539A\u5EA6,\u62AC\u5347><\u989C\u8272>",unit:{\u9AD8\u5EA6:2}}]}]},middle:{floor:[{preset:[{name:"\u514D\u8D39\u4E2D\u6BB5\u7AD6\u5411<\u67F1\u5BBD,\u95F4\u8DDD,\u697C\u677F\u7F29\u8FDB>",unit:{\u95F4\u8DDD:3}}]}]},bottom:{height:"0.2BH",floorHeight:5,floor:[{preset:[{name:"\u514D\u8D39\u5E95\u90E8\u9A6C\u8D5B\u514B\u52A0\u6838\u5FC3\u7B52<\u6982\u7387><\u9A6C\u8D5B\u514B>",color:{\u9A6C\u8D5B\u514B:"#eee"}}]}]}}},S5:{type:"FREE",section:{roof:{floor:[{preset:[{name:"\u514D\u8D39\u5C4B\u9876\u5973\u513F\u5899<\u7F29\u8FDB,\u9AD8\u5EA6,\u539A\u5EA6,\u62AC\u5347><\u989C\u8272>",unit:{\u9AD8\u5EA6:3,\u7F29\u8FDB:-.2,\u62AC\u5347:-1}}]}]},middle:{floor:[{preset:[{name:"\u514D\u8D39\u4E2D\u6BB5\u7AD6\u5411<\u67F1\u5BBD,\u95F4\u8DDD,\u697C\u677F\u7F29\u8FDB>",unit:{\u67F1\u5BBD:1.4,\u7A97\u5BBD:2}}]}]},bottom:{height:"0.15BH",floorHeight:5,floor:[{preset:[{name:"\u514D\u8D39\u5E95\u90E8\u7AD6\u5411\u52A0\u6838\u5FC3\u7B52<\u67F1\u5BBD,\u7A97\u5BBD,\u697C\u677F\u7F29\u8FDB,\u677F\u539A,\u964D\u4F4E>",unit:{\u67F1\u5BBD:1,\u7A97\u5BBD:3}}]}]}}}}};var zn=new re(Ct,Dt),Gn=zn;export{Me as PLAN,re as STYLES,Gn as styles};
/*!
  Magiz
  a light weight 3D building model generator for web
  Copyright (c) 2019-2024 周曦 <453154007@qq.com>
  http://www.architech.fun
  GPL Version 3 license
*/
