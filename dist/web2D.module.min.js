import{Matrix4 as D,Object3D as A,Vector2 as H,Vector3 as y}from"three";var p=class extends A{constructor(r=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=r,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new H(.5,.5),this.addEventListener("removed",function(){this.traverse(function(t){t.element instanceof Element&&t.element.parentNode!==null&&t.element.parentNode.removeChild(t.element)})})}copy(r,t){return super.copy(r,t),this.element=r.element.cloneNode(!0),this.center=r.center,this}},h=new y,v=new D,E=new D,T=new y,M=new y,u=class{constructor(r={}){let t=this,i,o,d,f,g={objects:new WeakMap},c=r.element!==void 0?r.element:document.createElement("div");c.style.overflow="hidden",this.domElement=c,this.getSize=function(){return{width:i,height:o}},this.render=function(e,n){e.matrixWorldAutoUpdate===!0&&e.updateMatrixWorld(),n.parent===null&&n.matrixWorldAutoUpdate===!0&&n.updateMatrixWorld(),v.copy(n.matrixWorldInverse),E.multiplyMatrices(n.projectionMatrix,v),z(e,e,n),_(e)},this.setSize=function(e,n){i=e,o=n,d=i/2,f=o/2,c.style.width=e+"px",c.style.height=n+"px"};function z(e,n,a){if(e.isCSS2DObject){h.setFromMatrixPosition(e.matrixWorld),h.applyMatrix4(E);let s=e.visible===!0&&h.z>=-1&&h.z<=1&&e.layers.test(a.layers)===!0;if(e.element.style.display=s===!0?"":"none",s===!0){e.onBeforeRender(t,n,a);let m=e.element;m.style.transform="translate("+-100*e.center.x+"%,"+-100*e.center.y+"%)translate("+(h.x*d+d)+"px,"+(-h.y*f+f)+"px)",m.parentNode!==c&&c.appendChild(m),e.onAfterRender(t,n,a)}let l={distanceToCameraSquared:O(a,e)};g.objects.set(e,l)}for(let s=0,l=e.children.length;s<l;s++)z(e.children[s],n,a)}function O(e,n){return T.setFromMatrixPosition(e.matrixWorld),M.setFromMatrixPosition(n.matrixWorld),T.distanceToSquared(M)}function W(e){let n=[];return e.traverse(function(a){a.isCSS2DObject&&n.push(a)}),n}function _(e){let n=W(e).sort(function(s,l){if(s.renderOrder!==l.renderOrder)return l.renderOrder-s.renderOrder;let m=g.objects.get(s).distanceToCameraSquared,q=g.objects.get(l).distanceToCameraSquared;return m-q}),a=n.length;for(let s=0,l=n.length;s<l;s++)n[s].element.style.zIndex=a-s}}};var C=400,x=300,S=class{renderer;tags;web3D;constructor(r,t){this.web3D=t,t.playing.animations.renderMagizTags=()=>this.render();let i=document.querySelector(r);if(!i)throw"ERROR: invalid parentCSSID";this.renderer=new u({element:i}),this.tags=[],this.resizeScene(),window.addEventListener("resize",()=>this.resizeScene());let o=document.createElement("style");document.head.appendChild(o),o.innerHTML=`${r}{pointer-events:none;position:fixed;top:0}.magizTag{font-size:small;background:#fff;padding:6px}.magizTag h3{margin:0}.magizTag p{margin:0}`}resizeScene(){let{innerWidth:r,innerHeight:t}=window;this.renderer.setSize(r,t)}render(){if(this.web3D){let r=this.web3D.camera;this.renderer.render(this.web3D.playing.scene,r),this.tags.forEach(t=>{let i=t.position.distanceTo(r.position);i<x?t.element.style.opacity="1":i<C?t.element.style.opacity=(1-(i-x)/(C-x)).toString():t.element.style.opacity="0"})}}refresh(r){this.tags.forEach(i=>i.removeFromParent()),this.tags.length=0;let{web3D:t}=this;t&&r.forEach(i=>{let o=document.createElement("div");o.className="magizTag",o.innerHTML=`<h3>${i.title||""}</h3><p>${i.text||""}</p>`;let d=new p(o);d.position.set(...i.position),d.center.set(.5,.5),t.playing.scene.add(d),this.tags.push(d)})}toggle(r){r?this.tags.forEach(t=>t.layers.set(0)):this.tags.forEach(t=>t.layers.set(1))}};export{S as default};
