var $t=Object.create;var We=Object.defineProperty;var Jt=Object.getOwnPropertyDescriptor;var Kt=Object.getOwnPropertyNames;var Qt=Object.getPrototypeOf,eo=Object.prototype.hasOwnProperty;var $=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var to=(t,e,o,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Kt(e))!eo.call(t,n)&&n!==o&&We(t,n,{get:()=>e[n],enumerable:!(r=Jt(e,n))||r.enumerable});return t};var oo=(t,e,o)=>(o=t!=null?$t(Qt(t)):{},to(e||!t||!t.__esModule?We(o,"default",{value:t,enumerable:!0}):o,t));var Re=$(W=>{"use strict";function we(){return we=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var o=arguments[e];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(t[r]=o[r])}return t},we.apply(this,arguments)}Object.defineProperty(W,"__esModule",{value:!0});var R,je={0:11,1:0,2:3,3:0,4:0,5:0,6:0,7:11,8:11,9:1,10:10,11:0,12:11,13:0,14:-1};W.tokenTypes=void 0,(R=W.tokenTypes||(W.tokenTypes={}))[R.FUNCTION_WITH_ONE_ARG=0]="FUNCTION_WITH_ONE_ARG",R[R.NUMBER=1]="NUMBER",R[R.BINARY_OPERATOR_HIGH_PRECENDENCE=2]="BINARY_OPERATOR_HIGH_PRECENDENCE",R[R.CONSTANT=3]="CONSTANT",R[R.OPENING_PARENTHESIS=4]="OPENING_PARENTHESIS",R[R.CLOSING_PARENTHESIS=5]="CLOSING_PARENTHESIS",R[R.DECIMAL=6]="DECIMAL",R[R.POSTFIX_FUNCTION_WITH_ONE_ARG=7]="POSTFIX_FUNCTION_WITH_ONE_ARG",R[R.FUNCTION_WITH_N_ARGS=8]="FUNCTION_WITH_N_ARGS",R[R.BINARY_OPERATOR_LOW_PRECENDENCE=9]="BINARY_OPERATOR_LOW_PRECENDENCE",R[R.BINARY_OPERATOR_PERMUTATION=10]="BINARY_OPERATOR_PERMUTATION",R[R.COMMA=11]="COMMA",R[R.EVALUATED_FUNCTION=12]="EVALUATED_FUNCTION",R[R.EVALUATED_FUNCTION_PARAMETER=13]="EVALUATED_FUNCTION_PARAMETER",R[R.SPACE=14]="SPACE",W.createTokens=function(t){return[{token:"sin",show:"sin",type:0,value:t.math.sin},{token:"cos",show:"cos",type:0,value:t.math.cos},{token:"tan",show:"tan",type:0,value:t.math.tan},{token:"pi",show:"&pi;",type:3,value:"PI"},{token:"(",show:"(",type:4,value:"("},{token:")",show:")",type:5,value:")"},{token:"P",show:"P",type:10,value:t.math.P},{token:"C",show:"C",type:10,value:t.math.C},{token:" ",show:" ",type:14,value:" ".anchor},{token:"asin",show:"asin",type:0,value:t.math.asin},{token:"acos",show:"acos",type:0,value:t.math.acos},{token:"atan",show:"atan",type:0,value:t.math.atan},{token:"7",show:"7",type:1,value:"7"},{token:"8",show:"8",type:1,value:"8"},{token:"9",show:"9",type:1,value:"9"},{token:"int",show:"Int",type:0,value:Math.floor},{token:"cosh",show:"cosh",type:0,value:t.math.cosh},{token:"acosh",show:"acosh",type:0,value:t.math.acosh},{token:"ln",show:" ln",type:0,value:Math.log},{token:"^",show:"^",type:10,value:Math.pow},{token:"root",show:"root",type:0,value:Math.sqrt},{token:"4",show:"4",type:1,value:"4"},{token:"5",show:"5",type:1,value:"5"},{token:"6",show:"6",type:1,value:"6"},{token:"/",show:"&divide;",type:2,value:t.math.div},{token:"!",show:"!",type:7,value:t.math.fact},{token:"tanh",show:"tanh",type:0,value:t.math.tanh},{token:"atanh",show:"atanh",type:0,value:t.math.atanh},{token:"Mod",show:" Mod ",type:2,value:t.math.mod},{token:"1",show:"1",type:1,value:"1"},{token:"2",show:"2",type:1,value:"2"},{token:"3",show:"3",type:1,value:"3"},{token:"*",show:"&times;",type:2,value:t.math.mul},{token:"sinh",show:"sinh",type:0,value:t.math.sinh},{token:"asinh",show:"asinh",type:0,value:t.math.asinh},{token:"e",show:"e",type:3,value:"E"},{token:"log",show:" log",type:0,value:t.math.log},{token:"0",show:"0",type:1,value:"0"},{token:".",show:".",type:6,value:"."},{token:"+",show:"+",type:9,value:t.math.add},{token:"-",show:"-",type:9,value:t.math.sub},{token:",",show:",",type:11,value:","},{token:"Sigma",show:"&Sigma;",type:12,value:t.math.sigma},{token:"n",show:"n",type:13,value:"n"},{token:"Pi",show:"&Pi;",type:12,value:t.math.Pi},{token:"pow",show:"pow",type:8,value:Math.pow,numberOfArguments:2},{token:"&",show:"&",type:9,value:t.math.and}].map(function(e){return we({},e,{precedence:je[e.type]})})},W.preced=je});var $e=$(pe=>{"use strict";Object.defineProperty(pe,"__esModule",{value:!0});var E=Re();function _(t,e){for(var o=0;o<t.length;o++)t[o]+=e;return t}var G={0:!0,1:!0,3:!0,4:!0,6:!0,8:!0,9:!0,12:!0,13:!0,14:!0},J={0:!0,1:!0,2:!0,3:!0,4:!0,5:!0,6:!0,7:!0,8:!0,9:!0,10:!0,11:!0,12:!0,13:!0},ro={0:!0,3:!0,4:!0,8:!0,12:!0,13:!0},L={},se={0:!0,1:!0,3:!0,4:!0,6:!0,8:!0,12:!0,13:!0},no={1:!0},B=[[],["1","2","3","7","8","9","4","5","6","+","-","*","/","(",")","^","!","P","C","e","0",".",",","n"," ","&"],["pi","ln","Pi"],["sin","cos","tan","Del","int","Mod","log","pow"],["asin","acos","atan","cosh","root","tanh","sinh"],["acosh","atanh","asinh","Sigma"]];function so(t,e,o,r){for(var n=0;n<r;n++)if(t[o+n]!==e[n])return!1;return!0}function qe(t,e){for(var o=0;o<e.length;o++)if(e[o].token===t)return o;return-1}pe.addToken=function(t){for(var e=0;e<t.length;e++){var o=t[e].token.length,r=-1;t[e].type===E.tokenTypes.FUNCTION_WITH_N_ARGS&&t[e].numberOfArguments===void 0&&(t[e].numberOfArguments=2),B[o]=B[o]||[];for(var n=0;n<B[o].length;n++)if(t[e].token===B[o][n]){r=qe(B[o][n],this.tokens);break}r===-1?(this.tokens.push(t[e]),t[e].precedence=E.preced[t[e].type],B.length<=t[e].token.length&&(B[t[e].token.length]=[]),B[t[e].token.length].push(t[e].token)):(this.tokens[r]=t[e],t[e].precedence=E.preced[t[e].type])}},pe.lex=function(t,e){var o,r={value:this.math.changeSign,type:E.tokenTypes.FUNCTION_WITH_ONE_ARG,precedence:4,show:"-"},n={value:")",show:")",type:E.tokenTypes.CLOSING_PARENTHESIS,precedence:0},s={value:"(",type:E.tokenTypes.OPENING_PARENTHESIS,precedence:0,show:"("},i=[s],a=[],c=t,l=G,u=0,f=L,p="";e!==void 0&&this.addToken(e);var m=function(O,N){for(var I,H,A,Z=[],X=N.length,C=0;C<X;C++)if(!(C<X-1&&N[C]===" "&&N[C+1]===" ")){for(I="",H=N.length-C>B.length-2?B.length-1:N.length-C;H>0;H--)if(B[H]!==void 0)for(A=0;A<B[H].length;A++)so(N,B[H][A],C,H)&&(I=B[H][A],A=B[H].length,H=0);if(C+=I.length-1,I==="")throw new Error("Can't understand after "+N.slice(C));Z.push(O.tokens[qe(I,O.tokens)])}return Z}(this,c);for(o=0;o<m.length;o++){var h=m[o];if(h.type!==14){var g,d=h.token,y=h.type,v=h.value,M=h.precedence,w=h.show,b=i[i.length-1];for(g=a.length;g--&&a[g]===0;)if([E.tokenTypes.FUNCTION_WITH_ONE_ARG,E.tokenTypes.BINARY_OPERATOR_HIGH_PRECENDENCE,E.tokenTypes.CONSTANT,E.tokenTypes.OPENING_PARENTHESIS,E.tokenTypes.CLOSING_PARENTHESIS,E.tokenTypes.BINARY_OPERATOR_LOW_PRECENDENCE,E.tokenTypes.BINARY_OPERATOR_PERMUTATION,E.tokenTypes.COMMA,E.tokenTypes.EVALUATED_FUNCTION,E.tokenTypes.EVALUATED_FUNCTION_PARAMETER].indexOf(y)!==-1){if(l[y]!==!0)throw new Error(d+" is not allowed after "+p);i.push(n),l=J,f=se,a.pop()}if(l[y]!==!0)throw new Error(d+" is not allowed after "+p);f[y]===!0&&(y=E.tokenTypes.BINARY_OPERATOR_HIGH_PRECENDENCE,v=this.math.mul,w="&times;",M=3,o-=1);var T={value:v,type:y,precedence:M,show:w,numberOfArguments:h.numberOfArguments};if(y===E.tokenTypes.FUNCTION_WITH_ONE_ARG)l=G,f=L,_(a,2),i.push(T),m[o+1].type!==E.tokenTypes.OPENING_PARENTHESIS&&(i.push(s),a.push(2));else if(y===E.tokenTypes.NUMBER)b.type===E.tokenTypes.NUMBER?(b.value+=v,_(a,1)):i.push(T),l=J,f=ro;else if(y===E.tokenTypes.BINARY_OPERATOR_HIGH_PRECENDENCE)l=G,f=L,_(a,2),i.push(T);else if(y===E.tokenTypes.CONSTANT)i.push(T),l=J,f=se;else if(y===E.tokenTypes.OPENING_PARENTHESIS)_(a,1),u++,l=G,f=L,i.push(T);else if(y===E.tokenTypes.CLOSING_PARENTHESIS){if(!u)throw new Error("Closing parenthesis are more than opening one, wait What!!!");u--,l=J,f=se,i.push(T),_(a,1)}else if(y===E.tokenTypes.DECIMAL){if(b.hasDec)throw new Error("Two decimals are not allowed in one number");b.type!==E.tokenTypes.NUMBER&&(b={show:"0",value:0,type:E.tokenTypes.NUMBER,precedence:0},i.push(b)),l=no,_(a,1),f=L,b.value+=v,b.hasDec=!0}else y===E.tokenTypes.POSTFIX_FUNCTION_WITH_ONE_ARG&&(l=J,f=se,_(a,1),i.push(T));y===E.tokenTypes.FUNCTION_WITH_N_ARGS?(l=G,f=L,_(a,h.numberOfArguments+2),i.push(T),m[o+1].type!==E.tokenTypes.OPENING_PARENTHESIS&&(i.push(s),a.push(h.numberOfArguments+2))):y===E.tokenTypes.BINARY_OPERATOR_LOW_PRECENDENCE?(b.type===E.tokenTypes.BINARY_OPERATOR_LOW_PRECENDENCE?b.value===this.math.add?(b.value=v,b.show=w,_(a,1)):b.value===this.math.sub&&w==="-"&&(b.value=this.math.add,b.show="+",_(a,1)):b.type!==E.tokenTypes.CLOSING_PARENTHESIS&&b.type!==E.tokenTypes.POSTFIX_FUNCTION_WITH_ONE_ARG&&b.type!==E.tokenTypes.NUMBER&&b.type!==E.tokenTypes.CONSTANT&&b.type!==E.tokenTypes.EVALUATED_FUNCTION_PARAMETER?d==="-"&&(l=G,f=L,_(a,1).push(2),i.push(r),i.push(s)):(i.push(T),_(a,2)),l=G,f=L):y===E.tokenTypes.BINARY_OPERATOR_PERMUTATION?(l=G,f=L,_(a,2),i.push(T)):y===E.tokenTypes.COMMA?(l=G,f=L,i.push(T)):y===E.tokenTypes.EVALUATED_FUNCTION?(l=G,f=L,_(a,6),i.push(T),m[o+1].type!==E.tokenTypes.OPENING_PARENTHESIS&&(i.push(s),a.push(6))):y===E.tokenTypes.EVALUATED_FUNCTION_PARAMETER&&(l=J,f=se,i.push(T)),_(a,-1),p=d}else if(o>0&&o<m.length-1&&m[o+1].type===1&&(m[o-1].type===1||m[o-1].type===6))throw new Error("Unexpected Space")}for(g=a.length;g--;)i.push(n);if(l[5]!==!0)throw new Error("complete the expression");for(;u--;)i.push(n);return i.push(n),i}});var Je=$(Me=>{"use strict";Object.defineProperty(Me,"__esModule",{value:!0}),Me.toPostfix=function(t){for(var e,o,r,n=[],s=-1,i=-1,a=[{value:"(",type:4,precedence:0,show:"("}],c=1;c<t.length;c++)if(t[c].type===1||t[c].type===3||t[c].type===13)t[c].type===1&&(t[c].value=Number(t[c].value)),n.push(t[c]);else if(t[c].type===4)a.push(t[c]);else if(t[c].type===5)for(;((l=o=a.pop())==null?void 0:l.type)!==4;){var l;o&&n.push(o)}else if(t[c].type===11){for(;((u=o=a.pop())==null?void 0:u.type)!==4;){var u;o&&n.push(o)}a.push(o)}else{i=(e=t[c]).precedence,s=(r=a[a.length-1]).precedence;var f=r.value=="Math.pow"&&e.value=="Math.pow";if(i>s)a.push(e);else{for(;s>=i&&!f||f&&i<s;)o=a.pop(),r=a[a.length-1],o&&n.push(o),s=r.precedence,f=e.value=="Math.pow"&&r.value=="Math.pow";a.push(e)}}return n}});var Ke=$(Se=>{"use strict";Object.defineProperty(Se,"__esModule",{value:!0}),Se.postfixEval=function(t,e){(e=e||{}).PI=Math.PI,e.E=Math.E;for(var o,r,n,s=[],i=e.n!==void 0,a=0;a<t.length;a++)if(t[a].type===1)s.push({value:t[a].value,type:1});else if(t[a].type===3)s.push({value:e[t[a].value],type:1});else if(t[a].type===0){var c=s[s.length-1];Array.isArray(c)?c.push(t[a]):c.value=t[a].value(c.value)}else if(t[a].type===7){var l=s[s.length-1];Array.isArray(l)?l.push(t[a]):l.value=t[a].value(l.value)}else if(t[a].type===8){for(var u=[],f=0;f<t[a].numberOfArguments;f++){var p=s.pop();p&&u.push(p.value)}s.push({type:1,value:t[a].value.apply(t[a],u.reverse())})}else if(t[a].type===10)o=s.pop(),r=s.pop(),Array.isArray(r)?((r=r.concat(o)).push(t[a]),s.push(r)):Array.isArray(o)?(o.unshift(r),o.push(t[a]),s.push(o)):s.push({type:1,value:t[a].value(r.value,o.value)});else if(t[a].type===2||t[a].type===9)o=s.pop(),r=s.pop(),Array.isArray(r)?((r=r.concat(o)).push(t[a]),s.push(r)):Array.isArray(o)?(o.unshift(r),o.push(t[a]),s.push(o)):s.push({type:1,value:t[a].value(r.value,o.value)});else if(t[a].type===12){o=s.pop();var m=void 0;m=!Array.isArray(o)&&o?[o]:o||[],r=s.pop(),n=s.pop(),s.push({type:1,value:t[a].value(n.value,r.value,m)})}else t[a].type===13&&(i?s.push({value:e[t[a].value],type:3}):s.push([t[a]]));if(s.length>1)throw new Error("Uncaught Syntax error");return parseFloat(s[0].value.toFixed(15))}});var Qe=$(Pe=>{"use strict";Object.defineProperty(Pe,"__esModule",{value:!0});Pe.createMathFunctions=function(t){return{isDegree:!0,acos:function(e){return t.math.isDegree?180/Math.PI*Math.acos(e):Math.acos(e)},add:function(e,o){return e+o},asin:function(e){return t.math.isDegree?180/Math.PI*Math.asin(e):Math.asin(e)},atan:function(e){return t.math.isDegree?180/Math.PI*Math.atan(e):Math.atan(e)},acosh:function(e){return Math.log(e+Math.sqrt(e*e-1))},asinh:function(e){return Math.log(e+Math.sqrt(e*e+1))},atanh:function(e){return Math.log((1+e)/(1-e))},C:function(e,o){var r=1,n=e-o,s=o;s<n&&(s=n,n=o);for(var i=s+1;i<=e;i++)r*=i;var a=t.math.fact(n);return a==="NaN"?"NaN":r/a},changeSign:function(e){return-e},cos:function(e){return t.math.isDegree&&(e=t.math.toRadian(e)),Math.cos(e)},cosh:function(e){return(Math.pow(Math.E,e)+Math.pow(Math.E,-1*e))/2},div:function(e,o){return e/o},fact:function(e){if(e%1!=0)return"NaN";for(var o=1,r=2;r<=e;r++)o*=r;return o},inverse:function(e){return 1/e},log:function(e){return Math.log(e)/Math.log(10)},mod:function(e,o){return e%o},mul:function(e,o){return e*o},P:function(e,o){for(var r=1,n=Math.floor(e)-Math.floor(o)+1;n<=Math.floor(e);n++)r*=n;return r},Pi:function(e,o,r){for(var n=1,s=e;s<=o;s++)n*=Number(t.postfixEval(r,{n:s}));return n},pow10x:function(e){for(var o=1;e--;)o*=10;return o},sigma:function(e,o,r){for(var n=0,s=e;s<=o;s++)n+=Number(t.postfixEval(r,{n:s}));return n},sin:function(e){return t.math.isDegree&&(e=t.math.toRadian(e)),Math.sin(e)},sinh:function(e){return(Math.pow(Math.E,e)-Math.pow(Math.E,-1*e))/2},sub:function(e,o){return e-o},tan:function(e){return t.math.isDegree&&(e=t.math.toRadian(e)),Math.tan(e)},tanh:function(e){return t.math.sinh(e)/t.math.cosh(e)},toRadian:function(e){return e*Math.PI/180},and:function(e,o){return e&o}}}});var ot=$((kr,tt)=>{"use strict";var et=$e(),Oe=Re(),io=Je(),ao=Ke(),co=Qe(),Ae=function(){function t(){this.toPostfix=io.toPostfix,this.addToken=et.addToken,this.lex=et.lex,this.postfixEval=ao.postfixEval,this.math=co.createMathFunctions(this),this.tokens=Oe.createTokens(this)}return t.prototype.eval=function(e,o,r){return this.postfixEval(this.toPostfix(this.lex(e,o)),r)},t}();Ae.TOKEN_TYPES=Oe.tokenTypes,Ae.tokenTypes=Oe.tokenTypes,tt.exports=Ae});var lt=oo(ot());import{Vector2 as ue,Matrix3 as lo}from"three";import{seededRandom as fo}from"three/src/math/MathUtils.js";function P(t){return t._v?fo(t.get()):Math.random()}function D(t,e){return t[1]?t[Math.floor(P(e)*t.length)]:t[0]}function U(t,e,o,r){return r?e+Math.floor((o-e)/r*P(t))*r:e+(o-e)*P(t)}function K(t){let e=t[0],o=e.clone(),r=e.clone();return t.forEach(n=>{let{x:s,y:i}=n;s<o.x?o.x=s:s>r.x&&(r.x=s),i<o.y?o.y=i:i>r.y&&(r.y=i)}),{min:o,max:r}}function Q(t){return t<.7854||t>5.4978||2.3562<t&&t<3.927}function po(t,e){let{x:o,y:r}=t.start,{x:n,y:s}=t.end,{x:i,y:a}=e.start,{x:c,y:l}=e.end,u=(o-n)*(a-l)-(r-s)*(i-c);if(u!==0){let f=((o-i)*(a-l)-(r-a)*(i-c))/u,p=-((o-n)*(r-a)-(r-s)*(o-i))/u;if(f>=0&&f<=1&&p>=0&&p<=1)return new ue(o+f*(n-o),r+f*(s-r))}}function uo(t,e){let{x:o,y:r}=t;return o>=e.min.x&&o<=e.max.x&&r>=e.min.y&&r<=e.max.y}function rt(t,e){let o=[t.start,t.end].filter(n=>uo(n,e));if(o.length===2)return{start:t.start.clone(),end:t.end.clone()};{let n=e.lines.map(c=>po(c,t)).filter(c=>c),s=o[0],i=n[0],a=n[1];if(s){if(i){if(i&&a)return ke(t,i,a);if(i.x!==s.x||i.y!==s.y)return ke(t,i,s)}}else if(i&&a&&(i.x!==a.x||i.y!==a.y))return ke(t,i,a)}}function ke(t,e,o){let r={x:t.end.x-t.start.x,y:t.end.y-t.start.y},n={x:o.x-e.x,y:o.y-e.y};return r.x*n.x+r.y*n.y>0?{start:e,end:o}:{start:o,end:e}}function nt(t,e){let{x:o,y:r}=t.start,{x:n,y:s}=t.direction,{x:i,y:a}=e.start,{x:c,y:l}=e.direction,u=n*l-s*c;if(u!==0){let f={x:i-o,y:a-r},p=(f.x*l-f.y*c)/u;return new ue(o+p*n,r+p*s)}}function Ne(t,e){let{x:o,y:r}=t.direction,n=new ue(-r,o);n.setLength(Q(n.angle())?e.x:e.y);let s=n.add(t.start);return{start:s,end:s.clone().add(t.direction),direction:t.direction}}function me(t,e,o=0){let r=t.reduce((n,s)=>n+s,0);if(r>0){let n=Math.round((e-o)/r);if(n>0)return{ratio:e/(r*n+o),count:n}}}function Ie(t,e){let o=[],r=[];if(e.forEach(s=>{let i=n(t,s);i&&r.push(i)}),r.sort((s,i)=>s.x-i.x),r.length%2===0)for(let s=0;s<r.length;s+=2){let i=r[s],a=r[s+1];o.push([i,a])}return o;function n(s,i){let{x:a,y:c}=i.start,{x:l,y:u}=i.end;if(c<u?c<s&&s<u:u<s&&s<c){let f=(u-c)/(l-a),p=(s-c)/f+a;return new ue(p,s)}}}function He(t,e,o,r){let n=[],s=K(t.map(p=>p.start)),i=s.min.y,a=s.max.y-s.min.y,c=e.map(p=>Object.assign({elevation:o},p)),l=c.map(p=>p.width),u=me(l,a,r?l[0]:0);if(u){c.forEach(p=>p.width*=u.ratio);for(let p=0;p<u.count;p++)c.forEach(f);r&&c[0]&&f(c[0])}return n;function f(p){let m=p.width/2;i+=m;let h=Ie(i,t).map(g=>{let[d,y]=g;return{center:{x:(d.x+y.x)/2,y:(d.y+y.y)/2},width:y.x-d.x}});p.shrink&&h.forEach(g=>g.width-=p.shrink),p.transform?.forEach(g=>{"moveX"in g&&h.forEach(d=>{d.center.x+=g.moveX,d.center.y+=g.moveY})}),n.push(Object.assign({pairs:h},p)),i+=m}}function Ce(t,e,o){let r=0;if(o==="RANDOM"?r=Math.PI*2*P(e):o==="DEPTH"?r=Math.PI/2:o==="WIDTH"?r=0:o==="LONGEST"?r=t.reduce((s,i)=>s.direction.length()>i.direction.length()?s:i).direction.angle():o==="SHORTEST"?r=t.reduce((s,i)=>s.direction.length()<i.direction.length()?s:i).direction.angle():typeof o=="number"&&(r=o*(Math.PI/180)),r){let n=new lo().makeRotation(r);t=t.map(s=>({direction:s.direction.clone().applyMatrix3(n),start:s.start.clone().applyMatrix3(n),end:s.end.clone().applyMatrix3(n)}))}else t=t.map(n=>({direction:n.direction.clone(),start:n.start.clone(),end:n.end.clone()}));return{newRays:t,radian:r}}function ee(t,e,o){let r=!0;if(o){let{everyIndex:n,skipIndex:s,chance:i}=o;(n&&t%n!==0||s&&t%s===0||i&&P(e)>i)&&(r=!1)}return r}var he=class{v;_v;constructor(e){this.v=this._v=e||st()}get(){return this.v++}set(e){this.v=this._v=e||st()}reset(){this.v=this._v}};function st(){return Math.round(Math.random()*Math.pow(10,3))}function _e(t,e){let{preset:o,building:r}=t;for(let n=0;n<e.length;n++){let s=e[n];for(let i in s.preset)o[i]&&console.log(`preset:${i} is replaceed`);for(let i in s.building)r[i]&&console.log(`building:${i} is replaceed`);Object.assign(r,s.building),Object.assign(o,s.preset)}for(let n in r)r[n].section.roof?.floor?.forEach(i=>{i.preset?.forEach(a=>{a.name&&!o[a.name]&&console.error("invalid style:",a.name,"@",n);let c=a.key;c&&Object.keys(o).filter(u=>u.includes(c)).length===0&&console.error("invalid key of style:",a.key)})});return t}var mo=new lt.default,k={UNITS:{},UNITS_PRESET:{},COLOR_PRESET:{}},V={colorMap:[],floorCount:0,classified:[]},te=class{Blocks;data;constructor(...e){this.Blocks={type:"FREE",section:{bottom:{height:"1BH",floor:[{extrude:[{once:!0,height:"1BH"}]}]}}},this.data={preset:{},building:{}},this.merge(e)}merge(e){return _e(this.data,e),this.data}getOptions(){let e={paid:[],free:["Blocks"]},o=this.data.building;for(let r in o)o[r].type==="FREE"?e.free.push(r):e.paid.push(r);return e}parseStyle(e,o,r){V.colorMap=["#eee","#bdf G"],V.floorCount=0,V.classified=[];let n=Number(e.height),s=Number(e.floorHeight||3),i=Number(e.elevation||0);o.set(Number(e.seed||0)||Math.round(Math.random()*1e5));let a=!e.style||e.style==="Blocks"?this.Blocks:r?.building[e.style]||this.data.building[e.style];if(a){k.UNITS=Object.assign({BH:n},a.unit);let c=a.section,l=x(c.roof?.height),u=x(c.roof?.floorHeight)||s,f=x(c.bottom.height),p=x(c.bottom.floorHeight)||s;f<p&&(f=p);let m=n-l-f,h=x(c.middle?.floorHeight)||s;m=Math.floor(m/h)*h,f=n-l-m,p=f/Math.floor(f/p),Be(this,r,i,f,p,o,c.bottom),Be(this,r,i+f,m,h,o,c.middle),Be(this,r,i+n-l,l,u,o,c.roof,!0)}else console.warn(`${e.style} is invalid, returned empty data`);return V}};function j(t,e){let o=[],r=t.color;if(r)if(typeof r=="string"){let n=k.COLOR_PRESET[r];n?o=typeof n=="string"?[n]:n:o.push(r)}else o=r;return Object.assign({transform:t.transform?t.transform.map(n=>"rotateX"in n?{rotateX:x(n.rotateX)}:"rotateY"in n?{rotateY:x(n.rotateY)}:"rotateZ"in n?{rotateZ:x(n.rotateZ)}:{moveX:x(n.moveX),moveY:x(n.moveY),moveZ:x(n.moveZ)}):[],color:o.map(n=>{let s=0,i=!1;return n==="G"?(s=1,i=!0):(i=/G$/i.test(n),s=V.colorMap.indexOf(n),s<0&&(s=V.colorMap.length,V.colorMap.push(n))),{index:s,glass:i}})},e)}function it(t){return t.map(e=>"x"in e?j(e,{x:x(e.x),y:x(e.y),z:x(e.z)}):j(e,{width:x(e.width),height:x(e.height),shrink:x(e.shrink)}))}function ho(t){return t.map(e=>j(e,{x:x(e.x),y:x(e.y),z:x(e.z)}))}function ft(t){return j(t,{width:x(t.width),height:x(t.height),shrink:x(t.shrink)})}function Be(t,e,o,r,n,s,i,a){if(i){k.UNITS.FH=n;let c=0;a?c=1:(c=Math.round(r/k.UNITS.FH),V.floorCount+=c),c>0&&i.floor?.forEach(l=>{at(c,n,r,o,l,s),l.preset?.forEach(u=>{let{name:f,key:p,unit:m,color:h}=u;try{let g;if(f)g=e?.preset[f]||t.data.preset[f];else if(p){if(e){let d=Object.keys(e.preset).filter(y=>y.includes(p));d.length>0&&(g=e.preset[D(d,s)])}if(!g){let d=Object.keys(t.data.preset).filter(y=>y.includes(p));d.length>0&&(g=t.data.preset[D(d,s)])}}if(g){if(g.unit)if(k.UNITS_PRESET={},m)for(let d in g.unit){let y=m[d];k.UNITS_PRESET[d]=x(y!==void 0?y:g.unit[d])}else for(let d in g.unit)k.UNITS_PRESET[d]=x(g.unit[d]);if(g.color)if(k.COLOR_PRESET={},h)for(let d in g.color)k.COLOR_PRESET[d]=h[d]||g.color[d];else for(let d in g.color)k.COLOR_PRESET[d]=g.color[d];g.floor.forEach(d=>{let y=Object.assign({},d);l.floorControl&&(y.floorControl=l.floorControl),l.floorNumber&&(y.floorNumber=l.floorNumber),l.floorRange&&(y.floorRange=l.floorRange),y.setEdges=[...l.setEdges||[],...y.setEdges||[]],at(c,n,r,o,y,s)}),k.COLOR_PRESET=k.UNITS_PRESET={}}else console.warn("can not find preset:",f)}catch(g){console.warn("handle preset error:",f,g)}})})}}function at(t,e,o,r,n,s){let i=ye(n.floorControl),a=go(n),c=JSON.stringify(a),l=V.classified.find(h=>h.edgesJSON===c),u=l||{edgeParams:a,edgesJSON:c,extrude:[],slopingRoof:[],clampBox:[],facade:[],match:[],boxInside:[],adjunct:[]};l||V.classified.push(u);let{floorNumber:f,floorRange:p}=n;yo(0,t,f,p).forEach(h=>{let g=h[1]-h[0];k.UNITS.SH=f||p?g*e:o;for(let d=h[0];d<h[1];d++)if(ee(d,s,i)){let y=d===h[0],v=r+d*e;vo(v,y,u,n.extrude),Eo(v,y,u,n.slopingRoof),bo(v,y,u,n.clampBox),wo(v,y,u,n.match),Ro(v,y,u,n.boxInside),Mo(v,y,u,n.adjunct),To(v,y,u,n.facade)}})}function yo(t,e,o,r){let n=[];if(o)n.push([t,t+x(o)]);else if(r){let s=e-t;r.forEach(i=>{let{asRatio:a,bottom:c,top:l,reverse:u}=i,f=x(c),p=x(l),m=t,h=e;u?a?(f&&(h=m+Math.round(s*f)),p&&(m=h-Math.round(s*p))):(f&&(h=m+f),p&&(m=h-p)):a?(f&&(m+=Math.round(s*f)),p&&(h-=Math.round(s*p))):(f&&(m+=f),p&&(h-=p)),m<h&&n.push([m,h])})}else n.push([t,e]);return n}function go(t){return{set:t.setEdges?.map(e=>{let{offset:o,clamp:r,along:n}=e;return{offset:xo(o),clamp:So(r),along:n}})}}function xo(t){if(t){if(typeof t=="object")return{x:x(t.x),y:x(t.y),asRatio:!!t.asRatio};{let e=x(t);return{x:e,y:e,asRatio:!1}}}}function vo(t,e,o,r){r&&r.forEach(n=>{let{once:s,height:i,thickness:a}=n;(!s||e)&&o.extrude.push(j(n,{thickness:x(a),height:x(i),elevation:t}))})}function Eo(t,e,o,r){r&&r.forEach(n=>{let{once:s,height:i,overhang:a}=n;(!s||e)&&o.slopingRoof.push(j(n,{overhang:x(a),height:x(i),elevation:t}))})}function bo(t,e,o,r){r&&r.forEach(n=>{let{once:s,height:i}=n;(!s||e)&&o.clampBox.push(j(n,{height:x(i),elevation:t}))})}function ye(t){return t?{skipIndex:x(t.skipIndex),everyIndex:x(t.everyIndex),chance:x(t.chance)}:void 0}function To(t,e,o,r){r&&r.forEach(n=>{let{once:s,padding:i,proto:a}=n;if(!s||e){let c={elevation:t,padding:De(i),proto:[]};a&&a.forEach(l=>{let{area:u,spacing:f,divide:p,first:m,last:h,lastWidth:g}=l;c.proto.push({area:u||"MIDDLE",spacing:f?.map(d=>({space:x(d.space),group:d.group?it(Array.isArray(d.group)?d.group:[d.group]):void 0,control:ye(d.control),repeat:x(d.repeat)})),divide:p?.map(d=>({count:x(d.count),group:it(Array.isArray(d.group)?d.group:[d.group]),control:ye(d.control)})),first:typeof m=="boolean"?m:!0,last:h||!1,lastWidth:x(g)})}),c.proto[0]&&o.facade.push(c)}})}function wo(t,e,o,r){r&&r.forEach(n=>{let{once:s,along:i,top:a,bottom:c}=n;if(!s||e){let l={elevation:t,along:i,flexes:n.flexes.map(ft),bottom:void 0,top:void 0,control:ye(n.control),sandwich:n.sandwich||!1};if(a){let{like:u,ratio:f,padding:p}=a;l.top={like:u,ratio:x(f),padding:p?De(p):void 0}}if(c){let{like:u,ratio:f,padding:p}=c;l.bottom={like:u,ratio:x(f),padding:p?De(p):void 0}}o.match.push(l)}})}function Ro(t,e,o,r){r&&r.forEach(n=>{let{flex:s,count:i,widthRatio:a,depthRatio:c,heightRatio:l,along:u,once:f}=n;(!f||e)&&o.boxInside.push({flex:ft(s),count:de(i),widthRatio:de(a),depthRatio:de(c),heightRatio:de(l),along:u,elevation:t})})}function de(t){if(typeof t=="object")return[x(t[0]),x(t[1])];{let e=t?x(t):1;return[e,e]}}function Mo(t,e,o,r){r&&r.forEach(n=>{let{once:s,boxes:i,place:a,count:c}=n;(!s||e)&&o.adjunct.push({count:c?x(c):1,place:a||"EDGE",boxes:ho(i),elevation:t})})}function So(t){if(t)return{xMin:x(t.xMin),xMax:x(t.xMax),yMin:x(t.yMin),yMax:x(t.yMax),xCentral:x(t.xCentral),yCentral:x(t.yCentral),asRatio:typeof t.asRatio=="boolean"?t.asRatio:!0,reverse:t.reverse||!1}}function De(t){if(t)return{start:x(t.start),middle:x(t.middle),end:x(t.end),asRatio:typeof t.asRatio=="boolean"?t.asRatio:!0}}function x(t){let e;if(typeof t=="string"){t=ct(t,k.UNITS),t=ct(t,k.UNITS_PRESET);try{e=mo.eval(t)}catch(o){console.log("Error parse fomula:",o,t,k.UNITS,k.UNITS_PRESET),e=0}}else e=t||0;return e}function ct(t,e){return e&&Object.keys(e).sort((r,n)=>n.length-r.length).forEach(r=>{t=t.replace(new RegExp(`\\d+(\\.\\d+)?${r}`,"g"),n=>{let s=e[r];return(Number(n.replace(r,""))*s).toString()})}),t}var pt={preset:{"\u8BA2\u9605\u5C4B\u9876\u968F\u673A\u8BBE\u5907<\u9AD8\u5EA6,\u62AC\u5347><\u989C\u8272A,\u989C\u8272B>":{unit:{\u9AD8\u5EA6:2,\u62AC\u5347:0},color:{\u989C\u8272A:"#eee",\u989C\u8272B:["#666","#333"]},floor:[{floorNumber:1,setEdges:[{offset:{x:.1,y:.1,asRatio:!0}}],match:[{flexes:[{width:2},{width:4,height:"1\u9AD8\u5EA6",color:"\u989C\u8272A",transform:[{moveZ:"1\u62AC\u5347"}]}],control:{chance:.8},along:"WIDTH",sandwich:!0},{flexes:[{width:1},{width:2,height:"0.5\u9AD8\u5EA6",color:"\u989C\u8272B",transform:[{moveZ:"1\u62AC\u5347"}]}],control:{chance:.2},along:"DEPTH",sandwich:!0}]}]},"\u8BA2\u9605\u5C4B\u9876\u5973\u513F\u5899<\u9AD8\u5EA6,\u539A\u5EA6,\u7F29\u8FDB,\u62AC\u5347><\u989C\u8272>":{unit:{\u9AD8\u5EA6:1.5,\u539A\u5EA6:.2,\u7F29\u8FDB:0,\u62AC\u5347:0},color:{\u989C\u8272:"#fff"},floor:[{setEdges:[{offset:"1\u7F29\u8FDB"}],extrude:[{height:"1\u9AD8\u5EA6",thickness:"1\u539A\u5EA6",color:"\u989C\u8272",transform:[{moveZ:"1\u62AC\u5347"}]}]}]},"\u8BA2\u9605\u4E2D\u6BB5\u968F\u673A\u5782\u76F4\u5899\u677F<\u5899\u5BBD,\u7A97\u5BBD,\u964D\u4F4E,\u6982\u7387><\u5899\u677F>":{unit:{\u5899\u5BBD:4,\u7A97\u5BBD:2,\u964D\u4F4E:0,\u6982\u7387:.8},color:{\u5899\u677F:"#eee"},floor:[{extrude:[{once:!0,height:"1SH-1\u964D\u4F4E",color:"G"}],facade:[{once:!0,proto:[{last:!0,lastWidth:"1\u5899\u5BBD",spacing:[{control:{chance:"1\u6982\u7387"},space:"1\u5899\u5BBD+1\u7A97\u5BBD",group:[{x:"1\u5899\u5BBD",y:.2,z:"1SH-1\u964D\u4F4E",color:"\u5899\u677F",transform:[{moveX:"0.5\u5899\u5BBD"}]}]}]}]}]}]},"\u8BA2\u9605\u5E95\u90E8\u89D2\u67F1A<\u67F1\u5BBD\u6BD4\u4F8B,\u539A\u5EA6,\u964D\u4F4E><\u89D2\u67F1,\u67F1\u5B50,\u697C\u677F,\u95E8,\u6311\u6A90>":{unit:{\u67F1\u5BBD\u6BD4\u4F8B:.2,\u539A\u5EA6:.6,\u964D\u4F4E:0},color:{\u89D2\u67F1:"#bbb",\u67F1\u5B50:"#bbb",\u697C\u677F:"#666",\u95E8:"#666",\u6311\u6A90:"#666"},floor:[{facade:[{once:!0,padding:{start:"1\u67F1\u5BBD\u6BD4\u4F8B",end:"1\u67F1\u5BBD\u6BD4\u4F8B"},proto:[{area:"BOTH",divide:[{count:1,group:[{width:"2\u539A\u5EA6",height:"1SH-1\u964D\u4F4E",color:"\u89D2\u67F1"}]}]},{area:"MIDDLE",divide:[{count:1,group:[{width:"1.6\u539A\u5EA6",height:"0.2*(1SH-1\u964D\u4F4E)",color:"\u697C\u677F",transform:[{moveZ:"0.8*(1SH-1\u964D\u4F4E)"}]}]}]},{first:!1,spacing:[{space:4,group:[{x:1,y:"1\u539A\u5EA6",z:"0.8*(1SH-1\u964D\u4F4E)",color:"\u67F1\u5B50",transform:[{moveY:"0.5\u539A\u5EA6-0.2"}]}]}]},{spacing:[{control:{chance:.2},space:4,group:[{x:1.6,y:.2,z:3,color:"\u95E8",transform:[{moveX:2}]},{x:4,y:2,z:.2,color:"\u6311\u6A90",transform:[{moveX:2,moveZ:3}]}]}]}]}]},{floorRange:[{bottom:1}],extrude:[{height:-1,color:"\u697C\u677F"}]},{setEdges:[{offset:"0.5\u539A\u5EA6+0.3"}],facade:[{once:!0,proto:[{divide:[{count:1,group:[{width:1,height:"1SH-1\u964D\u4F4E-1",color:"G"}]}]}]}]}]},"\u8BA2\u9605\u5E95\u90E8\u7ACB\u9762A<\u95F4\u8DDD,\u67F1\u5BBD,\u683C\u5BBD,\u964D\u4F4E><\u67F1,\u683C,\u697C\u677F,\u95E8,\u6311\u6A90>":{unit:{\u95F4\u8DDD:8,\u67F1\u5BBD:3,\u683C\u5BBD:.4,\u964D\u4F4E:1},color:{\u67F1:"#eee",\u683C:"#fff",\u697C\u677F:"#bbb",\u95E8:"#666",\u6311\u6A90:"#666"},floor:[{extrude:[{once:!0,height:"1SH-1\u964D\u4F4E",color:"G"}],facade:[{once:!0,proto:[{last:!0,lastWidth:"1\u67F1\u5BBD",spacing:[{space:"1\u67F1\u5BBD+(1\u95F4\u8DDD-1\u67F1\u5BBD)/4",group:[{x:"1\u67F1\u5BBD",y:.6,z:"1SH-1\u964D\u4F4E",color:"\u67F1",transform:[{moveX:"1\u67F1\u5BBD/2"}]}]},{space:"(1\u95F4\u8DDD-1\u67F1\u5BBD)/4",group:[{x:"1\u683C\u5BBD",y:1,z:"1SH-1FH+1-1\u964D\u4F4E",color:"\u683C",transform:[{moveZ:"1FH-1"}]}],repeat:2}]},{lastWidth:"1\u67F1\u5BBD",spacing:[{control:{chance:.2},space:"1\u95F4\u8DDD",group:[{x:"1\u95F4\u8DDD",y:3,z:.2,color:"\u6311\u6A90",transform:[{moveX:"0.5\u95F4\u8DDD+0.5\u67F1\u5BBD",moveY:.5,moveZ:3.1}]},{x:.8,y:.2,z:3,color:"\u95E8",transform:[{moveX:"0.5\u95F4\u8DDD+0.5\u67F1\u5BBD-0.4"}]},{x:.8,y:.2,z:3,color:"\u95E8",transform:[{moveX:"0.5\u95F4\u8DDD+0.5\u67F1\u5BBD+0.4"}]}]}]}]}]},{setEdges:[{offset:-.2}],floorRange:[{bottom:1}],extrude:[{height:-1,color:"\u697C\u677F"}]},{setEdges:[{offset:{x:.2,y:.2,asRatio:!0}}],extrude:[{once:!0,height:"1SH"}]}]},"\u8BA2\u9605\u5E95\u90E8\u683C\u6805A<\u95F4\u8DDD,\u67F1\u5BBD,\u683C\u5BBD,\u964D\u4F4E><\u6D45\u8272,\u6DF1\u8272,\u95E8,\u6311\u6A90>":{unit:{\u95F4\u8DDD:8,\u67F1\u5BBD:3,\u683C\u5BBD:.4,\u964D\u4F4E:1},color:{\u6D45\u8272:"#eee",\u6DF1\u8272:"#bbb",\u95E8:"#666",\u6311\u6A90:"#666"},floor:[{extrude:[{once:!0,height:"1SH-1\u964D\u4F4E",color:"G"}],facade:[{once:!0,proto:[{last:!0,spacing:[{space:1,group:[{x:.1,y:.6,z:"1SH-1.6",color:"\u6DF1\u8272",transform:[{moveZ:.6}]}]}]},{divide:[{count:1,group:[{width:.2,height:.6,color:"\u6DF1\u8272"}]}]},{lastWidth:"1\u67F1\u5BBD",spacing:[{control:{chance:.2},space:"1\u95F4\u8DDD",group:[{x:.8,y:1,z:3,color:"\u95E8",transform:[{moveX:"0.5\u95F4\u8DDD+0.5\u67F1\u5BBD-0.4"}]},{x:.8,y:1,z:3,color:"\u95E8",transform:[{moveX:"0.5\u95F4\u8DDD+0.5\u67F1\u5BBD+0.4"}]}]}]}]}]},{floorRange:[{bottom:1}],extrude:[{height:-1,color:"\u6D45\u8272"}]}]}},building:{}};var ut={preset:{"\u65B0\u4E2D\u5F0F\u522B\u5885\u5761\u5C4B\u9876<\u9AD8\u5EA6,\u51FA\u6311><\u989C\u8272,\u5C4B\u9876\u989C\u8272>":{unit:{\u9AD8\u5EA6:2,\u51FA\u6311:.5},color:{\u989C\u8272:"#863",\u5C4B\u9876\u989C\u8272:"#666"},floor:[{slopingRoof:[{height:"1\u9AD8\u5EA6-0.3",color:"\u5C4B\u9876\u989C\u8272",transform:[{moveZ:.3}]}]},{extrude:[{height:.2,color:"\u989C\u8272",transform:[{moveZ:.1}]}]},{extrude:[{height:.1}]}]},"\u65B0\u4E2D\u5F0F\u522B\u5885\u6BB5\u9876\u7EBF\u811A<\u603B\u9AD8,\u6807\u9AD8><\u989C\u8272>":{unit:{\u603B\u9AD8:.6,\u6807\u9AD8:"1BH-2.6"},color:{\u989C\u8272:"#eee"},floor:[{extrude:[{once:!0,height:.1,color:"\u989C\u8272",transform:[{moveZ:"1\u6807\u9AD8+1\u603B\u9AD8-0.1"}]},{once:!0,height:.1,color:"\u989C\u8272",transform:[{moveZ:"1\u6807\u9AD8"}]}]},{extrude:[{once:!0,height:"1\u603B\u9AD8-0.2",color:"\u989C\u8272",transform:[{moveZ:"1\u6807\u9AD8+0.1"}]}],facade:[{once:!0,proto:[{spacing:[{group:[{x:.2,y:.2,z:"1\u603B\u9AD8-0.2",color:"\u989C\u8272",transform:[{moveZ:"1\u6807\u9AD8+0.1"}]}],space:.6}]}]}]}]},"\u65B0\u4E2D\u5F0F\u522B\u5885\u7AD6\u5411\u5212\u5206\u9633\u53F0\u95E8<\u603B\u9AD8,\u6807\u9AD8><\u989C\u8272>":{unit:{\u603B\u9AD8:"1SH",\u6807\u9AD8:.45},color:{\u989C\u8272:"#541"},floor:[{facade:[{once:!0,proto:[{spacing:[{space:.3,group:[{x:.1,y:.4,z:"1SH-1\u6807\u9AD8-2.6",color:"\u989C\u8272",transform:[{moveZ:"1\u6807\u9AD8+2.6"}]}]}],first:!1},{spacing:[{space:.1},{space:1.4,group:[{width:-.5,height:.2,color:"\u989C\u8272",transform:[{moveZ:"1\u6807\u9AD8+2.4"}]}]}],last:!0},{spacing:[{space:.1,group:[{x:.2,y:.8,z:"1\u603B\u9AD8",color:"\u989C\u8272"}]},{space:.7,group:[{width:-.2,height:2.4,color:"\u989C\u8272",transform:[{moveZ:"1\u6807\u9AD8"}]}]},{space:.7,group:[{width:-.2,height:2.4,color:"\u989C\u8272",transform:[{moveZ:"1\u6807\u9AD8"}]},{x:.1,y:.5,z:.6,transform:[{moveX:-.2,moveZ:"1\u6807\u9AD8+0.6"}]},{x:.1,y:.5,z:.6,transform:[{moveX:.2,moveZ:"1\u6807\u9AD8+0.6"}]}]}],last:!0}]}]}]},"\u65B0\u4E2D\u5F0F\u522B\u5885\u6A2A\u5411\u95E8\u642D\u914D\u7AD6\u5411\u5212\u5206\u5165\u6237\u95E8<><\u989C\u8272>":{color:{\u989C\u8272:"#541"},floor:[{facade:[{proto:[{divide:[{group:[{width:-.3,height:2.2,color:"\u989C\u8272"},{width:-.6,height:.2,color:"\u989C\u8272",shrink:-.6,transform:[{moveX:-.3,moveZ:2.2}]}],count:1}]}]}]}]},"\u65B0\u4E2D\u5F0F\u522B\u5885\u7AD6\u5411\u5212\u5206\u7ACB\u9762\u7A97<\u603B\u9AD8><\u6D45\u8272,\u6DF1\u8272>":{unit:{\u603B\u9AD8:"1SH"},color:{\u6D45\u8272:"#863",\u6DF1\u8272:"#541"},floor:[{facade:[{once:!0,proto:[{spacing:[{space:1,group:[{width:.2,height:"1\u603B\u9AD8"}]},{space:.1,group:[{x:.1,y:.3,z:"1\u603B\u9AD8",color:"\u6D45\u8272"}]},{space:.6,group:[{x:.1,y:.1,z:"1\u603B\u9AD8",color:"\u6DF1\u8272"}]},{space:1.2,group:[{x:.1,y:.1,z:"1\u603B\u9AD8",color:"\u6DF1\u8272"}]},{space:.6,group:[{x:.1,y:.1,z:"1\u603B\u9AD8",color:"\u6DF1\u8272"}]},{space:.1,group:[{x:.1,y:.1,z:"1\u603B\u9AD8",color:"\u6DF1\u8272"}]},{space:0,group:[{x:.1,y:.3,z:"1\u603B\u9AD8",color:"\u6D45\u8272"}]}],last:!0,lastWidth:1}]}]}]},"\u65B0\u4E2D\u5F0F\u522B\u5885\u6A2A\u5411\u5212\u5206\u7ACB\u9762\u7A97<\u5899\u677F\u9AD8,\u5899\u677F\u964D\u4F4E><\u6D45\u8272,\u6DF1\u8272>":{unit:{\u5899\u677F\u9AD8:1.4,\u5899\u677F\u964D\u4F4E:.4},color:{\u6D45\u8272:"#863",\u6DF1\u8272:"#541"},floor:[{facade:[{proto:[{spacing:[{space:1.1},{space:2.4,group:[{width:-.1,height:.05,color:"\u6DF1\u8272",transform:[{moveZ:2.2}]},{width:-.2,height:"1\u5899\u677F\u9AD8",color:"\u6D45\u8272",transform:[{moveZ:"-1\u5899\u677F\u964D\u4F4E"}]}]}],lastWidth:1.1}]}]}]},"\u65B0\u4E2D\u5F0F\u522B\u5885\u89D2\u67F1<\u67F1\u9AD8><\u989C\u8272>":{unit:{\u67F1\u9AD8:"1BH-4"},color:{\u989C\u8272:"#541"},floor:[{facade:[{once:!0,proto:[{divide:[{group:[{x:.7,y:.7,z:-.6,color:"\u989C\u8272",transform:[{moveZ:"1\u67F1\u9AD8"}]},{x:.6,y:.6,z:"1\u67F1\u9AD8-0.6"},{x:.7,y:.7,z:1,color:"\u989C\u8272"}],count:1}]}]}]}]},"\u65B0\u4E2D\u5F0F\u522B\u5885\u95E8\u5ECA\u67F1<\u51FA\u6311,\u67F1\u9AD8><\u989C\u8272>":{unit:{\u51FA\u6311:2,\u67F1\u9AD8:"1BH-2.6"},color:{\u989C\u8272:"#541"},floor:[{facade:[{once:!0,proto:[{last:!0,divide:[{group:[{x:.3,y:.7,z:.3,color:"\u989C\u8272",transform:[{moveZ:"1\u67F1\u9AD8-0.4",moveY:"-1\u51FA\u6311"}]},{x:.6,y:.6,z:"1\u67F1\u9AD8",transform:[{moveY:"-1\u51FA\u6311"}]},{x:.7,y:.7,z:1,color:"\u989C\u8272",transform:[{moveY:"-1\u51FA\u6311"}]},{x:.1,y:.8,z:.1,color:"\u989C\u8272",transform:[{moveZ:2.4,moveY:"-1\u51FA\u6311"}]},{x:.08,y:.78,z:.9,transform:[{moveZ:1.5,moveY:"-1\u51FA\u6311"}]},{x:.1,y:.8,z:.1,color:"\u989C\u8272",transform:[{moveZ:1.4,moveY:"-1\u51FA\u6311"}]}],count:1}]}]}]}]},"\u65B0\u4E2D\u5F0F\u522B\u5885\u95E8\u5ECA\u4E09\u7EA7\u53F0\u9636<\u51FA\u6311>":{unit:{\u51FA\u6311:2},floor:[{facade:[{once:!0,proto:[{divide:[{group:[{width:"2\u51FA\u6311",height:.15,transform:[{moveZ:.3}]},{width:"2\u51FA\u6311+0.6",height:.15,shrink:-.6,transform:[{moveX:-.3,moveZ:.15}]},{width:"2\u51FA\u6311+1.2",height:.15,shrink:-1.2,transform:[{moveX:-.6}]}],count:1}]}]}]}]},"\u65B0\u4E2D\u5F0F\u522B\u5885\u95E8\u5ECA\u9633\u53F0\u7EBF\u811A<\u51FA\u6311,\u677F\u539A><\u989C\u8272>":{unit:{\u51FA\u6311:2,\u677F\u539A:.4},color:{\u989C\u8272:"#863"},floor:[{facade:[{once:!0,proto:[{last:!0,spacing:[{group:[{x:.2,y:"2\u51FA\u6311+1",z:.4,transform:[{moveZ:"1SH-0.5"}]}],space:.6}]},{divide:[{count:1,group:[{width:"2\u51FA\u6311+1.6",height:.2,shrink:-1.6,color:"#863",transform:[{moveX:-.8,moveZ:"1SH+0.1"}]},{width:"2\u51FA\u6311+1.2",height:.1,shrink:-1.2,transform:[{moveX:-.6,moveZ:"1SH"}]},{width:"2\u51FA\u6311+1",height:.1,shrink:-1,transform:[{moveX:-.5,moveZ:"1SH-0.1"}]},{width:"2\u51FA\u6311+0.8",height:.4,shrink:-.8,transform:[{moveX:-.4,moveZ:"1SH-0.5"}]},{width:"2\u51FA\u6311+1",height:.1,shrink:-1,transform:[{moveX:-.5,moveZ:"1SH-0.6"}]}]}]}]},{proto:[{last:!0,divide:[{group:[{x:.02,y:"1\u51FA\u6311",z:1,color:"G",transform:[{moveY:"-0.5\u51FA\u6311"}]}],count:1}]},{divide:[{group:[{width:.02,height:1,color:"G",transform:[{moveY:"-1\u51FA\u6311"}]}],count:1},{group:[{width:"2\u51FA\u6311+1",height:-.1,shrink:-1,color:"\u989C\u8272",transform:[{moveX:-.5}]},{width:"2\u51FA\u6311+0.8",height:"0.2-1\u677F\u539A",shrink:-.7,color:"\u989C\u8272",transform:[{moveX:-.35,moveZ:-.1}]},{width:"2\u51FA\u6311+1",height:.1,shrink:-.8,color:"\u989C\u8272",transform:[{moveX:-.4,moveZ:"-1\u677F\u539A"}]}],count:1}]}]}]}]}},building:{\u65B0\u4E2D\u5F0F\u522B\u5885:{section:{roof:{height:2,floor:[{preset:[{name:"\u65B0\u4E2D\u5F0F\u522B\u5885\u5761\u5C4B\u9876<\u9AD8\u5EA6,\u51FA\u6311><\u989C\u8272,\u5C4B\u9876\u989C\u8272>"}]}]},middle:{floor:[{setEdges:[{clamp:{xCentral:1.2,asRatio:!1}}],preset:[{name:"\u65B0\u4E2D\u5F0F\u522B\u5885\u6A2A\u5411\u95E8\u642D\u914D\u7AD6\u5411\u5212\u5206\u5165\u6237\u95E8<><\u989C\u8272>"}]},{setEdges:[{clamp:{xCentral:2,asRatio:!1,reverse:!0}}],preset:[{name:"\u65B0\u4E2D\u5F0F\u522B\u5885\u6A2A\u5411\u5212\u5206\u7ACB\u9762\u7A97<\u5899\u677F\u9AD8,\u5899\u677F\u964D\u4F4E><\u6D45\u8272,\u6DF1\u8272>"}]},{setEdges:[{clamp:{xCentral:3,asRatio:!1}}],preset:[{name:"\u65B0\u4E2D\u5F0F\u522B\u5885\u95E8\u5ECA\u9633\u53F0\u7EBF\u811A<\u51FA\u6311,\u677F\u539A><\u989C\u8272>"}]}]},bottom:{height:3,floor:[{setEdges:[{clamp:{xCentral:2,asRatio:!1}}],preset:[{unit:{\u603B\u9AD8:"1BH-2.6"},name:"\u65B0\u4E2D\u5F0F\u522B\u5885\u7AD6\u5411\u5212\u5206\u9633\u53F0\u95E8<\u603B\u9AD8,\u6807\u9AD8><\u989C\u8272>"}]},{setEdges:[{clamp:{xCentral:2,asRatio:!1,reverse:!0}}],preset:[{unit:{\u603B\u9AD8:"1BH-2.6"},name:"\u65B0\u4E2D\u5F0F\u522B\u5885\u7AD6\u5411\u5212\u5206\u7ACB\u9762\u7A97<\u603B\u9AD8><\u6D45\u8272,\u6DF1\u8272>"},{unit:{\u5899\u677F\u9AD8:1,\u5899\u677F\u964D\u4F4E:0},color:{\u6D45\u8272:"#541"},name:"\u65B0\u4E2D\u5F0F\u522B\u5885\u6A2A\u5411\u5212\u5206\u7ACB\u9762\u7A97<\u5899\u677F\u9AD8,\u5899\u677F\u964D\u4F4E><\u6D45\u8272,\u6DF1\u8272>"}]},{preset:[{name:"\u65B0\u4E2D\u5F0F\u522B\u5885\u6BB5\u9876\u7EBF\u811A<\u603B\u9AD8,\u6807\u9AD8><\u989C\u8272>"},{name:"\u65B0\u4E2D\u5F0F\u522B\u5885\u89D2\u67F1<\u67F1\u9AD8><\u989C\u8272>"}],extrude:[{once:!0,height:"1BH-2.5",color:"G"}]},{setEdges:[{clamp:{xCentral:3,asRatio:!1}}],preset:[{name:"\u65B0\u4E2D\u5F0F\u522B\u5885\u95E8\u5ECA\u67F1<\u51FA\u6311,\u67F1\u9AD8><\u989C\u8272>"},{name:"\u65B0\u4E2D\u5F0F\u522B\u5885\u95E8\u5ECA\u4E09\u7EA7\u53F0\u9636<\u51FA\u6311>"}]}]}}}}};var mt={preset:{"\u9A6C\u8D5B\u516C\u5BD3\u649E\u8272\u7ACB\u9762\u9633\u53F0<\u51FA\u6311><\u989C\u8272\u7EC4\u5408>":{unit:{\u51FA\u6311:2},color:{\u989C\u8272\u7EC4\u5408:["#F44336","#388E3C","#FFC107"]},floor:[{facade:[{once:!0,proto:[{divide:[{count:1,group:[{width:"-1\u51FA\u6311",height:-.4,transform:[{moveY:"-0.5\u51FA\u6311",moveZ:"1SH"}]}]}]}]},{proto:[{divide:[{count:1,group:[{width:.2,height:.4,transform:[{moveY:"0.1-1\u51FA\u6311",moveZ:1}]},{width:.2,height:1,color:"#bbb",transform:[{moveY:"0.2-1\u51FA\u6311"}]},{width:"-2\u51FA\u6311",height:-.4}]}]},{first:!1,spacing:[{space:4,group:[{x:.4,y:"2\u51FA\u6311-0.6",z:"1FH-0.4",color:"\u989C\u8272\u7EC4\u5408"}],control:{chance:.4}}]}]}]},{facade:[{once:!0,proto:[{divide:[{group:[{width:"-1\u51FA\u6311",height:-.4,transform:[{moveZ:"1SH"}]}],count:1}]},{last:!0,spacing:[{group:[{x:.2,y:"2\u51FA\u6311+0.2",z:"1SH",transform:[{moveZ:-.2}]}],space:4}]}]}]}]},\u9A6C\u8D5B\u516C\u5BD3\u901A\u9AD8\u683C\u6805:{floor:[{}]},"\u9A6C\u8D5B\u516C\u5BD3\u4E2D\u6BB5\u65B9\u7A97<\u5899\u9AD8,\u67F1\u5BBD,\u95F4\u8DDD><\u5899\u989C\u8272>":{unit:{\u5899\u9AD8:"1FH-1.6",\u67F1\u5BBD:.6,\u95F4\u8DDD:2},color:{\u5899\u989C\u8272:"#fff"},floor:[{facade:[{once:!0,padding:{start:"0.5\u67F1\u5BBD",end:"0.5\u67F1\u5BBD",asRatio:!1},proto:[{last:!0,spacing:[{group:[{x:"1\u67F1\u5BBD",y:.5,z:"1SH"}],space:"1\u95F4\u8DDD"}]}]},{proto:[{divide:[{group:[{width:-.2,height:"1\u5899\u9AD8",color:"\u5899\u989C\u8272"}],count:1}]}]}]}]},"\u9A6C\u8D5B\u516C\u5BD3\u5C4B\u9876\u901A\u98CE\u5854<\u6570\u91CF>":{unit:{\u6570\u91CF:2},floor:[{adjunct:[{once:!0,count:"1\u6570\u91CF",boxes:[{x:2,y:2,z:10,transform:[{rotateX:5}]},{x:2,y:2,z:10,transform:[{rotateX:5},{rotateZ:120}]},{x:2,y:2,z:10,transform:[{rotateX:5},{rotateZ:240}]},{x:.2,y:1.8,z:10.5,transform:[{rotateX:5}]},{x:.2,y:1.8,z:10.5,transform:[{rotateX:5},{rotateZ:120}]},{x:.2,y:1.8,z:10.5,transform:[{rotateX:5},{rotateZ:240}]},{x:2,y:2,z:.2,transform:[{moveY:-1,moveZ:10.5}]},{x:2,y:2,z:.2,transform:[{moveY:-1,moveZ:10.5},{rotateZ:120}]},{x:2,y:2,z:.2,transform:[{moveY:-1,moveZ:10.5},{rotateZ:240}]}]}]}]}},building:{Marseille:{section:{roof:{height:2,floor:[{extrude:[{height:1.5,thickness:.4},{height:.4}]},{floorNumber:1,setEdges:[{offset:{x:.2,y:.2,asRatio:!0}}],preset:[{name:"\u9A6C\u8D5B\u516C\u5BD3\u5C4B\u9876\u901A\u98CE\u5854<\u6570\u91CF>"}],boxInside:[{once:!0,along:"LONGEST",count:9,flex:{width:2,height:4,color:"#bbb"},widthRatio:[.1,.3],depthRatio:[.2,.6],heightRatio:[.2,1]}]}]},middle:{floor:[{extrude:[{height:-.6}]},{extrude:[{once:!0,height:"1SH",color:"G"}]},{setEdges:[{clamp:{xMax:.5}}],floorRange:[{bottom:.35,top:.5,asRatio:!0}],facade:[{proto:[{spacing:[{group:[{x:.2,y:1,z:"1SH"}],space:1}]}]}]},{setEdges:[{clamp:{xMax:.5}}],floorRange:[{bottom:.35,asRatio:!0,reverse:!0},{top:.5,asRatio:!0,reverse:!0}],preset:[{name:"\u9A6C\u8D5B\u516C\u5BD3\u649E\u8272\u7ACB\u9762\u9633\u53F0<\u51FA\u6311><\u989C\u8272\u7EC4\u5408>"}]},{setEdges:[{clamp:{xMin:.6,xMax:.1}}],preset:[{name:"\u9A6C\u8D5B\u516C\u5BD3\u649E\u8272\u7ACB\u9762\u9633\u53F0<\u51FA\u6311><\u989C\u8272\u7EC4\u5408>"}]},{setEdges:[{clamp:{xMin:.9}},{along:"DEPTH"}],preset:[{name:"\u9A6C\u8D5B\u516C\u5BD3\u649E\u8272\u7ACB\u9762\u9633\u53F0<\u51FA\u6311><\u989C\u8272\u7EC4\u5408>"}]},{setEdges:[{clamp:{xMin:.5,xMax:.4}}],preset:[{name:"\u9A6C\u8D5B\u516C\u5BD3\u4E2D\u6BB5\u65B9\u7A97<\u5899\u9AD8,\u67F1\u5BBD,\u95F4\u8DDD><\u5899\u989C\u8272>"}]},{setEdges:[{clamp:{xMin:.9}},{along:"WIDTH"}],facade:[{once:!0,proto:[{divide:[{group:[{width:-.3,height:"1SH"}],count:1}]}]}]}]},bottom:{height:8,floor:[{setEdges:[{offset:2}],facade:[{once:!0,proto:[{divide:[{group:[{width:4,height:1,transform:[{rotateX:-15},{moveZ:"1SH-1.2"}]}],count:1}]}]}]},{setEdges:[{offset:4},{along:"WIDTH"},{clamp:{xMin:.45,xMax:.4,reverse:!0}}],facade:[{once:!0,proto:[{last:!0,spacing:[{group:[{x:2,y:4,z:"1SH",transform:[{rotateX:10}]},{x:2,y:4,z:"1SH",transform:[{rotateX:-10},{moveX:.2}]}],space:8}]}]}]},{setEdges:[{offset:3},{clamp:{xMin:.5,xMax:.45}}],clampBox:[{once:!0,height:"1BH+12"}]}]}}}}};var ht={preset:{"\u8BA2\u9605\u4E2D\u90E845\u5EA6\u62DF\u5408\u7ACB\u9762<\u51FA\u6311><\u6A2A\u677F>":{unit:{\u51FA\u6311:1},color:{\u6A2A\u677F:"#bbb"},floor:[{floorRange:[{top:-1}],extrude:[{height:-1,color:"\u6A2A\u677F"}]},{match:[{once:!0,flexes:[{width:.4,height:"1SH-1"},{width:3,height:"1SH-1",color:"G"}],along:45}]}]},"\u8BA2\u9605\u4E2D\u90E8\u5F00\u95F4\u62DF\u5408\u7ACB\u9762<\u677F\u5BBD,\u7A97\u5BBD,\u7A97\u8FDB\u6DF1,\u4FEE\u6B63\u9AD8\u5EA6,\u4FEE\u6B63\u6807\u9AD8><\u989C\u8272>":{unit:{\u677F\u5BBD:.4,\u7A97\u5BBD:4,\u7A97\u8FDB\u6DF1:.5,\u4FEE\u6B63\u9AD8\u5EA6:0,\u4FEE\u6B63\u6807\u9AD8:0},color:{\u989C\u8272:"#fff"},floor:[{match:[{sandwich:!0,once:!0,flexes:[{width:"1\u677F\u5BBD",height:"1SH+1\u4FEE\u6B63\u9AD8\u5EA6",color:"\u989C\u8272",transform:[{moveZ:"1\u4FEE\u6B63\u6807\u9AD8"}]},{width:"1\u7A97\u5BBD",height:"1SH+1\u4FEE\u6B63\u9AD8\u5EA6",color:"G",shrink:"2\u7A97\u8FDB\u6DF1",transform:[{moveZ:"1\u4FEE\u6B63\u6807\u9AD8"}]}],along:"DEPTH"}]}]}},building:{M451:{section:{roof:{height:3,floor:[{preset:[{name:"\u8BA2\u9605\u5C4B\u9876\u968F\u673A\u8BBE\u5907<\u9AD8\u5EA6,\u62AC\u5347><\u989C\u8272A,\u989C\u8272B>"},{name:"\u8BA2\u9605\u5C4B\u9876\u5973\u513F\u5899<\u9AD8\u5EA6,\u539A\u5EA6,\u7F29\u8FDB,\u62AC\u5347><\u989C\u8272>",color:{\u989C\u8272:"#a86"}}]}]},middle:{floor:[{preset:[{name:"\u8BA2\u9605\u4E2D\u90E845\u5EA6\u62DF\u5408\u7ACB\u9762<\u51FA\u6311><\u6A2A\u677F>",color:{\u6A2A\u677F:"#555"}}]}]},bottom:{height:"0.15BH",floorHeight:5,floor:[{preset:[{name:"\u8BA2\u9605\u5E95\u90E8\u89D2\u67F1A<\u67F1\u5BBD\u6BD4\u4F8B,\u539A\u5EA6,\u964D\u4F4E><\u89D2\u67F1,\u67F1\u5B50,\u697C\u677F,\u95E8,\u6311\u6A90>",color:{\u89D2\u67F1:"#a86"},unit:{\u964D\u4F4E:1}}]}]}}},M452:{section:{roof:{height:3,floor:[{preset:[{name:"\u8BA2\u9605\u5C4B\u9876\u968F\u673A\u8BBE\u5907<\u9AD8\u5EA6,\u62AC\u5347><\u989C\u8272A,\u989C\u8272B>"},{name:"\u8BA2\u9605\u5C4B\u9876\u5973\u513F\u5899<\u9AD8\u5EA6,\u539A\u5EA6,\u7F29\u8FDB,\u62AC\u5347><\u989C\u8272>",color:{\u989C\u8272:"#666"}}]}]},middle:{floor:[{preset:[{name:"\u8BA2\u9605\u4E2D\u90E845\u5EA6\u62DF\u5408\u7ACB\u9762<\u51FA\u6311><\u6A2A\u677F>",color:{\u6A2A\u677F:"#a86"},unit:{\u51FA\u6311:.4}}]}]},bottom:{height:"0.2BH",floorHeight:5,floor:[{preset:[{name:"\u8BA2\u9605\u5E95\u90E8\u7ACB\u9762A<\u95F4\u8DDD,\u67F1\u5BBD,\u683C\u5BBD,\u964D\u4F4E><\u67F1,\u683C,\u697C\u677F,\u95E8,\u6311\u6A90>",color:{\u67F1:"#666",\u683C:"#eee",\u697C\u677F:"#a86",\u95E8:"#fff"},unit:{\u964D\u4F4E:1}}]}]}}},M01:{section:{roof:{height:3,floor:[{preset:[{name:"\u8BA2\u9605\u5C4B\u9876\u968F\u673A\u8BBE\u5907<\u9AD8\u5EA6,\u62AC\u5347><\u989C\u8272A,\u989C\u8272B>"},{name:"\u8BA2\u9605\u5C4B\u9876\u5973\u513F\u5899<\u9AD8\u5EA6,\u539A\u5EA6,\u7F29\u8FDB,\u62AC\u5347><\u989C\u8272>",unit:{\u7F29\u8FDB:1}}]}]},middle:{floor:[{preset:[{name:"\u8BA2\u9605\u4E2D\u90E8\u5F00\u95F4\u62DF\u5408\u7ACB\u9762<\u677F\u5BBD,\u7A97\u5BBD,\u7A97\u8FDB\u6DF1,\u4FEE\u6B63\u9AD8\u5EA6,\u4FEE\u6B63\u6807\u9AD8><\u989C\u8272>",unit:{\u4FEE\u6B63\u6807\u9AD8:-.5}}]},{setEdges:[{offset:{x:.5}}],extrude:[{height:-1,color:"#a86"},{once:!0,height:-1,color:"#a86",transform:[{moveZ:"1SH"}]}],facade:[{proto:[{divide:[{count:1,group:[{width:-.1,height:1,color:"G"}]}]}]}]}]},bottom:{height:"0.2BH",floorHeight:5,floor:[{setEdges:[{offset:.5}],preset:[{name:"\u8BA2\u9605\u5E95\u90E8\u7ACB\u9762A<\u95F4\u8DDD,\u67F1\u5BBD,\u683C\u5BBD,\u964D\u4F4E><\u67F1,\u683C,\u697C\u677F,\u95E8,\u6311\u6A90>",color:{\u67F1:"#fff",\u697C\u677F:"#a86",\u95E8:"#a86"},unit:{\u964D\u4F4E:1}}]}]}}},M02:{section:{roof:{height:3,floor:[{preset:[{name:"\u8BA2\u9605\u5C4B\u9876\u968F\u673A\u8BBE\u5907<\u9AD8\u5EA6,\u62AC\u5347><\u989C\u8272A,\u989C\u8272B>"}]},{preset:[{name:"\u8BA2\u9605\u5C4B\u9876\u5973\u513F\u5899<\u9AD8\u5EA6,\u539A\u5EA6,\u7F29\u8FDB,\u62AC\u5347><\u989C\u8272>"}]}]},middle:{floor:[{preset:[{name:"\u8BA2\u9605\u4E2D\u90E8\u5F00\u95F4\u62DF\u5408\u7ACB\u9762<\u677F\u5BBD,\u7A97\u5BBD,\u7A97\u8FDB\u6DF1,\u4FEE\u6B63\u9AD8\u5EA6,\u4FEE\u6B63\u6807\u9AD8><\u989C\u8272>",unit:{\u4FEE\u6B63\u6807\u9AD8:-.5}}]},{floorRange:[{top:-1}],setEdges:[{offset:{x:.5,y:-1}}],extrude:[{height:-1,color:"#a86"}]}]},bottom:{height:"0.15BH",floorHeight:5,floor:[{setEdges:[{offset:.5}],preset:[{name:"\u8BA2\u9605\u5E95\u90E8\u89D2\u67F1A<\u67F1\u5BBD\u6BD4\u4F8B,\u539A\u5EA6,\u964D\u4F4E><\u89D2\u67F1,\u67F1\u5B50,\u697C\u677F,\u95E8,\u6311\u6A90>",unit:{\u67F1\u5BBD\u6BD4\u4F8B:.1,\u964D\u4F4E:1},color:{\u89D2\u67F1:"#fff",\u67F1\u5B50:"#fff",\u95E8:"#a86"}}]},{setEdges:[{offset:{x:.2,y:.2,asRatio:!0}}],extrude:[{height:"1BH"}]}]}}},M03:{section:{roof:{height:3,floor:[{preset:[{name:"\u8BA2\u9605\u5C4B\u9876\u968F\u673A\u8BBE\u5907<\u9AD8\u5EA6,\u62AC\u5347><\u989C\u8272A,\u989C\u8272B>"},{name:"\u8BA2\u9605\u5C4B\u9876\u5973\u513F\u5899<\u9AD8\u5EA6,\u539A\u5EA6,\u7F29\u8FDB,\u62AC\u5347><\u989C\u8272>",unit:{\u539A\u5EA6:.4,\u7F29\u8FDB:-.4},color:{\u989C\u8272:"#bbb"}}]}]},middle:{floor:[{setEdges:[{offset:-.5}],preset:[{name:"\u8BA2\u9605\u4E2D\u90E8\u5F00\u95F4\u62DF\u5408\u7ACB\u9762<\u677F\u5BBD,\u7A97\u5BBD,\u7A97\u8FDB\u6DF1,\u4FEE\u6B63\u9AD8\u5EA6,\u4FEE\u6B63\u6807\u9AD8><\u989C\u8272>",unit:{\u677F\u5BBD:2,\u7A97\u5BBD:2,\u7A97\u8FDB\u6DF1:.4,\u4FEE\u6B63\u6807\u9AD8:-.5},color:{\u989C\u8272:"#bbb"}}]},{floorRange:[{top:-1}],extrude:[{height:-1}]}]},bottom:{height:"0.2BH",floorHeight:5,floor:[{preset:[{name:"\u8BA2\u9605\u5E95\u90E8\u7ACB\u9762A<\u95F4\u8DDD,\u67F1\u5BBD,\u683C\u5BBD,\u964D\u4F4E><\u67F1,\u683C,\u697C\u677F,\u95E8,\u6311\u6A90>",color:{\u67F1:"#bbb",\u683C:"#fff",\u697C\u677F:"#666",\u95E8:"#a86"},unit:{\u95F4\u8DDD:5,\u67F1\u5BBD:2,\u964D\u4F4E:1}}]}]}}},M04:{section:{roof:{height:3,floor:[{preset:[{name:"\u8BA2\u9605\u5C4B\u9876\u968F\u673A\u8BBE\u5907<\u9AD8\u5EA6,\u62AC\u5347><\u989C\u8272A,\u989C\u8272B>"},{name:"\u8BA2\u9605\u5C4B\u9876\u5973\u513F\u5899<\u9AD8\u5EA6,\u539A\u5EA6,\u7F29\u8FDB,\u62AC\u5347><\u989C\u8272>",unit:{\u7F29\u8FDB:1},color:{\u989C\u8272:"#666"}}]}]},middle:{floor:[{floorRange:[{top:.15,asRatio:!0}],preset:[{name:"\u8BA2\u9605\u4E2D\u90E8\u5F00\u95F4\u62DF\u5408\u7ACB\u9762<\u677F\u5BBD,\u7A97\u5BBD,\u7A97\u8FDB\u6DF1,\u4FEE\u6B63\u9AD8\u5EA6,\u4FEE\u6B63\u6807\u9AD8><\u989C\u8272>",unit:{\u7A97\u8FDB\u6DF1:-.4},color:{\u989C\u8272:"#666"}}]},{floorRange:[{top:.15,asRatio:!0}],extrude:[{height:-1,color:"#a86"},{once:!0,height:-1,color:"#a86",transform:[{moveZ:"1SH"}]}]},{floorRange:[{top:.15,asRatio:!0,reverse:!0}],extrude:[{height:-1,color:"#a86",transform:[{moveZ:"1FH"}]}]},{floorRange:[{top:.15,asRatio:!0,reverse:!0}],extrude:[{once:!0,height:"1SH-1",color:"G"}],facade:[{once:!0,proto:[{last:!0,spacing:[{space:1,group:[{x:.2,y:.6,z:"1SH-1",color:"#666"}]}]}]}]}]},bottom:{height:"0.15BH",floorHeight:5,floor:[{preset:[{name:"\u8BA2\u9605\u5E95\u90E8\u683C\u6805A<\u95F4\u8DDD,\u67F1\u5BBD,\u683C\u5BBD,\u964D\u4F4E><\u6D45\u8272,\u6DF1\u8272,\u95E8,\u6311\u6A90>",unit:{\u67F1\u5BBD:2,\u964D\u4F4E:1},color:{\u6DF1\u8272:"#666",\u6D45\u8272:"#fff"}}]},{setEdges:[{offset:{x:.2,y:.2,asRatio:!0}}],extrude:[{once:!0,height:"1BH"}]}]}}},M05:{section:{roof:{height:3,floor:[{preset:[{name:"\u8BA2\u9605\u5C4B\u9876\u968F\u673A\u8BBE\u5907<\u9AD8\u5EA6,\u62AC\u5347><\u989C\u8272A,\u989C\u8272B>"},{name:"\u8BA2\u9605\u5C4B\u9876\u5973\u513F\u5899<\u9AD8\u5EA6,\u539A\u5EA6,\u7F29\u8FDB,\u62AC\u5347><\u989C\u8272>",color:{\u989C\u8272:"#666"}}]}]},middle:{floor:[{preset:[{name:"\u8BA2\u9605\u4E2D\u90E8\u5F00\u95F4\u62DF\u5408\u7ACB\u9762<\u677F\u5BBD,\u7A97\u5BBD,\u7A97\u8FDB\u6DF1,\u4FEE\u6B63\u9AD8\u5EA6,\u4FEE\u6B63\u6807\u9AD8><\u989C\u8272>",unit:{\u7A97\u8FDB\u6DF1:-.4},color:{\u989C\u8272:"#666"}}]},{setEdges:[{offset:-.5}],extrude:[{height:-1,color:"#a86"},{once:!0,height:-1,color:"#a86",transform:[{moveZ:"1SH"}]}]}]},bottom:{height:"0.15BH",floorHeight:5,floor:[{preset:[{name:"\u8BA2\u9605\u5E95\u90E8\u7ACB\u9762A<\u95F4\u8DDD,\u67F1\u5BBD,\u683C\u5BBD,\u964D\u4F4E><\u67F1,\u683C,\u697C\u677F,\u95E8,\u6311\u6A90>",unit:{\u67F1\u5BBD:2,\u964D\u4F4E:1},color:{\u67F1:"#666",\u683C:"#666",\u697C\u677F:"#a86",\u95E8:"#a86"}}]}]}}}}};var dt={preset:{},building:{R1:{tag:["\u968F\u673A"],section:{roof:{floor:[{preset:[{name:"\u8BA2\u9605\u5C4B\u9876\u968F\u673A\u8BBE\u5907<\u9AD8\u5EA6,\u62AC\u5347><\u989C\u8272A,\u989C\u8272B>"}]},{setEdges:[{offset:1}],preset:[{name:"\u8BA2\u9605\u5C4B\u9876\u5973\u513F\u5899<\u9AD8\u5EA6,\u539A\u5EA6,\u7F29\u8FDB,\u62AC\u5347><\u989C\u8272>",color:{\u989C\u8272:"#666"}}]}]},middle:{floor:[{floorRange:[{bottom:1}],setEdges:[{offset:-1}],extrude:[{height:"0.6FH",color:"#a86",transform:[{moveZ:"-0.2FH"}]}]},{setEdges:[{offset:-1}],extrude:[{once:!0,height:.5,color:"#333"},{once:!0,height:.5,color:"#333",transform:[{moveZ:"1SH"}]}]},{preset:[{name:"\u8BA2\u9605\u4E2D\u6BB5\u968F\u673A\u5782\u76F4\u5899\u677F<\u5899\u5BBD,\u7A97\u5BBD,\u964D\u4F4E,\u6982\u7387><\u5899\u677F>",color:{\u5899\u677F:"#555"}}]}]},bottom:{height:"0.1BH",floorHeight:5,floor:[{preset:[{name:"\u8BA2\u9605\u5E95\u90E8\u89D2\u67F1A<\u67F1\u5BBD\u6BD4\u4F8B,\u539A\u5EA6,\u964D\u4F4E><\u89D2\u67F1,\u67F1\u5B50,\u697C\u677F,\u95E8,\u6311\u6A90>",color:{\u89D2\u67F1:"#666",\u67F1\u5B50:"#666",\u697C\u677F:"#333",\u95E8:"#a86"}}]}]}}},R2:{tag:["\u968F\u673A"],section:{roof:{floor:[{preset:[{name:"\u8BA2\u9605\u5C4B\u9876\u968F\u673A\u8BBE\u5907<\u9AD8\u5EA6,\u62AC\u5347><\u989C\u8272A,\u989C\u8272B>"}]},{preset:[{name:"\u8BA2\u9605\u5C4B\u9876\u5973\u513F\u5899<\u9AD8\u5EA6,\u539A\u5EA6,\u7F29\u8FDB,\u62AC\u5347><\u989C\u8272>",color:{\u989C\u8272:"#a86"}}]}]},middle:{floor:[{setEdges:[{offset:-1}],extrude:[{height:-1,color:"#666"},{height:.1,color:"#666",transform:[{moveZ:"0.33FH-0.38"}]},{height:.1,color:"#666",transform:[{moveZ:"0.66FH-0.68"}]},{once:!0,height:-1,color:"#666",transform:[{moveZ:"1SH"}]}]},{preset:[{name:"\u8BA2\u9605\u4E2D\u6BB5\u968F\u673A\u5782\u76F4\u5899\u677F<\u5899\u5BBD,\u7A97\u5BBD,\u964D\u4F4E,\u6982\u7387><\u5899\u677F>",unit:{\u7A97\u5BBD:4,\u964D\u4F4E:.5},color:{\u5899\u677F:"#a86"}}]}]},bottom:{height:"0.15BH",floorHeight:5,floor:[{preset:[{name:"\u8BA2\u9605\u5E95\u90E8\u89D2\u67F1A<\u67F1\u5BBD\u6BD4\u4F8B,\u539A\u5EA6,\u964D\u4F4E><\u89D2\u67F1,\u67F1\u5B50,\u697C\u677F,\u95E8,\u6311\u6A90>",unit:{\u964D\u4F4E:1},color:{\u89D2\u67F1:"#666",\u67F1\u5B50:"#666",\u697C\u677F:"#a86",\u95E8:"#a86"}}]}]}}},R5:{tag:["\u968F\u673A"],section:{roof:{floor:[{preset:[{name:"\u8BA2\u9605\u5C4B\u9876\u968F\u673A\u8BBE\u5907<\u9AD8\u5EA6,\u62AC\u5347><\u989C\u8272A,\u989C\u8272B>"}]},{setEdges:[{offset:1}],preset:[{name:"\u8BA2\u9605\u5C4B\u9876\u5973\u513F\u5899<\u9AD8\u5EA6,\u539A\u5EA6,\u7F29\u8FDB,\u62AC\u5347><\u989C\u8272>",color:{\u989C\u8272:"#666"}}]}]},middle:{floor:[{floorRange:[{bottom:1}],setEdges:[{offset:{x:-1,y:2}}],extrude:[{height:-1,color:"#fff"}]},{floorRange:[{bottom:1}],setEdges:[{offset:{x:2,y:-1}}],extrude:[{height:-1,color:"#fff"}]},{setEdges:[{offset:-.5}],extrude:[{once:!0,height:.5,color:"#333"},{once:!0,height:.5,color:"#333",transform:[{moveZ:"1SH"}]}]},{preset:[{name:"\u8BA2\u9605\u4E2D\u6BB5\u968F\u673A\u5782\u76F4\u5899\u677F<\u5899\u5BBD,\u7A97\u5BBD,\u964D\u4F4E,\u6982\u7387><\u5899\u677F>",color:{\u5899\u677F:["#888","#bbb","#eee"]}}]}]},bottom:{height:"0.1BH",floorHeight:5,floor:[{preset:[{name:"\u8BA2\u9605\u5E95\u90E8\u89D2\u67F1A<\u67F1\u5BBD\u6BD4\u4F8B,\u539A\u5EA6,\u964D\u4F4E><\u89D2\u67F1,\u67F1\u5B50,\u697C\u677F,\u95E8,\u6311\u6A90>",color:{\u89D2\u67F1:"#666",\u67F1\u5B50:["#888","#bbb","#eee"],\u697C\u677F:"#333",\u95E8:"#a86"}}]}]}}},R6:{tag:["\u968F\u673A"],section:{roof:{floor:[{preset:[{name:"\u8BA2\u9605\u5C4B\u9876\u968F\u673A\u8BBE\u5907<\u9AD8\u5EA6,\u62AC\u5347><\u989C\u8272A,\u989C\u8272B>"}]},{preset:[{name:"\u8BA2\u9605\u5C4B\u9876\u5973\u513F\u5899<\u9AD8\u5EA6,\u539A\u5EA6,\u7F29\u8FDB,\u62AC\u5347><\u989C\u8272>",unit:{\u7F29\u8FDB:.5}}]}]},middle:{floor:[{extrude:[{height:-1,transform:[{moveZ:"1FH"}]}]},{setEdges:[{offset:{x:-1,y:2}}],extrude:[{once:!0,height:-1}]},{floorRange:[{bottom:1}],setEdges:[{along:"WIDTH"}],facade:[{padding:{start:1,end:4,asRatio:!1},proto:[{divide:[{count:1,group:[{width:1,height:-1,color:["#fff","#999"]}]}]}]}]}]},bottom:{height:5,floor:[{facade:[{once:!0,proto:[{last:!0,lastWidth:4,spacing:[{control:{chance:1},space:6,group:[{x:4,y:.5,z:"1BH-0.5",color:["#999","#bbb"],transform:[{moveX:2}]}]}]},{lastWidth:4,spacing:[{control:{chance:.3},space:6,group:[{x:2,y:.2,z:2.4,transform:[{moveX:5,moveY:.15}]},{x:2,y:.5,z:"1SH-3.4",transform:[{moveX:5,moveZ:2.4}],color:["#fff","#C6FF00","#64B5F6"]}]}]}]}]},{setEdges:[{offset:.75}],facade:[{once:!0,proto:[{divide:[{count:1,group:[{width:1,height:"1BH-0.5",color:"G"}]}]}]}]}]}}}}};var yt={preset:{"\u514D\u8D39\u5C4B\u9876\u5973\u513F\u5899<\u7F29\u8FDB,\u9AD8\u5EA6,\u539A\u5EA6,\u62AC\u5347><\u989C\u8272>":{unit:{\u7F29\u8FDB:0,\u9AD8\u5EA6:1.2,\u539A\u5EA6:.2,\u62AC\u5347:0},color:{\u989C\u8272:"#eee"},floor:[{setEdges:[{offset:"1\u7F29\u8FDB"}],extrude:[{height:"1\u9AD8\u5EA6",thickness:"1\u539A\u5EA6",color:"\u989C\u8272",transform:[{moveZ:"1\u62AC\u5347"}]}]}]},"\u514D\u8D39\u4E2D\u6BB5<\u697C\u677F\u7F29\u8FDB,\u677F\u539A>":{unit:{\u697C\u677F\u7F29\u8FDB:.5,\u677F\u539A:.6},floor:[{setEdges:[{offset:-.4}],extrude:[{once:!0,height:"-1\u677F\u539A",transform:[{moveZ:"1SH"}]},{once:!0,height:"-1\u677F\u539A"}]},{setEdges:[{offset:"1\u697C\u677F\u7F29\u8FDB"}],extrude:[{height:"-1\u677F\u539A"}]},{extrude:[{once:!0,height:"1SH-1\u677F\u539A",color:"G"}]}]},"\u514D\u8D39\u4E2D\u6BB5\u7AD6\u5411<\u67F1\u5BBD,\u95F4\u8DDD,\u697C\u677F\u7F29\u8FDB>":{unit:{\u67F1\u5BBD:1,\u95F4\u8DDD:4,\u697C\u677F\u7F29\u8FDB:.5},floor:[{setEdges:[{offset:"1\u697C\u677F\u7F29\u8FDB"}],floorRange:[{top:-1}],extrude:[{height:-.6}]},{extrude:[{once:!0,height:"1SH-0.6",color:"G"}],facade:[{once:!0,proto:[{spacing:[{space:"1\u95F4\u8DDD",group:[{x:"1\u67F1\u5BBD",y:"1\u67F1\u5BBD",z:"1SH"}]}]}]}]}]},"\u514D\u8D39\u4E2D\u6BB5\u968F\u673A\u5782\u76F4\u5899\u677F<\u5899\u5BBD,\u7A97\u5BBD,\u6982\u7387><\u5899\u677F>":{unit:{\u5899\u5BBD:4,\u7A97\u5BBD:2,\u6982\u7387:.8},color:{\u5899\u677F:"#eee"},floor:[{extrude:[{once:!0,height:"1SH",color:"G"}],facade:[{once:!0,proto:[{last:!0,lastWidth:"1\u5899\u5BBD",spacing:[{control:{chance:"1\u6982\u7387"},space:"1\u5899\u5BBD+1\u7A97\u5BBD",group:[{x:"1\u5899\u5BBD",y:.5,z:"1SH",color:"\u5899\u677F",transform:[{moveX:"0.5\u5899\u5BBD"}]}]}]}]}]}]},"\u514D\u8D39\u5E95\u90E8\u52A0\u6838\u5FC3\u7B52<\u697C\u677F\u7F29\u8FDB,\u677F\u539A>":{unit:{\u697C\u677F\u7F29\u8FDB:.5,\u677F\u539A:1.2},floor:[{setEdges:[{offset:"1\u697C\u677F\u7F29\u8FDB"}],floorRange:[{bottom:1,top:-1}],extrude:[{height:"-1\u677F\u539A"}]},{extrude:[{once:!0,height:"1SH-1\u677F\u539A",color:"G"}]},{setEdges:[{offset:{x:.1,y:.2,asRatio:!0}}],extrude:[{once:!0,height:"1BH+4"}]}]},"\u514D\u8D39\u5E95\u90E8\u7AD6\u5411\u52A0\u6838\u5FC3\u7B52<\u67F1\u5BBD,\u7A97\u5BBD,\u697C\u677F\u7F29\u8FDB,\u677F\u539A,\u964D\u4F4E>":{unit:{\u67F1\u5BBD:1,\u7A97\u5BBD:2,\u697C\u677F\u7F29\u8FDB:.5,\u677F\u539A:1.2,\u964D\u4F4E:0},floor:[{setEdges:[{offset:"1\u697C\u677F\u7F29\u8FDB"}],floorRange:[{bottom:1,top:-1}],extrude:[{height:"-1\u677F\u539A"}]},{extrude:[{once:!0,height:"1SH-1\u677F\u539A",color:"G"}],facade:[{once:!0,proto:[{spacing:[{space:"1\u67F1\u5BBD+1\u7A97\u5BBD",group:[{x:"1\u67F1\u5BBD",y:"1\u67F1\u5BBD",z:"1SH-1\u964D\u4F4E"}]}]}]}]},{setEdges:[{offset:{x:.1,y:.2,asRatio:!0}}],extrude:[{once:!0,height:"1BH+4"}]}]},"\u514D\u8D39\u5E95\u90E8\u9A6C\u8D5B\u514B\u52A0\u6838\u5FC3\u7B52<\u6982\u7387><\u9A6C\u8D5B\u514B>":{color:{\u9A6C\u8D5B\u514B:["#888","#fff"]},unit:{\u964D\u4F4E:0,\u6982\u7387:.8},floor:[{extrude:[{once:!0,height:"1SH",color:"G"}],facade:[{proto:[{last:!0,lastWidth:4,spacing:[{control:{chance:"1\u6982\u7387"},space:6,group:[{x:4,y:.5,z:"1FH-0.6",color:"\u9A6C\u8D5B\u514B",transform:[{moveX:2}]}]}]}]}]},{floorRange:[{top:-1,bottom:1}],extrude:[{height:-.6}]},{setEdges:[{offset:{x:.1,y:.2,asRatio:!0}}],extrude:[{once:!0,height:"1BH+4"}]}]},"\u514D\u8D39\u5E95\u90E8\u6311\u5ECA\u52A0\u6838\u5FC3\u7B52<\u7F29\u8FDB>":{unit:{\u7F29\u8FDB:3},floor:[{floorRange:[{bottom:1}],extrude:[{height:-.6},{height:1,color:"G"}]},{setEdges:[{offset:.4}],facade:[{once:!0,proto:[{spacing:[{space:4,group:[{x:1,y:1,z:"1SH-0.6"}]}]}]}]},{setEdges:[{offset:"1\u7F29\u8FDB"}],extrude:[{once:!0,height:"1SH",color:"G"}]},{setEdges:[{offset:{x:.1,y:.2,asRatio:!0}}],extrude:[{once:!0,height:"1BH+4"}]}]},"\u514D\u8D39\u5E95\u90E8\u5BBD\u89D2\u67F1\u52A0\u6838\u5FC3\u7B52<\u539A\u5EA6,\u964D\u4F4E><\u6D45\u8272,\u6DF1\u8272>":{unit:{\u539A\u5EA6:.6,\u964D\u4F4E:0},color:{\u6D45\u8272:"#eee",\u6DF1\u8272:"#999"},floor:[{facade:[{once:!0,padding:{start:.2,end:.2},proto:[{area:"BOTH",divide:[{count:1,group:[{width:"1\u539A\u5EA6",height:"1SH-1\u964D\u4F4E",color:"\u6D45\u8272"}]}]},{area:"MIDDLE",divide:[{count:1,group:[{width:"0.8\u539A\u5EA6",height:"0.4FH",color:"\u6DF1\u8272",transform:[{moveZ:"1SH-0.4FH-1\u964D\u4F4E"}]}]}]}]}]},{setEdges:[{offset:1}],floorRange:[{bottom:1}],extrude:[{height:-1}]},{extrude:[{once:!0,height:"1SH",color:"G"}]},{setEdges:[{offset:{x:.1,y:.2,asRatio:!0}}],extrude:[{once:!0,height:"1BH+4"}]}]}},building:{Random:{type:"FREE",section:{roof:{floor:[{preset:[{key:"\u514D\u8D39\u5C4B\u9876"}]}]},middle:{floor:[{preset:[{key:"\u514D\u8D39\u4E2D\u6BB5"}]}]},bottom:{height:"0.2BH",floorHeight:5,floor:[{preset:[{key:"\u514D\u8D39\u5E95\u90E8"}]}]}}},S0:{type:"FREE",section:{roof:{floor:[{preset:[{name:"\u514D\u8D39\u5C4B\u9876\u5973\u513F\u5899<\u7F29\u8FDB,\u9AD8\u5EA6,\u539A\u5EA6,\u62AC\u5347><\u989C\u8272>",unit:{\u7F29\u8FDB:1}}]}]},middle:{floor:[{preset:[{name:"\u514D\u8D39\u4E2D\u6BB5<\u697C\u677F\u7F29\u8FDB,\u677F\u539A>"}]}]},bottom:{height:"0.2BH",floorHeight:5,floor:[{preset:[{name:"\u514D\u8D39\u5E95\u90E8\u52A0\u6838\u5FC3\u7B52<\u697C\u677F\u7F29\u8FDB,\u677F\u539A>"}]}]}}},S1:{type:"FREE",section:{roof:{floor:[{preset:[{name:"\u514D\u8D39\u5C4B\u9876\u5973\u513F\u5899<\u7F29\u8FDB,\u9AD8\u5EA6,\u539A\u5EA6,\u62AC\u5347><\u989C\u8272>"}]}]},middle:{floor:[{preset:[{name:"\u514D\u8D39\u4E2D\u6BB5<\u697C\u677F\u7F29\u8FDB,\u677F\u539A>"}]}]},bottom:{height:"0.2BH",floorHeight:5,floor:[{preset:[{name:"\u514D\u8D39\u5E95\u90E8\u6311\u5ECA\u52A0\u6838\u5FC3\u7B52<\u7F29\u8FDB>"}]}]}}},S2:{type:"FREE",section:{roof:{floor:[{preset:[{name:"\u514D\u8D39\u5C4B\u9876\u5973\u513F\u5899<\u7F29\u8FDB,\u9AD8\u5EA6,\u539A\u5EA6,\u62AC\u5347><\u989C\u8272>"}]}]},middle:{floor:[{preset:[{name:"\u514D\u8D39\u4E2D\u6BB5<\u697C\u677F\u7F29\u8FDB,\u677F\u539A>"}]}]},bottom:{height:"0.15BH-0.6",floorHeight:5,floor:[{preset:[{name:"\u514D\u8D39\u5E95\u90E8\u5BBD\u89D2\u67F1\u52A0\u6838\u5FC3\u7B52<\u539A\u5EA6,\u964D\u4F4E><\u6D45\u8272,\u6DF1\u8272>"}]}]}}},S3:{type:"FREE",section:{roof:{floor:[{preset:[{name:"\u514D\u8D39\u5C4B\u9876\u5973\u513F\u5899<\u7F29\u8FDB,\u9AD8\u5EA6,\u539A\u5EA6,\u62AC\u5347><\u989C\u8272>",unit:{\u9AD8\u5EA6:2},color:{\u989C\u8272:"#bbb"}}]}]},middle:{floor:[{preset:[{name:"\u514D\u8D39\u4E2D\u6BB5\u7AD6\u5411<\u67F1\u5BBD,\u95F4\u8DDD,\u697C\u677F\u7F29\u8FDB>"}]}]},bottom:{height:"0.1BH",floorHeight:5,floor:[{preset:[{name:"\u514D\u8D39\u5E95\u90E8\u5BBD\u89D2\u67F1\u52A0\u6838\u5FC3\u7B52<\u539A\u5EA6,\u964D\u4F4E><\u6D45\u8272,\u6DF1\u8272>"}]}]}}},S4:{type:"FREE",section:{roof:{floor:[{preset:[{name:"\u514D\u8D39\u5C4B\u9876\u5973\u513F\u5899<\u7F29\u8FDB,\u9AD8\u5EA6,\u539A\u5EA6,\u62AC\u5347><\u989C\u8272>",unit:{\u9AD8\u5EA6:2}}]}]},middle:{floor:[{preset:[{name:"\u514D\u8D39\u4E2D\u6BB5\u7AD6\u5411<\u67F1\u5BBD,\u95F4\u8DDD,\u697C\u677F\u7F29\u8FDB>",unit:{\u95F4\u8DDD:3}}]}]},bottom:{height:"0.2BH",floorHeight:5,floor:[{preset:[{name:"\u514D\u8D39\u5E95\u90E8\u9A6C\u8D5B\u514B\u52A0\u6838\u5FC3\u7B52<\u6982\u7387><\u9A6C\u8D5B\u514B>",color:{\u9A6C\u8D5B\u514B:"#eee"}}]}]}}},S5:{type:"FREE",section:{roof:{floor:[{preset:[{name:"\u514D\u8D39\u5C4B\u9876\u5973\u513F\u5899<\u7F29\u8FDB,\u9AD8\u5EA6,\u539A\u5EA6,\u62AC\u5347><\u989C\u8272>",unit:{\u9AD8\u5EA6:3,\u7F29\u8FDB:-.2,\u62AC\u5347:-1}}]}]},middle:{floor:[{preset:[{name:"\u514D\u8D39\u4E2D\u6BB5\u7AD6\u5411<\u67F1\u5BBD,\u95F4\u8DDD,\u697C\u677F\u7F29\u8FDB>",unit:{\u67F1\u5BBD:1.4,\u7A97\u5BBD:2}}]}]},bottom:{height:"0.15BH",floorHeight:5,floor:[{preset:[{name:"\u514D\u8D39\u5E95\u90E8\u7AD6\u5411\u52A0\u6838\u5FC3\u7B52<\u67F1\u5BBD,\u7A97\u5BBD,\u697C\u677F\u7F29\u8FDB,\u677F\u539A,\u964D\u4F4E>",unit:{\u67F1\u5BBD:1,\u7A97\u5BBD:3}}]}]}}}}};var Po=new te(pt,ut,mt,ht,dt,yt),Ao=Po;import{Vector2 as ae,Matrix3 as Lo}from"three";import{ShapeUtils as ge}from"three/src/extras/ShapeUtils.js";import{Matrix4 as Oo}from"three";import{Matrix4 as xt}from"three";import{degToRad as ze}from"three/src/math/MathUtils.js";var S=new xt,z={index:0,glass:!1};function F(t,e,o=1){return t.transform?.forEach(r=>{"rotateX"in r?e.premultiply(S.makeRotationX(ze(r.rotateX))):"rotateY"in r?e.premultiply(S.makeRotationY(ze(r.rotateY))):"rotateZ"in r?e.premultiply(S.makeRotationZ(ze(r.rotateZ))):e.premultiply(S.makeTranslation(r.moveX*o,r.moveY,r.moveZ))}),e}function gt(t,e,o){let{x:r,y:n,z:s}=t;if(r===0||n===0||s===0)return;let i=o?.5:0,a=new xt().makeTranslation(i,0,.5);return r<0&&(o&&a.premultiply(S.makeTranslation(-1,0,0)),r=-r),n<0&&(n=-n),s<0&&(a.premultiply(S.makeTranslation(0,0,-1)),s=-s),a.premultiply(S.makeScale(r*e,n,s)),{matrix:F(t,a,e),color:t.color||[z]}}function Le(t,e,o){return"x"in t?gt(t,o,!1):gt({x:e-t.shrink,y:t.width,z:t.height,transform:t.transform,color:t.color},o,!0)}function vt(t,e,o,r){t.forEach(n=>{let{color:s,height:i,overhang:a,elevation:c}=n,{min:l,max:u}=e,f=D(s,r)||z,p=new Oo().makeScale(u.x-l.x+a*2,u.y-l.y+a*2,Math.abs(i));F(n,p).premultiply(S.makeTranslation(l.x-a,l.y-a,c));let m=o.data[f.glass?"slopingGlass":"sloping"];m.matrices.push(p.toArray()),m.colors.push(f.index)})}import{Matrix4 as ko}from"three";function Et(t,e,o,r){t.forEach(n=>{let{color:s,height:i,elevation:a}=n,{min:c,max:l}=e,u=D(s,r)||z,f=new ko().makeTranslation(.5,.5,.5);i<0&&f.premultiply(S.makeTranslation(0,0,-1)),f.premultiply(S.makeScale(l.x-c.x,l.y-c.y,Math.abs(i))),F(n,f).premultiply(S.makeTranslation(c.x,c.y,a));let p=o.data[u.glass?"boxGlass":"box"];p.matrices.push(f.toArray()),p.colors.push(u.index)})}import{Matrix4 as No}from"three";function wt(t,e,o,r){t.forEach(n=>{Ho(o.data,Io(e,n.padding),n,r)})}function Io(t,e){if(e){let{start:o,middle:r,end:n,asRatio:s}=e;return t.map(i=>i.map(a=>{let c=Object.assign({split:{}},a),l=a.direction,u=l.length(),f=a.start.clone(),p=a.end.clone(),m=f,h=p,g=0,d=0,y=0;if(r>0?(d=s?r*u:r,g=y=(u-d)/2):(g=s?o*u:o,y=s?n*u:n,d=u-g-y),g!==0){let v=l.clone().setLength(g);m=f.clone().add(v),c.split.startRay={start:f,end:m,direction:v}}if(y!==0){let v=l.clone().setLength(y);h=p.clone().add(v.clone().negate()),c.split.endRay={start:h,end:p,direction:v}}return d!==0&&(c.split.middleRay={start:m,end:h,direction:l.clone().setLength(d)}),c}))}else return t.map(o=>o.map(r=>Object.assign({split:{middleRay:r}},r)))}function Ho(t,e,o,r){let{proto:n,elevation:s}=o;n?.forEach(i=>{let{area:a}=i;if(a==="MIDDLE")e.forEach(c=>c.forEach(l=>Ge(i,t,s,r,l.split.middleRay)));else{let c=a==="BOTH"||a==="START",l=a==="BOTH"||a==="END";e.forEach(u=>{c&&u.forEach(f=>Ge(i,t,s,r,f.split.startRay)),l&&u.forEach(f=>Ge(i,t,s,r,f.split.endRay))})}})}function Ge(t,e,o,r,n){if(n){let{start:s,direction:i}=n,{spacing:a,divide:c,first:l,last:u,lastWidth:f}=t,p=i.length(),m=[];if(a){let h=[];a.forEach(d=>{for(let y=-1;y<d.repeat;y++)h.push(d.space)});let g=me(h,p,f);if(g){let{ratio:d,count:y}=g,v=[];a.forEach(M=>{let w;M.group&&(w=[],M.group.forEach(T=>{let O=Le(T,M.space,d);O&&w.push(O)}));let b=M.control;for(let T=-1;T<M.repeat;T++)v.push({model:w,control:b,space:M.space*d})}),bt(v,y,e,o,i,s,l,u,r)}}c&&c.map(h=>{let g=p/h.count,d=me([g],p,f);if(d){let{ratio:y,count:v}=d;g*=y;let M=[];h.group.forEach(w=>{let b=Le(w,g,y);b&&M.push(b)}),m=[{model:M,control:h.control,space:g*y}],bt(m,v,e,o,i,s,l,u,r)}})}}function bt(t,e,o,r,n,s,i,a,c){let l=0,u=new No().makeRotationZ(n.angle()).premultiply(S.makeTranslation(s.x,s.y,r)),f=t[0];for(let p=0;p<e;p++)t.forEach(m=>{(p||i)&&ee(p,c,m.control)&&Tt(m,l,u,c,o),l+=m.space});a&&f&&Tt(f,l,u,c,o)}function Tt(t,e,o,r,n){t.model?.forEach(s=>{let i=s.matrix.clone().premultiply(S.makeTranslation(e,0,0)).premultiply(o),a=D(s.color,r)||z,c=n[a.glass?"boxGlass":"box"];c.matrices.push(i.toArray()),c.colors.push(a.index)})}import{Vector2 as Mt,Matrix4 as ie}from"three";function Co(t){let e=[],o=t[0];if(o){e.push(o);for(let r=1;r<t.length;r++){let n=t[r];if(n.pairs.length!==o.pairs.length)o=n,e.push(o);else if(o.pairs.find((i,a)=>{let c=n.pairs[a];return!(c&&Math.abs(i.width-c.width)<1&&Math.abs(i.center.x-c.center.x)<1)}))o=n,e.push(o);else{o.width+=n.width,o.height=(o.height+n.height)/2,o.elevation=(o.elevation+n.elevation)/2;let i=n.width/2;o.pairs.forEach(a=>{a.center.y+=i})}}}return e}function Ve(t,e,o,r,n=!1){t.forEach(s=>{let{along:i,flexes:a,elevation:c,sandwich:l}=s,{newRays:u,radian:f}=Ce(e.flat(),r,i),p=He(u,a,c,l);if(n&&(p=Co(p)),!p)return;let m=0;p.forEach(O=>m+=O.width);let h=0,g=m,d=0,y=m,v=s.top?.padding,M=s.bottom?.padding;(M||v)&&(v&&(h=m*v.start,g=m*(1-v.end)),M&&(d=m*M.start,y=m*(1-M.end)));let w=g-h,b=y-d,T=0;p.forEach((O,N)=>{if(ee(N,r,s.control)){let{width:I,pairs:H}=O,{height:A,elevation:Z}=O,X=0;if(A<0&&(X=A,A=-A),A>0){if(T+=I/2,s.top&&w>0){let{like:Y,ratio:q}=s.top;if(h<T&&T<g){let re=Y==="HILL"?1-Math.sin((T-h)/w*Math.PI):Y==="VALLEY"?Math.sin((T-h)/w*Math.PI):P(r);A*=1-q*re}}if(s.bottom&&b>0){let{like:Y,ratio:q}=s.bottom;if(d<T&&T<y){let re=Y==="TUNNEL"?Math.sin((T-d)/b*Math.PI):P(r),ne=A*q*re;Z+=ne,A-=ne}}T+=I/2;let C=new ie().makeRotationZ(-f);H.forEach(Y=>{let q=D(O.color,r)||z,re=F(O,new ie().makeScale(Y.width,I,A)).premultiply(S.makeTranslation(Y.center.x,Y.center.y,Z+X+A/2)).premultiply(C),ne=o.data[q.glass?"boxGlass":"box"];ne.matrices.push(re.toArray()),ne.colors.push(q.index)})}else T+=I}})})}function St(t,e,o,r){t.forEach(n=>{let{flex:s,count:i,depthRatio:a,widthRatio:c,heightRatio:l,along:u,elevation:f}=n,{newRays:p,radian:m}=Ce(e.flat(),r,u),h=He(p,[s],f,!1);if(!h)return;let g=U(r,...i);if(h.length>0){let d=[];for(let v=0;v<g;v++){let M=P(r),w=0;M<.2?w=Math.floor(h.length*P(r)):M<.6?w=Math.floor(h.length*U(r,0,.2,.02)):w=Math.floor(h.length*U(r,.8,1,.02));let b=h[w];if(b){let T=Math.floor(b.pairs.length*P(r)),O=Math.floor(h.length*U(r,...a)),N=Do(h,w,T,O);N&&d.push({matchDataIndex:w,props:N})}}d.sort((v,M)=>v.props.w*v.props.d-M.props.w*M.props.d);let y=(l[1]-l[0])/d.length;d.forEach((v,M)=>{let{props:w,matchDataIndex:b}=v,T=h[b];if(T){let O=s.height;if(w.d>0){let N=w.w*U(r,...c,.05),I=w.w-N,H=P(r);H<.2?I*=.2-U(r,0,.4,.02):H<.6?I*=.5-U(r,0,.2,.02):I*=U(r,0,.2,.02)-.5;let A=Math.round(10*(P(r)-.5))*.2;O*=1-M*y;let Z=new ie().premultiply(S.makeScale(N,w.d,O));Z=F(T,Z).premultiply(S.makeTranslation(w.x+I,w.y+A,f+O/2)).premultiply(S.makeRotationZ(-m));let X=D(T.color,r)||z,C=o.data[X.glass?"boxGlass":"box"];C.matrices.push(Z.toArray()),C.colors.push(X.index)}}})}})}function Pt(t,e,o,r){t.forEach(n=>{let{boxes:s,place:i,count:a,elevation:c}=n,l=i==="EDGE";for(let u=0;u<a;u++){let f=l?Bo(e,r):_o(e,r);f&&s.forEach(p=>{let m=D(p.color,r)||z,h=new ie().makeTranslation(0,0,.5).premultiply(S.makeScale(p.x,p.y,p.z));F(p,h).premultiply(S.makeTranslation(f.x,f.y,c));let g=o.data[m.glass?"boxGlass":"box"];g.matrices.push(h.toArray()),g.colors.push(m.index)})}})}function _o(t,e){let o={min:1/0,max:-1/0};t[0]?.forEach(i=>{o.min=Math.min(o.min,i.start.y),o.max=Math.max(o.max,i.start.y)});let r=o.min+P(e)*(o.max-o.min),n=Ie(r,t.flat()),s=n[Math.floor(P(e)*n.length)];return s?new Mt(s[0].x+(s[1].x-s[0].x)*P(e),r):void 0}function Bo(t,e){let o=t[0];if(o){let r=D(o,e);if(r){let{start:n,end:s}=r,i=P(e);return new Mt(n.x+(s.x-n.x)*i,n.y+(s.y-n.y)*i)}}}function Do(t,e,o,r){let n=t[e]?.pairs[o];if(n){let{center:s,width:i}=n,a={xLeftMin:s.x-i/2,xRightMax:s.x+i/2,centerMinY:s.y,centerMaxY:s.y};return Rt(t,e,1,r,a),Rt(t,e,-1,r,a),{w:a.xRightMax-a.xLeftMin,d:a.centerMaxY-a.centerMinY,x:(a.xLeftMin+a.xRightMax)/2,y:(a.centerMinY+a.centerMaxY)/2}}}function Rt(t,e,o,r,n){let s=!0;for(;r>0&&s;)s=!1,e+=o,t[e]?.pairs.forEach(i=>{let{center:a,width:c}=i,l=a.x-c/2,u=a.x+c/2;u<=n.xLeftMin||l>=n.xRightMax||(n.xLeftMin<l&&(n.xLeftMin=l),n.xRightMax>u&&(n.xRightMax=u),o>0?n.centerMaxY=a.y:n.centerMinY=a.y,s=!0,r--)})}function At(t,e,o,r,n){t.forEach(s=>{let{color:i,transform:a,height:c,thickness:l,elevation:u}=s,f=D(i,r)||z,p=new ie;if(l){let m=l<0?-.5:.5,h=c<0?-.5:.5,g=o.data[f.glass?"boxGlass":"box"];e.forEach(d=>{d.forEach(y=>{let v=p.clone();v.premultiply(S.makeTranslation(.5,m,h)).premultiply(S.makeScale(y.direction.length(),Math.abs(l),Math.abs(c))).premultiply(S.makeRotationZ(y.direction.angle())),F(s,v).premultiply(S.makeTranslation(y.start.x,y.start.y,u)),g.matrices.push(v.toArray()),g.colors.push(f.index)})})}else Ve([{along:"WIDTH",flexes:[{shrink:0,width:n,height:c,transform:a,color:i}],elevation:u,sandwich:!1,top:void 0,bottom:void 0,control:void 0}],e,o,r,!0)})}import{Vector2 as Ot,Matrix3 as zo}from"three";function kt(t,e,o,r){let n=r?new zo().makeRotation(r):void 0,s=o.asRatio?{x:e.x*o.x,y:e.y*o.y}:{x:o.x,y:o.y};return t.map(i=>{let a=[];return i.forEach((c,l)=>{let u=i[l===0?i.length-1:l-1],f={start:u.start,end:u.end,direction:u.end.clone().sub(u.start)},p=nt(Ne(c,s),Ne(f,s));p&&a.push(n?p.applyMatrix3(n):p)}),a.map((c,l)=>{let u=a[l===a.length-1?0:l+1];return{start:c,end:u,direction:u.clone().sub(c)}})})}function Nt(t,e){return t.map(o=>{let r=[];return e.forEach(n=>{let{min:s,max:i}=n,a=new Ot(s.x,i.y),c=new Ot(i.x,s.y),l={min:s,max:i,lines:[{start:s,end:a},{start:a,end:i},{start:i,end:c},{start:c,end:s}]};o.forEach(u=>{let f=rt(u,l);if(f){let{start:p,end:m}=f;r.push({start:p,end:m,direction:m.clone().sub(p)})}})}),r})}var xe=class{seed;styleParams;area;center;relative;orignal;constructor(e){this.orignal=e.loops.map(r=>r.map(n=>new ae(...n)));let o=this.orignal[0];if(o&&o.length>2){ge.isClockWise(o)&&o.reverse(),this.area=ge.area(o);for(let l=1;l<this.orignal.length;l++){let u=this.orignal[l];ge.isClockWise(u)||u.reverse(),this.area-=ge.area(u)}let r=new ae;o.forEach((l,u)=>{let f=o[u+1===o.length?0:u+1],p=new ae().subVectors(f,l);p.length()>r.length()&&r.copy(p)});let n=new ae(0,0),s=r.angle();this.center=Vo(o);let i=this.orignal.map(l=>l.map(u=>u.sub(this.center).rotateAround(n,-s))),{min:a,max:c}=K(i[0]);this.relative={radian:s,bounds:{min:a,max:c},size:{x:c.x-a.x,y:c.y-a.y},rays:i.map(l=>l.map((u,f)=>{let p=l[f+1===l.length?0:f+1],m=p.clone().sub(u);return{start:u,end:p,direction:m}}))}}else throw"ERROR: invalid input.loops";this.styleParams=Object.assign({style:"",height:24,floorHeight:3,elevation:0,seed:0,matchSpacing:2},e.params),this.seed=new he(this.styleParams.seed)}getEdges(e,o,r,n){let s=this.relative.rays[0],i=r?[s]:this.relative.rays,{min:a,max:c}=K(s.map(u=>u.start)),l={x:c.x-a.x,y:c.y-a.y};if(e.set?.forEach(u=>{if(u.offset)i=kt(i,l,u.offset);else if(u.clamp){let f=K(s.map(m=>m.start)),p=Go(f,u.clamp);i=Nt(i,p)}else if(u.along){let f=u.along;switch(f){case"WIDTH":i=i.map(p=>p.filter(m=>Q(m.direction.angle()))).filter(p=>p.length>0);break;case"DEPTH":i=i.map(p=>p.filter(m=>!Q(m.direction.angle()))).filter(p=>p.length>0);break;case"RANDOM":i=i.map(p=>p.filter(()=>P(o)<1)).filter(p=>p.length>0);break;case"SHORTEST":case"LONGEST":{let p=s.reduce((m,h)=>m.direction.length()>h.direction.length()?m:h);i=f==="LONGEST"?i.map(m=>m.filter(h=>Q(h.direction.angleTo(p.direction)))):i.map(m=>m.filter(h=>!Q(h.direction.angleTo(p.direction))))}break;default:i=i.map(p=>p.filter(m=>Math.abs(m.direction.angle()-f)<10*(Math.PI/180))).filter(p=>p.length>0);break}}}),n){let u=new Lo().makeRotation(n);i.forEach(f=>f.forEach(p=>{p.direction.applyMatrix3(u),p.start.applyMatrix3(u),p.end.applyMatrix3(u)}))}return i}toModel(e,o,r,n){let s=o.parseStyle(this.styleParams,this.seed,n);s.colorMap.forEach(c=>{e.includes(c)||e.push(c)});let i={info:{floorArea:this.area,floors:s.floorCount},points:this.relative.rays.map(c=>c.map(l=>l.start.toArray())),center:this.center.toArray(),centerRelative:[this.center.x-r.x,this.center.y-r.y],params:this.styleParams,rotate:this.relative.radian,data:{box:{matrices:[],colors:[]},boxGlass:{matrices:[],colors:[]},sloping:{matrices:[],colors:[]},slopingGlass:{matrices:[],colors:[]}}},a=this.seed;return s.classified.forEach(c=>{let l=this.getEdges(c.edgeParams,a,!0);if(l[0]&&l[0].length>0){let u=K(l[0].map(f=>f.start));At(c.extrude,l,i,a,this.styleParams.matchSpacing||2),Ve(c.match,l,i,a),wt(c.facade,l,i,a),St(c.boxInside,l,i,a),Pt(c.adjunct,l,i,a),Et(c.clampBox,u,i,a),vt(c.slopingRoof,u,i,a)}}),i}};function Go(t,e){let o=t.min.clone(),r=t.max.clone(),n=r.x-o.x,s=r.y-o.y,{xMin:i,xMax:a,yMin:c,yMax:l,xCentral:u,yCentral:f,asRatio:p,reverse:m}=e,h=[{min:o,max:r}];return It(h,"x",n,u,i,a,p,m),It(h,"y",s,f,c,l,p,m),h}function It(t,e,o,r,n,s,i,a){let c=[];if(r){let l=i?r*o:r;if(l>0){let u=(o-l)/2;u&&t.forEach(f=>{if(a){let p={min:f.min.clone(),max:f.max.clone()};f.max[e]=f.min[e]+u,p.min[e]=p.max[e]-u,c.push(p)}else f.min[e]+=u,f.max[e]-=u})}}else if(n||s){let l=n?i?n*o:n:0,u=s?i?s*o:s:0;t.forEach(f=>{if(a)if(l&&u){let p={min:f.min.clone(),max:f.max.clone()};c.push(p),f.max[e]=f.min[e]+l,p.min[e]=p.max[e]-u}else l?f.max[e]=f.min[e]+l:u&&(f.min[e]=f.max[e]-u);else f.min[e]+=l,f.max[e]-=u})}t.push(...c)}function Vo(t){let e=[0,0];return t.forEach(o=>{e[0]+=o.x,e[1]+=o.y}),e[0]/=t.length,e[1]/=t.length,new ae(...e)}import{Vector3 as Xt,Color as Yt,WebGLRenderer as br,PerspectiveCamera as Tr}from"three";import{Vector2 as Zn,Vector3 as Fo,Raycaster as Un,Quaternion as Xn}from"three";import{OrbitControls as Zo}from"three/examples/jsm/controls/OrbitControls.js";var Uo={autoRotateSpeed:0,zoomMinDistance:0,zoomToCursor:!1,enableDamping:!1,enablePan:!1};function Ht(t,e){let o=Object.assign(Uo,e),r=new Zo(t.camera,t.renderer.domElement);r.zoomToCursor=o.zoomToCursor,r.enableDamping=o.enableDamping,r.enablePan=o.enablePan,r.maxDistance=1e4;let n=o.autoRotateSpeed,s=o.zoomMinDistance;return n>0&&(r.autoRotateSpeed=n,r.autoRotate=!0),s>0&&r.addEventListener("change",()=>{if(r.getDistance()<s){let i=new Fo;r.object.getWorldDirection(i),r.target.add(i.setLength(9))}}),t.playing.animations.updateControls=r.update,r}import{Matrix4 as Bt,Group as qo,Color as $o,EdgesGeometry as Jo,LineSegments as Ko,BufferGeometry as Qo,BoxGeometry as er,InstancedMesh as tr,InstancedBufferGeometry as or,InstancedBufferAttribute as rr,BufferAttribute as nr}from"three";import{DoubleSide as Xo,MeshLambertMaterial as Ct,MeshStandardMaterial as Yo,LineBasicMaterial as Wo}from"three";var jo={side:Xo,opacity:.6,transparent:!0},ve=new Ct,_t=new Ct({side:2}),ce=new Yo(jo),oe=new Wo({color:"#000"});oe.onBeforeCompile=t=>{t.vertexShader=t.vertexShader.replace("void main() {",`
attribute mat4 matrix;
void main() {`).replace("#include <project_vertex>",`vec4 mvPosition = matrix * vec4( transformed, 1.0 );
      gl_Position = projectionMatrix * modelViewMatrix * mvPosition;`)};var Fe=new er,Dt=Gt();function Ze(t,e,o){let r=new qo().rotateX(-Math.PI/2),n={},s=o?.showEdge||!1,i=o?.grayScale||!1,a=o?.inplace||!1,c=new Bt,l={instance:{box:{color:[],matrix:[]},boxGlass:{color:[],matrix:[]},sloping:{color:[],matrix:[]},slopingGlass:{color:[],matrix:[]}},edge:{boxMatrix:[],slopingMatrix:[]}},u;t.models.forEach(m=>{let h=a?{center:m.centerRelative,rotate:m.rotate}:void 0;for(u in m.data){let g=m.data[u],d=l.instance[u];g.matrices.forEach((y,v)=>{let M=new Bt().fromArray(y);h&&M.premultiply(c.makeRotationZ(h.rotate)).premultiply(c.makeTranslation(...h.center,0)),s&&l.edge[u.includes("box")?"boxMatrix":"slopingMatrix"].push(...M.toArray()),d.matrix.push(M);let w=t.colorMap[g.colors[v]];i&&(w=t.colorMap[w.includes("G")?1:0]);let b=n[w];b||(b=new $o(w.replace(/ *G$/,"")),n[w]=b),d.color.push(b)})}}),Ee(r,l.instance.box,Fe,ve),Ee(r,l.instance.boxGlass,Fe,ce),Ee(r,l.instance.sloping,Dt,_t),Ee(r,l.instance.slopingGlass,Dt,ce);let{boxMatrix:f,slopingMatrix:p}=l.edge;if(f.length>0){let m=zt(Fe);r.add(Lt(m,f,oe))}if(p.length>0){let m=zt(Gt());r.add(Lt(m,p,oe))}r.name="buildings",e.add(r)}function zt(t){let e=new Jo(t),o=new or;return o.setAttribute("position",e.getAttribute("position")),e.dispose(),o}function Lt(t,e,o){t.setAttribute("matrix",new rr(new Float32Array(e),16)),t.instanceCount=e.length/16;let r=new Ko(t,o);return r.frustumCulled=!1,r}function Ee(t,e,o,r){if(e.matrix.length>0){let n=new tr(o,r,e.matrix.length);e.matrix.forEach((s,i)=>{n.setMatrixAt(i,s),n.setColorAt(i,e.color[i])}),n.castShadow=n.receiveShadow=!0,t.add(n)}}function Gt(t=.2){let e=new Qo,o=[t,.5,1],r=[1-t,.5,1],n=[0,0,0],s=[1,0,0],i=[1,1,0],a=[0,1,0],c=new Float32Array([...s,...o,...n,...s,...r,...o,...a,...r,...i,...a,...o,...r,...n,...o,...a,...i,...r,...s]);return e.setAttribute("position",new nr(c,3))}import{Group as sr,Scene as ir,DirectionalLight as ar,AmbientLight as cr,MeshLambertMaterial as lr,PlaneGeometry as fr,Mesh as pr,PCFSoftShadowMap as ur,TextureLoader as mr,Fog as hr,RepeatWrapping as dr}from"three";var yr=-Math.PI/2,le=class{parent;scene;lights;animations;ignored;ground;constructor(e,o=!0){this.parent=e,this.scene=new ir,this.ignored=new sr,this.animations={};let r=new cr("#fff",0),n=new ar;if(this.lights={directional:n,ambient:r},this.ignored.userData.ignored=!0,this.ignored.add(r,n,n.target),this.scene.add(this.ignored),o){n.shadow.mapSize.set(4096,4096),n.castShadow=!0;let s=n.shadow.camera;s.far=e.options.sunDistance*2;let i=e.renderer.shadowMap;i.type=ur,i.enabled=!0,this.setShadowArea(200,200)}}setShadowArea(e,o){let r=this.lights.directional.shadow.camera;r.bottom=-(r.top=o),r.left=-(r.right=e),r.updateProjectionMatrix()}addGround(e,o){let r=new lr({color:"#eee",polygonOffset:!0,polygonOffsetFactor:1,polygonOffsetUnits:.1}),n=new fr(e,e).rotateX(yr),s=new pr(n,r);s.renderOrder=-1,s.receiveShadow=!0,this.ignored.add(s),o&&new mr().load(o.pictureURL,i=>{if(this.ground={texture:i,size:e},r.map=i,r.needsUpdate=!0,o.uvMoving){i.wrapS=i.wrapT=dr;let a=o.uvMoving/e;this.animations.uvMovingX=()=>{i.offset.x+=-a}}},i=>console.error("TextureLoader error",o.pictureURL,i))}setPlaneUvMovingX(e){if(this.ground){let{texture:o}=this.ground;this.animations.uvMovingX=()=>{o.offset.x+=e}}}addFog(e,o,r="#fff"){this.scene.fog=new hr(r,e,o)}};import{Vector3 as fe}from"three";function Xe(t,e,o,r){t.animations.movingMaterial=()=>{be.value++},Vt(e,be,Ue,gr),Vt(o,be,Ue,xr),Er(r,be,Ue,vr)}var Ue=new fe(1,0,0),be={value:0},gr=Ye(`
[[0.778 0.778 0.750] [0.198 0.034 -0.198] [-0.770 -0.492 0.490] [-4.670 -4.970 -5.428]]
`),xr=Ye(`
[[0.778 0.778 0.750] [0.198 0.034 -0.198] [-0.770 -0.492 0.490] [-4.670 -4.970 -5.428]]
`),vr=Ye(`
[[1 1 1] [0 0 0] [0 0 0] [0 0 0]]
`),Ft=`
uniform float time;
uniform vec3 vect;
varying float bufferRatio;
varying float xPos;

mat4 translate(vec3 v, float t) {
  return mat4(1.0, 0.0, 0.0, 0.0,
              0.0, 1.0, 0.0, 0.0,
              0.0, 0.0, 1.0, 0.0,
              v.x*t, v.y*t, v.z*t, 1.0);
}

`,Zt=`
  float range = 1500.0;
  float bufferDistance = 500.0;
  float r2 = range * 2.0;

  bufferRatio = 1.0;
  mvPosition.x -= floor((mvPosition.x + range) / r2) * r2 ;

  float minX = bufferDistance - range;
  float maxX = range - bufferDistance;
  float b = bufferDistance / 2.0;
  xPos = mvPosition.x;
  if (xPos > maxX) {
    bufferRatio = (range - xPos - b) / b;
    if (bufferRatio < 0.0) bufferRatio = 0.0;
  } else if (xPos < minX) {
    bufferRatio = (xPos + range - b) / b;
    if (bufferRatio < 0.0) bufferRatio = 0.0;
  }
  mvPosition.z *= bufferRatio;
`;function Ye(t){let e=JSON.parse(t.trim().replace(/ +/g,","));return{v1:{value:new fe(...e[0])},v2:{value:new fe(...e[1])},v3:{value:new fe(...e[2])},v4:{value:new fe(...e[3])}}}function Ut(t){return t.replace("uniform vec3 diffuse;",`varying float bufferRatio;
varying float xPos;
uniform vec3 diffuse;
uniform vec3 v1;
uniform vec3 v2;
uniform vec3 v3;
uniform vec3 v4;
      `).replace("void main() {",`vec3 palette( in float t, in vec3 a, in vec3 b, in vec3 c, in vec3 d ) {
return a + b * cos( 6.28318 * (c * t + d) );
}

void main() {
if (bufferRatio < 0.01) discard;`).replace("#include <dithering_fragment>",`#include <dithering_fragment>
vec3 col = palette( xPos/2000.0,v1,v2,v3,v4 );
gl_FragColor = vec4( col, 1.0 );`)}function Vt(t,e,o,r){t.onBeforeCompile=n=>{Object.assign(n.uniforms,r),n.uniforms.time=e,n.uniforms.vect={value:o},n.vertexShader=n.vertexShader.replace("varying vec3 vViewPosition;","varying vec3 vViewPosition;"+Ft).replace("#include <project_vertex>",`vec4 mvPosition = vec4( transformed, 1.0 );

        #ifdef USE_BATCHING
          mvPosition = batchingMatrix * mvPosition;
        #endif

        #ifdef USE_INSTANCING
          mvPosition = instanceMatrix * mvPosition;
        #endif

        mvPosition = translate( vect, time ) * mvPosition;

        ${Zt}

        gl_Position = projectionMatrix * modelViewMatrix * mvPosition;`),n.fragmentShader=Ut(n.fragmentShader)}}function Er(t,e,o,r){t.depthWrite=!1,t.forceSinglePass=!0,t.onBeforeCompile=n=>{Object.assign(n.uniforms,r),n.uniforms.time=e,n.uniforms.vect={value:o},n.vertexShader=n.vertexShader.replace("void main() {",`
${Ft}
attribute mat4 matrix;
void main() {`).replace("#include <project_vertex>",`vec4 mvPosition = vec4( transformed, 1.0 );

        #ifdef USE_BATCHING
          mvPosition = batchingMatrix * mvPosition;
        #endif

        #ifdef USE_INSTANCING
          mvPosition = instanceMatrix * mvPosition;
        #endif

        mvPosition = translate( vect, time ) * matrix * mvPosition;

        ${Zt}

        gl_Position = projectionMatrix * modelViewMatrix * mvPosition;`),n.fragmentShader=Ut(n.fragmentShader)}}var wr={cameraPosition:[900,900,900],sunDistance:1e4,shadow:!0,time:10,lightColor:[{hour:5,color:"#116",directional:0,ambient:0},{hour:6,color:"#f60",directional:.6,ambient:.2},{hour:9,color:"#fff",directional:2,ambient:.6},{hour:12,color:"#fff",directional:2,ambient:.6},{hour:16,color:"#fff",directional:2,ambient:.6},{hour:18,color:"#d33",directional:.6,ambient:.2},{hour:19,color:"#116",directional:.1,ambient:.1},{hour:24,color:"#000",directional:0,ambient:0}]},Te=class{renderer;camera;constrols;views;playing;sunPosition;options;parent;envTexture;constructor(e,o){let r=document.querySelector(e);if(!r)throw"ERROR: invalid parentCSSID";let n=document.createElement("canvas");r.appendChild(n),this.parent=r,this.options=Object.assign(wr,o),(this.renderer=new br({antialias:!0,canvas:n})).setPixelRatio(window.devicePixelRatio),this.playing=new le(this,this.options.shadow),this.views=[this.playing],this.camera=new Tr(45,1,1,1e9),this.camera.position.set(...this.options.cameraPosition),this.constrols=Ht(this),this.sunPosition=new Xt,this.setTime(this.options.time),this.resizeScene(),window.addEventListener("resize",()=>this.resizeScene()),jt(this)}setMovingMaterial(){Xe(this.playing,ve,ce,oe)}setTime(e,o=!0){e=e%24,(o?[this.playing]:this.views).forEach(n=>{let s=n.lights.directional,i=n.lights.ambient,a,c,l,u=this.options.lightColor;u.find((f,p)=>{if(f.hour>e){let m=u[(p===0?u.length:p)-1],h=(e-m.hour)/(f.hour-m.hour);l=new Yt(m.color).lerp(new Yt(f.color),h),c=m.directional+(f.directional-m.directional)*h,a=m.ambient+(f.ambient-m.ambient)*h,s.color.set(l),s.intensity=c,i.color.set(l),i.intensity=a,this.renderer.setClearColor(l,(1-a)*.9);let g=Math.PI*(Math.cos(Math.PI*2*(e/24))+1),d=-Math.PI*e/12;return this.sunPosition.setFromSphericalCoords(this.options.sunDistance,g<0?0:g,d),s.position.copy(this.sunPosition),s.lookAt(new Xt),!0}return!1})})}resizeScene(){let{innerWidth:e,innerHeight:o}=window;this.renderer.setSize(e,o),this.camera.aspect=e/o,this.camera.updateProjectionMatrix()}clean(e=!0){e?Wt(this.playing):this.views.forEach(Wt)}refresh(e,o){return new Promise((r,n)=>{this.clean();let s={floorArea:0,maxFloors:0},i=0;Ze(e,this.playing.scene,o),e.models.forEach(a=>{let c=a.params.height,{floors:l,floorArea:u}=a.info;s.floorArea+=u*l,s.maxFloors<l&&(s.maxFloors=l),i<c&&(i=c)}),r(s)})}};function jt(t){let e=t.playing;t.renderer.render(e.scene,t.camera);for(let o in e.animations)e.animations[o]();document.body.contains(t.renderer.domElement)&&requestAnimationFrame(()=>jt(t))}function Wt(t){t.scene.children.map(o=>o).forEach(o=>{o.userData.ignored||(o.removeFromParent(),qt(o))})}function qt(t){t.children&&t.children.forEach(qt),t.material&&t.material.dispose(),t.geometry&&t.geometry.dispose()}export{xe as PLAN,te as STYLES,Te as WEB3D,Ao as styles};
/*!
  Magiz
  a light weight 3D building model generator for web
  Copyright (c) 2019-2024 周曦 <453154007@qq.com>
  https://www.architech.fun
  GPL Version 3 license
*/
